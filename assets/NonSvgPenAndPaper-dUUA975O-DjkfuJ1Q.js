
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * https://fantastic-admin.hurui.me
 */
    
import{e as i,J as we,E as xe,aa as be,aw as Ce,K as le,c as g,o as m,A as V,O as b,n as B,f as C,w as oe,g as N,t as re,u as ue,ak as se,Z as ie,F as K,R as ce}from"./index-CJB5jCfL.js";import{s as $e,b as Ae,O as X,F as Fe,d as Se}from"./vue-data-ui-8Gmf-dDN.js";import{k as Ee}from"./ColorPicker-BYn8PF2Z-DkxHqz9_.js";import"./alert-I_0TAljB.js";import"./vClickOutside-C6WiFswA-B2BXHGcD.js";const Me={class:B({"vue-ui-pen-and-paper-action":!0}),style:{padding:"0 !important"}},Be=["disabled"],De=["data-mode","xmlns","viewBox"],Ne=["cx","cy","r","fill"],Le=["d","stroke","stroke-width"],Te=["x","y","fill","font-size"],ze=["x","dy"],_e=["d","stroke","stroke-width"],Re={__name:"NonSvgPenAndPaper",props:{parent:{type:HTMLElement},backgroundColor:{type:String,default:"#FFFFFF"},color:{type:String,default:"#2D353C"},active:{type:Boolean,default:!1}},emits:["close"],setup(s,{emit:ve}){const $=s,de=ve,w=i([]),D=i([]),O=i("0 0 0 0"),A=i($.color),L=i(1),y=i("draw"),d=i(null),q=i(!1),k=i(null),T=i({x:0,y:0}),F=i([""]),z=i({row:0,col:0}),S=i(16);let pe=1;function Q(){return pe++}function fe(a){var r;const e=x.value;if(!e)return{x:0,y:0};const t=e.createSVGPoint();let n=a.clientX,l=a.clientY;a.touches&&a.touches.length&&(n=a.touches[0].clientX,l=a.touches[0].clientY),t.x=n,t.y=l;const o=(r=e.getScreenCTM())==null?void 0:r.inverse();return o?t.matrixTransform(o):{x:0,y:0}}function Y(a){if(!d.value||y.value!=="text"||q.value)return;const{x:e,y:t}=fe(a);T.value={x:e,y:t},F.value=[""],z.value={row:0,col:0};const n=document.createElementNS("http://www.w3.org/2000/svg","text");n.setAttribute("x",e),n.setAttribute("y",t),n.setAttribute("fill",A.value),n.setAttribute("font-size",S.value),n.setAttribute("font-family","sans-serif"),n.setAttribute("class","vue-data-ui-doodle"),n.setAttribute("dominant-baseline","hanging"),n.setAttribute("pointer-events","all");const l=document.createElementNS("http://www.w3.org/2000/svg","tspan");l.setAttribute("x",e),l.setAttribute("dy","0"),l.textContent="",n.appendChild(l),n.style.pointerEvents="none",n.style.userSelect="none",d.value.appendChild(n),k.value=n,q.value=!0,window.addEventListener("keydown",G),window.addEventListener("mousedown",H,!0),J(),j()}function G(a){if(!q.value)return;let{row:e,col:t}=z.value,n=F.value.slice(),l=!1;if(a.key==="Enter"){const o=n[e],r=o.slice(0,t),c=o.slice(t);n.splice(e,1,r,c),e+=1,t=0,l=!0,a.preventDefault()}else if(a.key==="Backspace"){if(t>0)n[e]=n[e].slice(0,t-1)+n[e].slice(t),t-=1,l=!0;else if(e>0){const o=n[e-1].length;n[e-1]+=n[e],n.splice(e,1),e-=1,t=o,l=!0}a.preventDefault()}else if(a.key==="Delete")t<n[e].length?(n[e]=n[e].slice(0,t)+n[e].slice(t+1),l=!0):e<n.length-1&&(n[e]+=n[e+1],n.splice(e+1,1),l=!0),a.preventDefault();else if(a.key==="ArrowLeft")t>0?t-=1:e>0&&(e-=1,t=n[e].length),l=!0,a.preventDefault();else if(a.key==="ArrowRight")t<n[e].length?t+=1:e<n.length-1&&(e+=1,t=0),l=!0,a.preventDefault();else if(a.key==="ArrowUp")e>0&&(e-=1,t=Math.min(t,n[e].length),l=!0),a.preventDefault();else if(a.key==="ArrowDown")e<n.length-1&&(e+=1,t=Math.min(t,n[e].length),l=!0),a.preventDefault();else if(a.key.length===1&&!a.ctrlKey&&!a.metaKey&&!a.altKey)n[e]=n[e].slice(0,t)+a.key+n[e].slice(t),t+=1,l=!0,a.preventDefault();else if(a.key==="Escape"){I(!0);return}else a.key==="Tab"&&a.preventDefault();l&&(F.value=n,z.value={row:e,col:t},J(),j())}function J(){const a=k.value,{x:e,y:t}=T.value;for(;a.firstChild;)a.removeChild(a.firstChild);F.value.forEach((n,l)=>{const o=document.createElementNS("http://www.w3.org/2000/svg","tspan");o.setAttribute("x",e),o.setAttribute("dy",l===0?"0":"".concat(S.value*1.2)),o.textContent=n.length?n:"​",a.appendChild(o)})}function j(){const a=d.value.querySelector(".vue-data-ui-svg-caret");a&&d.value.removeChild(a);const e=k.value;if(!e)return;const{x:t,y:n}=T.value,{row:l,col:o}=z.value,r=S.value,c=e.childNodes[l];if(!c)return;let v=c.textContent.slice(0,o);v.endsWith(" ")&&(v+=" ");const u=document.createElementNS("http://www.w3.org/2000/svg","text");u.setAttribute("x",t),u.setAttribute("y",n),u.setAttribute("font-size",r),u.setAttribute("font-family","sans-serif"),u.textContent=v||"",d.value.appendChild(u);const p=u.getBBox();d.value.removeChild(u);let f=n+l*r*1.2,M=t+p.width;const h=document.createElementNS("http://www.w3.org/2000/svg","rect");h.setAttribute("x",M),h.setAttribute("y",f),h.setAttribute("width",1),h.setAttribute("height",r),h.setAttribute("fill",A.value),h.setAttribute("class","vue-data-ui-svg-caret"),d.value.appendChild(h)}function H(a){if(k.value&&!k.value.contains(a.target)){const e=k.value.children;e.length===1&&(e[0].textContent===""||e[0].textContent==="​")&&k.value.remove(),I(!1)}}function I(a=!1){var n;window.removeEventListener("keydown",G),window.removeEventListener("mousedown",H,!0);const e=(n=d.value)==null?void 0:n.querySelector(".vue-data-ui-svg-caret");e&&d.value.removeChild(e);const t=F.value.every(l=>!l||l==="​");a||t||w.value.push({id:Q(),type:"text",x:T.value.x,y:T.value.y,color:A.value,fontSize:S.value,lines:F.value.map(l=>l)}),k.value&&d.value&&d.value.contains(k.value)&&d.value.removeChild(k.value),q.value=!1,k.value=null,F.value=[""],z.value={row:0,col:0}}const E=we(()=>Ae($.color,.6));function P({width:a,height:e}){O.value="0 0 ".concat(a," ").concat(e)}const W=i(null);xe(()=>{be(()=>{if($.parent){W.value=new ResizeObserver(t=>{for(const n of t){const{width:l,height:o}=n.contentRect;P({width:l,height:o})}}),W.value.observe($.parent);const{width:a,height:e}=$.parent.getBoundingClientRect();P({width:a,height:e})}}),d.value=x.value.querySelector("g")}),Ce(()=>{W.value&&W.value.disconnect()}),le(()=>$.parent,a=>{if(!a)return;const{width:e,height:t}=$.parent.getBoundingClientRect();P({width:e,height:t})},{immediate:!0}),le(y,a=>{var e,t;a==="text"?(e=x.value)==null||e.addEventListener("mousedown",Y):(t=x.value)==null||t.removeEventListener("mousedown",Y)});const _=i(!1),R=i(""),x=i(null);function Z(a){if(y.value!=="draw"||!x.value)return;_.value=!0;const{x:e,y:t}=ne(a);R.value="M ".concat(e," ").concat(t)}function ee(a){if(!_.value||!x.value)return;const{x:e,y:t}=ne(a);R.value+=" ".concat(e," ").concat(t)}function te(a){const e=a.trim().split(/\s+/);if(e.length<4)return a;const t=e.slice(1).map(Number);if(t.length%2!==0)return a;const n=he(t),l=["M ".concat(n[0]," ").concat(n[1])];for(let c=2;c<n.length-2;c+=2){const v=n[c-2],u=n[c-1],p=n[c],f=n[c+1],M=(v+p)/2,h=(u+f)/2;l.push("Q ".concat(v," ").concat(u," ").concat(M," ").concat(h))}const o=n[n.length-2],r=n[n.length-1];return l.push("L ".concat(o," ").concat(r)),l.join(" ")}function he(a,e=1){const t=[...a];for(let n=2;n<a.length-2;n+=2){const l=a[n],o=a[n+1],r=a[n-2],c=a[n-1],v=a[n+2],u=a[n+3];t[n]=l+e*((r+v)/2-l),t[n+1]=o+e*((c+u)/2-o)}return t}function ge(a){const e=a.trim().split(/\s+/);let t="",n="",l=null,o=null;for(let r=0;r<e.length;r+=1){const c=e[r];if(isNaN(c)){if(n=c,n==="M"||n==="L")l=parseFloat(e[++r]),o=parseFloat(e[++r]),t+="".concat(n).concat(l," ").concat(o);else if(n==="Q"){const v=parseFloat(e[++r]),u=parseFloat(e[++r]),p=parseFloat(e[++r]),f=parseFloat(e[++r]);v===l&&u===o?t+="t".concat(p-l," ").concat(f-o):t+="q".concat(v-l," ").concat(u-o," ").concat(p-l," ").concat(f-o),l=p,o=f}}else{const v=parseFloat(c),u=parseFloat(e[++r]);if(n==="L"){const p=v-l,f=u-o;p===0?t+="v".concat(f):f===0?t+="h".concat(p):t+="l".concat(p," ").concat(f),l=v,o=u}else if(n==="Q"){const p=v,f=u,M=parseFloat(e[++r]),h=parseFloat(e[++r]);p===l&&f===o?t+="t".concat(M-l," ").concat(h-o):t+="q".concat(p-l," ").concat(f-o," ").concat(M-l," ").concat(h-o),l=M,o=h}}}return t}function U(){_.value&&(w.value.push({id:Q(),strokeWidth:L.value,path:ge(te(R.value)),color:A.value}),D.value=[],R.value=""),_.value=!1}function ne(a){if(!x.value)return{x:0,y:0};const e=x.value.getBoundingClientRect();let t,n;return a.touches&&a.touches.length?(t=a.touches[0].clientX,n=a.touches[0].clientY):(t=a.clientX,n=a.clientY),{x:t-e.left,y:n-e.top}}function me(){if(w.value.length>0){const a=w.value.pop();D.value.push(a)}}function ye(){if(D.value.length>0){const a=D.value.pop();w.value.push(a)}}function ke(){w.value=[],D.value=[]}const ae=i(null);return(a,e)=>(m(),g(K,null,[s.active?(m(),g("div",{key:0,"data-dom-to-png-ignore":"",class:B({"vue-ui-pen-and-paper-actions":!0,visible:s.active}),style:b({backgroundColor:s.backgroundColor})},[C("button",{class:"vue-ui-pen-and-paper-action",style:b({backgroundColor:s.backgroundColor,border:"1px solid ".concat(E.value)}),onClick:e[0]||(e[0]=t=>de("close"))},[N(X,{name:"close",stroke:s.color},null,8,["stroke"])],4),C("button",Me,[N(Ee,{value:A.value,"onUpdate:value":e[1]||(e[1]=t=>A.value=t),backgroundColor:s.backgroundColor,buttonBorderColor:E.value},null,8,["value","backgroundColor","buttonBorderColor"])]),C("button",{class:B(["vue-ui-pen-and-paper-action",{"vue-ui-pen-and-paper-action-active":y.value==="text"}]),onClick:e[2]||(e[2]=t=>y.value=y.value==="text"?"draw":"text"),style:b({backgroundColor:s.backgroundColor,border:"1px solid ".concat(E.value)})},[N(X,{name:y.value==="draw"?"annotator":"text",stroke:s.color},null,8,["name","stroke"]),C("div",{style:b({position:"absolute",bottom:"-20px",color:E.value,width:"100%",textAlign:"center",fontSize:"12px"})},re(ue(Fe)({v:y.value==="draw"?L.value:S.value,s:"px",r:1})),5)],6),C("button",{class:B({"vue-ui-pen-and-paper-action":!0,"vue-ui-pen-and-paper-action-disabled":!w.value.length}),disabled:!w.value.length,style:b({backgroundColor:s.backgroundColor,border:"1px solid ".concat(E.value),marginTop:"20px"}),onClick:me},[N(X,{name:"restart",stroke:s.color},null,8,["stroke"])],14,Be),C("button",{class:B({"vue-ui-pen-and-paper-action":!0,"vue-ui-pen-and-paper-action-disabled":!D.value.length}),style:b({backgroundColor:s.backgroundColor,border:"1px solid ".concat(E.value)}),onClick:ye},[N(X,{name:"restart",stroke:s.color,style:{transform:"scaleX(-1)"}},null,8,["stroke"])],6),C("button",{class:B([{"vue-ui-pen-and-paper-action":!0,"vue-ui-pen-and-paper-action-disabled":!w.value.length},"vue-ui-pen-and-paper-action"]),style:b({backgroundColor:s.backgroundColor,border:"1px solid ".concat(E.value)}),onClick:ke},[N(X,{name:"trash",stroke:s.color},null,8,["stroke"])],6),y.value==="draw"?oe((m(),g("input",{key:0,ref_key:"range",ref:ae,type:"range",class:"vertical-range",min:.5,max:12,step:.1,"onUpdate:modelValue":e[3]||(e[3]=t=>L.value=t),style:b({accentColor:s.color})},null,4)),[[se,L.value]]):V("",!0),y.value==="text"?oe((m(),g("input",{key:1,ref_key:"range",ref:ae,type:"range",class:"vertical-range",min:3,max:48,step:.1,"onUpdate:modelValue":e[4]||(e[4]=t=>S.value=t),style:b({accentColor:s.color})},null,4)),[[se,S.value]]):V("",!0)],6)):V("",!0),(m(),g("svg",{"data-mode":y.value,ref_key:"svgElement",ref:x,xmlns:ue(Se),viewBox:O.value,class:B({"vue-ui-pen-and-paper":!0,inactive:!s.active}),onMousedown:Z,onMousemove:ee,onMouseup:U,onMouseleave:U,onTouchstart:ie(Z,["prevent"]),onTouchmove:ie(ee,["prevent"]),onTouchend:U},[C("g",{ref_key:"G",ref:d},[(m(!0),g(K,null,ce(w.value,t=>(m(),g(K,{key:t.id},[t.path&&t.path.replace("M","").split(" ").length===2?(m(),g("circle",{key:0,cx:t.path.replace("M","").split(" ")[0],cy:t.path.replace("M","").split(" ")[1],r:t.strokeWidth/2,fill:t.color},null,8,Ne)):t.path?(m(),g("path",{key:1,class:"vue-ui-pen-and-paper-path",d:t.path,stroke:t.color,"stroke-width":t.strokeWidth,fill:"none"},null,8,Le)):t.type==="text"?(m(),g("text",{key:2,x:t.x,y:t.y,fill:t.color,"font-size":t.fontSize,"font-family":"sans-serif","dominant-baseline":"hanging",class:"vue-ui-pen-and-paper-text"},[(m(!0),g(K,null,ce(t.lines,(n,l)=>(m(),g("tspan",{key:l,x:t.x,dy:l===0?"0":t.fontSize*1.2},re(n.length?n:"​"),9,ze))),128))],8,Te)):V("",!0)],64))),128))],512),_.value?(m(),g("path",{key:0,class:"vue-ui-pen-and-paper-path vue-ui-pen-and-paper-path-drawing",d:te(R.value),stroke:A.value,"stroke-width":L.value*1.1,fill:"none"},null,8,_e)):V("",!0)],42,De))],64))}},Pe=$e(Re,[["__scopeId","data-v-14478ba4"]]);export{Pe as default};
