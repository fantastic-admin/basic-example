
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * https://fantastic-admin.hurui.me
 */
    
import{y as A}from"./vue-data-ui-BN9YfUec.js";async function E(e){const n=e.querySelectorAll("img"),c=Array.from(n).map(t=>new Promise(r=>{if(!t.src||t.src.startsWith("data:"))return r();if(t.complete&&t.naturalWidth!==0){try{const o=document.createElement("canvas");o.width=t.naturalWidth,o.height=t.naturalHeight,o.getContext("2d").drawImage(t,0,0),t.src=o.toDataURL()}catch(o){}return r()}const s=new window.Image;s.crossOrigin="anonymous",s.onload=function(){try{const o=document.createElement("canvas");o.width=s.naturalWidth,o.height=s.naturalHeight,o.getContext("2d").drawImage(s,0,0),t.src=o.toDataURL()}catch(o){}r()},s.onerror=function(){r()},s.src=t.src}));await Promise.all(c)}function P(e){e.querySelectorAll("[data-dom-to-png-ignore]").forEach(n=>{n.remove()})}function x(e,n,c){const t=window.getComputedStyle(n),r=n.getBoundingClientRect(),s=t.display.includes("flex");let o={},a=e.getAttribute("style");typeof a!="string"&&(a=""),a.split(";").forEach(l=>{if(typeof l=="string"&&l.trim()){const[d,h]=l.split(":");d&&h!==void 0&&(o[d.trim()]=h.trim())}});for(let l=0;l<t.length;l+=1){const d=t[l],h=t.getPropertyValue(d);o[d]=h}o.color=t.color,o["background-color"]=t.backgroundColor;let i=t.fontFamily||c||"";(!i||i.trim()===""||i==="inherit"||i==="initial"||i.toLowerCase().startsWith("system-ui")||i.toLowerCase()==="sans-serif"||i.toLowerCase()==="serif"||i.toLowerCase()==="monospace")&&(i="Helvetica, Arial, sans-serif"),o["font-family"]=i,o["font-size"]=t.fontSize,o["font-weight"]=t.fontWeight,(s||t.display.includes("grid")||["inline-block","absolute","fixed"].includes(t.position))&&(r.width>0&&(o.width=r.width+"px"),r.height>0&&(o.height=r.height+"px")),s&&t.flexWrap==="nowrap"&&(o["white-space"]="nowrap"),["box-sizing","padding","margin","border"].forEach(l=>{o[l]=t.getPropertyValue(l)}),o.overflow="visible",o["overflow-x"]="visible",o["overflow-y"]="visible";let f="";for(const l in o)f+="".concat(l,":").concat(o[l],";");e.setAttribute("style",f);const w=e.children||[],y=n.children||[];for(let l=0;l<w.length;l++)w[l].nodeType===1&&y[l]&&x(w[l],y[l],i)}function W(e,n){e.querySelectorAll("text").forEach(c=>{c.setAttribute("font-family",n),c.style.fontFamily=n})}function F(e){const n=new TextEncoder().encode(e);let c="";return n.forEach(t=>c+=String.fromCharCode(t)),btoa(c)}function j(e,n,c){let t=new XMLSerializer().serializeToString(e);t.match(/^<svg[^>]+xmlns="http\:\/\/www\.w3\.org\/2000\/svg"/)||(t=t.replace(/^<svg/,'<svg xmlns="http://www.w3.org/2000/svg"'));const r=window.btoa(unescape(encodeURIComponent(t))),s=new window.Image;return s.src="data:image/svg+xml;base64,".concat(r),new Promise((o,a)=>{s.onload=function(){const i=document.createElement("canvas");i.width=n,i.height=c,i.getContext("2d").drawImage(s,0,0,n,c),o(i.toDataURL("image/png",1))},s.onerror=i=>a(i)})}function R(e){if(e.nodeType!==1)return;const n=window.getComputedStyle(e);let c="";for(let t=0;t<n.length;t++){const r=n[t];c+="".concat(r,":").concat(n.getPropertyValue(r),";")}e.setAttribute("style",c);for(let t=0;t<e.children.length;t++)R(e.children[t])}function I(){const e=[];for(const n of document.styleSheets)try{const c=n.cssRules;if(!c)continue;for(const t of c)(typeof CSSFontFaceRule<"u"&&t instanceof CSSFontFaceRule||t.cssText.trim().startsWith("@font-face"))&&e.push(t.cssText)}catch(c){continue}return e}function M(e){const n=I();if(!n.length)return;const c=document.createElement("style");c.setAttribute("type","text/css"),c.textContent=n.join("\n");const t=e.querySelector("defs")||document.createElementNS(A,"defs");t.appendChild(c),e.querySelector("defs")||e.insertBefore(t,e.firstChild)}function z(e,n){const c=e.querySelectorAll("foreignObject"),t=n.querySelectorAll("foreignObject");c.forEach((r,s)=>{const o=t[s];if(!o)return;function a(i,f){if(!i||!f)return;if(i.nodeType===1&&f.nodeType===1){const l=window.getComputedStyle(f);let d="";for(let h=0;h<l.length;h++){const C=l[h];d+="".concat(C,":").concat(l.getPropertyValue(C),";")}i.setAttribute("style",d)}const w=i.children||[],y=f.children||[];for(let l=0;l<w.length;l++)a(w[l],y[l])}a(r,o)})}function B(e){e.querySelectorAll("foreignObject").forEach(n=>{let c="";const t=Array.from(n.querySelectorAll("*"));if(t.length!==0){for(const r of document.styleSheets){let s;try{s=r.cssRules}catch(o){continue}if(s){for(const o of s)if(!(typeof CSSStyleRule<"u"&&!(o instanceof CSSStyleRule)))try{t.some(a=>a.matches(o.selectorText))&&(c+=o.cssText+"\n")}catch(a){continue}}}if(c){const r=document.createElement("style");r.textContent=c,n.insertBefore(r,n.firstChild)}}})}function H(e){e.querySelectorAll("foreignObject").forEach(n=>{const c=n.firstElementChild;c&&c.tagName.toLowerCase()!=="svg"&&c.setAttribute("xmlns","http://www.w3.org/1999/xhtml")})}function N(e,n){const c=e.querySelectorAll("foreignObject"),t=n.querySelectorAll("foreignObject");c.forEach((r,s)=>{const o=t[s];if(!r||!o)return;const a=r.firstElementChild,i=o.firstElementChild;a&&i&&$(a,i)})}function $(e,n){if(e.nodeType!==1||!n)return;x(e,n);const c=e.children||[],t=n.children||[];for(let r=0;r<c.length;r++)$(c[r],t[r])}function q(e,n){const c=Array.from(n.querySelectorAll("img"));e.querySelectorAll("img").forEach(t=>{const r=t.getAttribute("src"),s=c.find(o=>o.getAttribute("src")===r);if(s){const o=window.getComputedStyle(s);let a="";for(let i=0;i<o.length;i++){const f=o[i];a+="".concat(f,":").concat(o.getPropertyValue(f),";")}t.setAttribute("style",a)}})}async function V({container:e,scale:n=2,base64:c=!1}){if(!e)throw new Error("No container provided");await document.fonts.ready;let t=window.getComputedStyle(e).fontFamily||"Helvetica";t.toLowerCase().includes("helvetica")||(t+=", Helvetica");const r=e.cloneNode(!0),s=r.querySelectorAll("canvas"),o=e.querySelectorAll("canvas");for(let m=0;m<o.length;m+=1){const u=o[m],g=s[m];if(u&&g){const p=document.createElement("img");p.src=u.toDataURL("image/png"),p.width=u.width,p.height=u.height,p.style.width=u.style.width||u.width+"px",p.style.height=u.style.height||u.height+"px",g.replaceWith(p)}}const a=e.querySelector("svg[aria-label]"),i=r.querySelector("svg[aria-label]");if(a&&i){H(i),B(i),z(i,a),N(i,a),R(i),W(i,t),q(i,a),await E(i);const m=a.getBoundingClientRect(),u=m.width,g=m.height,p=Math.round(u*n),T=Math.round(g*n),O=await j(i,p,T),S=document.createElement("img");S.src=O,S.width=u,S.height=g,S.style.width=u+"px",S.style.height=g+"px",i.parentNode.replaceChild(S,i)}x(r,e,t),q(r,e),P(r),await E(r);const{width:f,height:w}=e.getBoundingClientRect(),y=Math.round(Math.max(r.scrollWidth,f)*n),l=Math.round(Math.max(r.scrollHeight,w)*1.01*n),d=document.createElementNS(A,"svg");d.setAttribute("viewBox","0 0 ".concat(y," ").concat(l)),d.setAttribute("width",y),d.setAttribute("height",l),d.setAttribute("style","font-family:".concat(t,";"));const h=document.createElementNS(A,"foreignObject");h.setAttribute("x",0),h.setAttribute("y",0),h.setAttribute("width",y),h.setAttribute("height",l),h.setAttribute("style","font-family:".concat(t,";")),r.style.transform="scale(".concat(n,")"),r.style.transformOrigin="top left",r.style.width=f+"px",r.style.height=w+"px",r.style.background=window.getComputedStyle(e).backgroundColor,h.appendChild(r),M(d),d.appendChild(h);const C=new XMLSerializer().serializeToString(d),L=F(C),b=new window.Image;b.crossOrigin="anonymous";const v="data:image/svg+xml;base64,".concat(L);return b.src=v,c?new Promise(m=>{m(v)}):new Promise((m,u)=>{b.onload=function(){try{const g=document.createElement("canvas");g.width=y,g.height=l,g.getContext("2d").drawImage(b,0,0,y,l),m(g.toDataURL("image/png",1))}catch(g){u("Failed to draw SVG on canvas: "+g)}},b.onerror=function(){u("Failed to load SVG image for conversion")}})}export{V as k};
