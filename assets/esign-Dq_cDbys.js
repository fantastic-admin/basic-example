
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * https://fantastic-admin.hurui.me
 */
    
import{B as D,c as p,o as x,d as _,am as B,e as C,g as l,h as v,p as k,l as g,G as M,f as m,Q as R,A as S,u as f,P as E,aa as I,an as X,C as y}from"./index-CJB5jCfL.js";import Y from"./alert-I_0TAljB.js";import{_ as P}from"./command.vue_vue_type_script_setup_true_lang-R3ZD5J4P.js";import"./index.vue_vue_type_script_setup_true_lang-CP_Tumhm.js";const N={props:{width:{type:Number,default:800},height:{type:Number,default:300},lineWidth:{type:Number,default:4},lineColor:{type:String,default:"#000000"},bgColor:{type:String,default:""},isCrop:{type:Boolean,default:!1},isClearBgColor:{type:Boolean,default:!0},format:{type:String,default:"image/png"},quality:{type:Number,default:1}},data(){return{hasDrew:!1,resultImg:"",points:[],canvasTxt:null,startX:0,startY:0,isDrawing:!1,sratio:1}},computed:{ratio(){return this.height/this.width},stageInfo(){return this.$refs.canvas.getBoundingClientRect()},myBg(){return this.bgColor?this.bgColor:"rgba(255, 255, 255, 0)"}},watch:{myBg:function(t){this.$refs.canvas.style.background=t}},beforeMount(){window.addEventListener("resize",this.$_resizeHandler)},beforeDestroy(){window.removeEventListener("resize",this.$_resizeHandler)},mounted(){const t=this.$refs.canvas;t.height=this.height,t.width=this.width,t.style.background=this.myBg,this.$_resizeHandler(),document.onmouseup=()=>{this.isDrawing=!1}},methods:{$_resizeHandler(){const t=this.$refs.canvas;t.style.width=this.width+"px";const e=parseFloat(window.getComputedStyle(t).width);t.style.height=this.ratio*e+"px",this.canvasTxt=t.getContext("2d"),this.canvasTxt.scale(1*this.sratio,1*this.sratio),this.sratio=e/this.width,this.canvasTxt.scale(1/this.sratio,1/this.sratio)},mouseDown(t){t=t||event,t.preventDefault(),this.isDrawing=!0,this.hasDrew=!0;let e={x:t.offsetX,y:t.offsetY};this.drawStart(e)},mouseMove(t){if(t=t||event,t.preventDefault(),this.isDrawing){let e={x:t.offsetX,y:t.offsetY};this.drawMove(e)}},mouseUp(t){t=t||event,t.preventDefault();let e={x:t.offsetX,y:t.offsetY};this.drawEnd(e),this.isDrawing=!1},touchStart(t){if(t=t||event,t.preventDefault(),this.hasDrew=!0,t.touches.length===1){let e={x:t.targetTouches[0].clientX-this.$refs.canvas.getBoundingClientRect().left,y:t.targetTouches[0].clientY-this.$refs.canvas.getBoundingClientRect().top};this.drawStart(e)}},touchMove(t){if(t=t||event,t.preventDefault(),t.touches.length===1){let e={x:t.targetTouches[0].clientX-this.$refs.canvas.getBoundingClientRect().left,y:t.targetTouches[0].clientY-this.$refs.canvas.getBoundingClientRect().top};this.drawMove(e)}},touchEnd(t){if(t=t||event,t.preventDefault(),t.touches.length===1){let e={x:t.targetTouches[0].clientX-this.$refs.canvas.getBoundingClientRect().left,y:t.targetTouches[0].clientY-this.$refs.canvas.getBoundingClientRect().top};this.drawEnd(e)}},drawStart(t){this.startX=t.x,this.startY=t.y,this.canvasTxt.beginPath(),this.canvasTxt.moveTo(this.startX,this.startY),this.canvasTxt.lineTo(t.x,t.y),this.canvasTxt.lineCap="round",this.canvasTxt.lineJoin="round",this.canvasTxt.lineWidth=this.lineWidth*this.sratio,this.canvasTxt.stroke(),this.canvasTxt.closePath(),this.points.push(t)},drawMove(t){this.canvasTxt.beginPath(),this.canvasTxt.moveTo(this.startX,this.startY),this.canvasTxt.lineTo(t.x,t.y),this.canvasTxt.strokeStyle=this.lineColor,this.canvasTxt.lineWidth=this.lineWidth*this.sratio,this.canvasTxt.lineCap="round",this.canvasTxt.lineJoin="round",this.canvasTxt.stroke(),this.canvasTxt.closePath(),this.startY=t.y,this.startX=t.x,this.points.push(t)},drawEnd(t){this.canvasTxt.beginPath(),this.canvasTxt.moveTo(this.startX,this.startY),this.canvasTxt.lineTo(t.x,t.y),this.canvasTxt.lineCap="round",this.canvasTxt.lineJoin="round",this.canvasTxt.stroke(),this.canvasTxt.closePath(),this.points.push(t),this.points.push({x:-1,y:-1})},generate(t){let e=t&&t.format?t.format:this.format,n=t&&t.quality?t.quality:this.quality;return new Promise((u,a)=>{if(!this.hasDrew){a("Warning: Not Signned!");return}var i=this.canvasTxt.getImageData(0,0,this.$refs.canvas.width,this.$refs.canvas.height);this.canvasTxt.globalCompositeOperation="destination-over",this.canvasTxt.fillStyle=this.myBg,this.canvasTxt.fillRect(0,0,this.$refs.canvas.width,this.$refs.canvas.height),this.resultImg=this.$refs.canvas.toDataURL(e,n);var c=this.resultImg;if(this.canvasTxt.clearRect(0,0,this.$refs.canvas.width,this.$refs.canvas.height),this.canvasTxt.putImageData(i,0,0),this.canvasTxt.globalCompositeOperation="source-over",this.isCrop){const s=this.getCropArea(i.data);var o=document.createElement("canvas");const h=o.getContext("2d");o.width=s[2]-s[0],o.height=s[3]-s[1];const d=this.canvasTxt.getImageData(...s);h.globalCompositeOperation="destination-over",h.putImageData(d,0,0),h.fillStyle=this.myBg,h.fillRect(0,0,o.width,o.height),c=o.toDataURL(e,n),o=null}u(c)})},reset(){this.canvasTxt.clearRect(0,0,this.$refs.canvas.width,this.$refs.canvas.height),this.isClearBgColor&&(this.$emit("update:bgColor",""),this.$refs.canvas.style.background="rgba(255, 255, 255, 0)"),this.points=[],this.hasDrew=!1,this.resultImg=""},getCropArea(t){for(var e=this.$refs.canvas.width,n=0,r=this.$refs.canvas.height,u=0,a=0;a<this.$refs.canvas.width;a++)for(var i=0;i<this.$refs.canvas.height;i++){var c=(a+this.$refs.canvas.width*i)*4;(t[c]>0||t[c+1]>0||t[c+2]||t[c+3]>0)&&(u=Math.max(i,u),n=Math.max(a,n),r=Math.min(i,r),e=Math.min(a,e))}return e++,n++,r++,u++,[e,r,n,u]}}};function W(t,e,n,r,u,a){return x(),p("canvas",{ref:"canvas",onMousedown:e[0]||(e[0]=(...i)=>a.mouseDown&&a.mouseDown(...i)),onMousemove:e[1]||(e[1]=(...i)=>a.mouseMove&&a.mouseMove(...i)),onMouseup:e[2]||(e[2]=(...i)=>a.mouseUp&&a.mouseUp(...i)),onTouchstart:e[3]||(e[3]=(...i)=>a.touchStart&&a.touchStart(...i)),onTouchmove:e[4]||(e[4]=(...i)=>a.touchMove&&a.touchMove(...i)),onTouchend:e[5]||(e[5]=(...i)=>a.touchEnd&&a.touchEnd(...i))},null,544)}const w=D(N,[["render",W],["__scopeId","data-v-1fcc7cb1"]]);w.install=function(t){this.installed||(this.installed=!0,t.component("vueEsign",w))};const z={class:"space-y-2"},F={class:"space-x-2"},U=["src"],A=_({name:"ComponentExampleSignCanvas",__name:"esign",setup(t){const e=B("esignRef"),n=C({lineWidth:6,lineColor:"#000000",bgColor:"#f0f0f0",isCrop:!1}),r=C("");function u(){e.value.reset(),I(()=>{n.value.bgColor="#f0f0f0"})}function a(){e.value.generate().then(o=>{r.value=o}).catch(()=>{X.warning("画板为空，无法生成图片")})}function i(){e.value.generate().then(o=>{const s=new Image;s.setAttribute("crossOrigin","anonymous"),s.onload=()=>{const h=document.createElement("a"),d=new MouseEvent("click");h.download=Date.parse(new Date().toString()).toString(),h.href=s.src,h.dispatchEvent(d)},s.src=o})}function c(o){window.open(o,"_blank")}return(o,s)=>{const h=M,d=k,b=R,$=E;return x(),p("div",null,[l(Y),l(b,{title:"电子签名"},{description:v(()=>[m("p",null,[s[2]||(s[2]=g(" 安装命令： ",-1)),l(P,{text:"pnpm add vue-esign"})])]),default:v(()=>[l(d,{variant:"outline",onClick:s[0]||(s[0]=T=>c("https://github.com/JaimeCheng/vue-esign"))},{default:v(()=>[l(h,{name:"i-ep:link"}),s[3]||(s[3]=g(" 访问 vue-esign ",-1))]),_:1})]),_:1}),l($,null,{default:v(()=>[m("div",z,[l(f(w),{ref_key:"esignRef",ref:e,"bg-color":f(n).bgColor,"onUpdate:bgColor":s[1]||(s[1]=T=>f(n).bgColor=T),width:500,height:300,"is-crop":f(n).isCrop,"line-width":f(n).lineWidth,"line-color":f(n).lineColor},null,8,["bg-color","is-crop","line-width","line-color"]),m("div",F,[l(d,{onClick:u},{default:v(()=>[...s[4]||(s[4]=[g(" 清空画板 ",-1)])]),_:1}),l(d,{onClick:a},{default:v(()=>[...s[5]||(s[5]=[g(" 生成图片 ",-1)])]),_:1}),l(d,{onClick:i},{default:v(()=>[...s[6]||(s[6]=[g(" 下载图片 ",-1)])]),_:1})]),f(r)?(x(),p("img",{key:0,src:f(r),width:500,height:300},null,8,U)):S("",!0)])]),_:1})])}}});typeof y=="function"&&y(A);export{A as default};
