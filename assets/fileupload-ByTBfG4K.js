
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * https://fantastic-admin.hurui.me
 */
    
import{d as R,a4 as j,a5 as I,al as N,e as B,c as r,o as l,f as v,A as m,r as P,g as u,G as A,l as E,u as h,n as U,t as k,F as G,R as H,z as V,O as q,h as b,p as Q,Y as O,am as F,an as Y,Q as J,i as T,P as K,C as M}from"./index-DXZKKOp8.js";import{_ as W}from"./index-BPiuBre8.js";import{f as w}from"./filesize-BlNqgPst.js";const X={class:"space-y-2"},Z=["disabled"],ee=["multiple","disabled"],te={key:0,class:"flex flex-wrap gap-1 text-xs text-card-foreground/50 empty:hidden"},ae={key:0,class:"after:content-[';_'] last:after:content-empty"},se={key:1,class:"after:content-[';_'] last:after:content-empty"},oe={key:2,class:"after:content-[';_'] last:after:content-empty"},le={key:1,class:"grid grid-cols-[repeat(auto-fill,minmax(200px,1fr))] gap-2"},ne=["onClick"],re={class:"flex-1 truncate"},ie={class:"truncate text-sm font-medium"},de={class:"text-xs text-card-foreground/50"},ue={key:1,class:"size-10 flex-center"},ce={key:2,class:"size-10 flex-center"},fe=R({name:"FaFileUpload",__name:"index",props:j({action:{},method:{default:"post"},headers:{default:()=>({})},data:{default:()=>({})},name:{default:"file"},afterUpload:{},multiple:{type:Boolean,default:!1},ext:{default:()=>[]},size:{default:10*1024*1024},max:{default:0},hideTips:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1}},{modelValue:{required:!0},modelModifiers:{}}),emits:j(["onSuccess","onClick"],["update:modelValue"]),setup($,{emit:x}){const e=$,y=x,n=I($,"modelValue"),_=N("fileInputRef"),c=B(!1);function D(a){a.preventDefault(),!e.disabled&&(c.value=!0)}function z(a){a.preventDefault(),c.value=!1}function C(a){var s;a.preventDefault(),!e.disabled&&(c.value=!1,(s=a.dataTransfer)!=null&&s.files&&d(a.dataTransfer.files))}function d(a){var p;if(!a)return;const s=Array.from(a),i=e.max>0?e.max-n.value.length:s.length,f=[];for(const t of s.slice(0,i)){if(e.ext.length>0){const o=(p=t.name.split(".").pop())==null?void 0:p.toLowerCase();if(!e.ext.map(g=>g.toLowerCase()).includes(o||"")){F.error("上传文件只支持 ".concat(e.ext.join(" / ")," 格式"));continue}}if(e.size>0&&t.size>e.size){F.error("上传文件大小不能超过 ".concat(w(e.size,{standard:"jedec"})));continue}f.push(t)}_.value.value="",f.forEach(t=>S(t))}function S(a,s){const i=new FormData;Object.entries(e.data).forEach(([t,o])=>{i.append(t,o)}),i.append(e.name,a);let f={};e.headers instanceof Headers?e.headers.forEach((t,o)=>{f[o]=t}):f={...e.headers},s===void 0&&n.value.push({name:a.name,size:a.size,status:"uploading",progress:0,file:a});const p=s!=null?s:n.value.length-1;Y({url:e.action,method:e.method,headers:f,data:i,onUploadProgress:t=>{t.total&&(n.value[p].progress=Math.round(t.loaded*100/t.total))}}).then(async t=>{var g;const o=await((g=e.afterUpload)==null?void 0:g.call(e,t.data));o&&(n.value[p].url=o),y("onSuccess",t.data,a),n.value[p].status="success"}).catch(()=>{n.value[p].status="error"})}function L(a){n.value.splice(a,1)}return(a,s)=>{const i=A,f=Q,p=W;return l(),r("div",X,[v("button",{type:"button",class:U(["h-40 w-full flex flex-col cursor-pointer items-center justify-center border border-2 rounded-lg border-dashed bg-transparent p-4 transition-all",{"border-primary bg-primary/5":h(c),"opacity-50 cursor-not-allowed":e.disabled||e.max>0&&n.value.length>=e.max}]),disabled:e.disabled||e.max>0&&n.value.length>=e.max,onDragover:D,onDragleave:z,onDrop:C,onClick:s[1]||(s[1]=t=>{var o;return(o=h(_))==null?void 0:o.click()})},[P(a.$slots,"default",{},()=>[u(i,{name:"i-icon-park-outline:upload",class:"mb-2 text-2xl text-card-foreground/50"}),s[2]||(s[2]=v("div",{class:"text-sm text-card-foreground/70"},[E(" 将文件拖到此处，或"),v("span",{class:"cursor-pointer text-primary font-bold"},"点击上传")],-1))]),v("input",{ref_key:"fileInputRef",ref:_,type:"file",multiple:e.multiple,disabled:e.disabled,class:"hidden",onChange:s[0]||(s[0]=t=>d(t.target.files))},null,40,ee)],42,Z),!e.hideTips&&!e.disabled?(l(),r("div",te,[e.ext.length>0?(l(),r("div",ae,k("支持 ".concat(e.ext.join(" / ")," 格式")),1)):m("",!0),e.size>0?(l(),r("div",se,k("大小不超过 ".concat(h(w)(e.size,{standard:"jedec"}))),1)):m("",!0),e.max>0?(l(),r("div",oe,k("数量不超过 ".concat(e.max," 个")),1)):m("",!0)])):m("",!0),n.value.length>0?(l(),r("div",le,[(l(!0),r(G,null,H(n.value,(t,o)=>(l(),r("div",{key:t.name+o,class:U(["group/file-upload-item relative flex items-center gap-2 border rounded-lg py-2 pe-2 ps-3",[t.status==="error"?"border-red-500 bg-red-500/10":""]]),onClick:g=>y("onClick",t,o)},[v("div",re,[v("div",ie,k(t.name),1),v("div",de,k(h(w)(t.size,{standard:"jedec"})),1)]),t.status==="uploading"?(l(),r("div",{key:0,class:"pointer-events-none absolute inset-0 z-0 bg-primary/5",style:q({width:"".concat(t.progress,"%")})},null,4)):t.status==="success"?(l(),r("div",ue,[u(i,{name:"i-ix:upload-success",class:"text-lg text-green-600"})])):t.status==="error"?(l(),r("div",ce,[u(i,{name:"i-ix:upload-fail",class:"text-lg text-red-600"})])):m("",!0),e.disabled?m("",!0):(l(),V(p,{key:3,class:"absolute inset-e-2 top-1/2 opacity-0 transition-opacity -translate-y-1/2 group-hover/file-upload-item:opacity-100"},{default:b(()=>[t.status==="error"?(l(),V(f,{key:0,variant:"outline",size:"icon",onClick:O(g=>S(t.file,o),["stop"])},{default:b(()=>[u(i,{name:"i-icon-park-outline:upload",class:"cursor-pointer text-lg"})]),_:1},8,["onClick"])):m("",!0),t.status!=="uploading"?(l(),V(f,{key:1,variant:"outline",size:"icon",onClick:O(g=>L(o),["stop"])},{default:b(()=>[u(i,{name:"i-icon-park-outline:delete",class:"cursor-pointer text-lg text-red-500"})]),_:1},8,["onClick"])):m("",!0)]),_:2},1024))],10,ne))),128))])):m("",!0)])}}}),pe=R({__name:"fileupload",setup($){const x=B([]),e=B([{name:"logo.svg",size:1024*1024,url:"https://fantastic-admin.hurui.me/logo.svg"}]);function y(){F.success("模拟上传成功")}function n(_){F.info(_.name,{description:_.url})}return(_,c)=>{const D=J,z=fe,C=K;return l(),r("div",null,[u(D,{title:"文件上传",description:"FaFileUpload"}),u(C,null,{default:b(()=>[u(z,{modelValue:h(x),"onUpdate:modelValue":c[0]||(c[0]=d=>T(x)?x.value=d:null),action:"/mock/upload","after-upload":d=>d.data.url,multiple:"",onOnSuccess:y},null,8,["modelValue","after-upload"])]),_:1}),u(C,{title:"限制上传数量、大小、类型、点击事件"},{default:b(()=>[u(z,{modelValue:h(e),"onUpdate:modelValue":c[1]||(c[1]=d=>T(e)?e.value=d:null),action:"/mock/upload","after-upload":d=>d.data.url,multiple:"",ext:["png"],size:200*1024,max:5,onOnSuccess:y,onOnClick:n},null,8,["modelValue","after-upload"])]),_:1})])}}});typeof M=="function"&&M(pe);export{pe as default};
