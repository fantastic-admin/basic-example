
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * https://fantastic-admin.hurui.me
 */
    
import{d as H,a4 as O,a5 as G,e as C,al as Q,c as u,o as d,f as h,A as v,F as Y,R as J,O as D,w as T,Y as A,g as r,G as q,v as L,n as B,u as i,a as N,r as K,z as W,t as V,am as j,an as X,Q as Z,h as F,i as M,P as ee,C as E}from"./index-DXZKKOp8.js";import{_ as te}from"./index.vue_vue_type_script_setup_true_lang-CMEZKuTc.js";import{f as S}from"./filesize-BlNqgPst.js";import{u as ae}from"./index-CWidRyK7.js";import"./nullish-CHIgUVhi.js";import"./index-BPiuBre8.js";const oe={class:"space-y-2"},le={class:"flex flex-wrap gap-2"},se=["src"],ne={key:0,class:"absolute inset-0 grid grid-cols-2 place-items-center rounded-lg bg-black/50 p-2 text-white opacity-0 transition-opacity group-hover/image-upload:opacity-100"},ie=["onClick"],re=["onClick"],ce=["onClick"],de=["onClick"],ue=["disabled"],fe={class:"size-full flex-center border border-2 rounded-lg border-dashed p-0 text-primary"},pe=["multiple"],me={key:0,class:"flex flex-wrap gap-1 text-xs text-card-foreground/50 empty:hidden"},he={key:0,class:"after:content-[';_'] last:after:content-empty"},ve={key:1,class:"after:content-[';_'] last:after:content-empty"},_e={key:2,class:"after:content-[';_'] last:after:content-empty"},ge={key:3,class:"after:content-[';_'] last:after:content-empty"},ye=H({__name:"index",props:O({action:{},method:{default:"post"},headers:{default:()=>({})},data:{default:()=>({})},name:{default:"file"},afterUpload:{},multiple:{type:Boolean,default:!1},ext:{default:()=>[]},max:{default:1},width:{default:100},height:{default:100},dimension:{},size:{default:5*1024*1024},hideTips:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1}},{modelValue:{required:!0},modelModifiers:{}}),emits:O(["onSuccess"],["update:modelValue"]),setup(U,{emit:y}){const e=U,w=y,t=G(U,"modelValue"),_=C(!1),n=C(0),k=Q("fileInputRef");function x(a){var z;const p=a.target;if(!p.files)return;const m=Array.from(p.files),P=e.max===0?m.length:e.max-t.value.length,$=[];for(const s of m.slice(0,P)){if(s.size/1024/1024>e.size){j.error("上传图片大小不能超过 ".concat(S(e.size,{standard:"jedec"})));return}if(e.ext.length>0){const f=(z=s.name.split(".").pop())==null?void 0:z.toLowerCase();if(!e.ext.map(c=>c.toLowerCase()).includes(f||"")){j.error("上传图片只支持 ".concat(e.ext.join(" / ")," 格式"),{description:s.name});continue}}if(e.size>0&&s.size>e.size){j.error("上传图片大小不能超过 ".concat(S(e.size,{standard:"jedec"})),{description:"".concat(s.name," (").concat(S(s.size,{standard:"jedec"}),")")});continue}$.push(s)}k.value.value="",$.forEach(s=>{_.value=!0,n.value=0;const o=new FormData;Object.entries(e.data).forEach(([c,g])=>{o.append(c,g)}),o.append(e.name,s);let f={};return e.headers instanceof Headers?e.headers.forEach((c,g)=>{f[g]=c}):f={...e.headers},X({url:e.action,method:e.method,headers:f,data:o,onUploadProgress:c=>{c.total&&(n.value=Math.round(c.loaded*100/c.total))}}).then(async c=>{var R;const g=await((R=e.afterUpload)==null?void 0:R.call(e,c.data));g&&t.value.push(g),w("onSuccess",c.data,s)}).finally(()=>{_.value=!1,n.value=0})})}function b(a){t.value.splice(a,1)}function I(a){ae().open(t.value,a)}function l(a,p){p==="forward"&&a!==0&&(t.value[a]=t.value.splice(a-1,1,t.value[a])[0]),p==="backward"&&a!==t.value.length-1&&(t.value[a]=t.value.splice(a+1,1,t.value[a])[0])}return(a,p)=>{var $,z;const m=q,P=te;return d(),u("div",oe,[h("div",le,[(d(!0),u(Y,null,J(t.value,(s,o)=>(d(),u("div",{key:s,class:"group/image-upload relative flex items-center justify-center overflow-hidden border rounded-lg",style:D({width:"".concat(e.width,"px"),height:"".concat(e.height,"px")})},[h("img",{src:s,class:"h-full w-full object-contain"},null,8,se),e.disabled?v("",!0):(d(),u("div",ne,[h("div",{class:"flex-center cursor-pointer opacity-60 transition-all hover:scale-110 hover:opacity-100",onClick:A(f=>I(o),["prevent"])},[r(m,{name:"i-icon-park-outline:preview-open",class:"size-6"})],8,ie),h("div",{class:"flex-center cursor-pointer opacity-60 transition-all hover:scale-110 hover:opacity-100",onClick:A(f=>b(o),["prevent"])},[r(m,{name:"i-icon-park-outline:delete",class:"size-6"})],8,re),T(h("div",{class:B(i(N)("flex-center cursor-pointer opacity-60 transition-all",{"hover:scale-110 hover:opacity-100":o!==0,"cursor-not-allowed":o===0})),onClick:f=>l(o,"forward")},[r(m,{name:"i-icon-park-outline:arrow-circle-left",class:"size-6"})],10,ce),[[L,t.value.length>1]]),T(h("div",{class:B(i(N)("flex-center cursor-pointer opacity-60 transition-all",{"hover:scale-110 hover:opacity-100":o!==t.value.length-1,"cursor-not-allowed":o===t.value.length-1})),onClick:f=>l(o,"backward")},[r(m,{name:"i-icon-park-outline:arrow-circle-right",class:"size-6"})],10,de),[[L,t.value.length>1]])]))],4))),128)),t.value.length<e.max||e.max===0?(d(),u("button",{key:0,type:"button",class:B(["relative flex-center overflow-hidden bg-transparent",{"cursor-not-allowed":e.disabled||i(_)}]),style:D({width:"".concat(e.width,"px"),height:"".concat(e.height,"px")}),disabled:e.disabled||i(_),onClick:p[0]||(p[0]=s=>{var o;return(o=i(k))==null?void 0:o.click()})},[K(a.$slots,"default",{},()=>[h("div",fe,[r(m,{name:"i-icon-park-outline:upload",class:"text-2xl text-card-foreground/50"})])]),i(_)&&i(n)>0&&i(n)<100?(d(),W(P,{key:0,"model-value":i(n),class:"absolute inset-x-1 inset-b-1 h-1 w-auto"},null,8,["model-value"])):v("",!0),h("input",{ref_key:"fileInputRef",ref:k,type:"file",accept:"image/*",multiple:e.multiple,class:"hidden",onChange:x},null,40,pe)],14,ue)):v("",!0)]),!e.hideTips&&!e.disabled?(d(),u("div",me,[e.dimension?(d(),u("div",he,V("建议尺寸为 ".concat(($=e.dimension)==null?void 0:$.width,"*").concat((z=e.dimension)==null?void 0:z.height)),1)):v("",!0),e.ext.length>0?(d(),u("div",ve,V("支持 ".concat(e.ext.join(" / ")," 格式")),1)):v("",!0),e.size>0?(d(),u("div",_e,V("大小不超过 ".concat(i(S)(e.size,{standard:"jedec"}))),1)):v("",!0),e.max>1?(d(),u("div",ge,V("数量不超过 ".concat(e.max," 个")),1)):v("",!0)])):v("",!0)])}}}),we=H({__name:"imageupload",setup(U){const y=C([]),e=C(["https://fantastic-admin.hurui.me/logo.svg"]),w=C([]);function t(){j.success("模拟上传成功")}return(_,n)=>{const k=Z,x=ye,b=ee,I=q;return d(),u("div",null,[r(k,{title:"图片上传",description:"FaImageUpload"}),r(b,null,{default:F(()=>[r(x,{modelValue:i(y),"onUpdate:modelValue":n[0]||(n[0]=l=>M(y)?y.value=l:null),action:"/mock/upload","after-upload":l=>l.data.url,onOnSuccess:t},null,8,["modelValue","after-upload"])]),_:1}),r(b,{title:"多图上传"},{default:F(()=>[r(x,{modelValue:i(e),"onUpdate:modelValue":n[1]||(n[1]=l=>M(e)?e.value=l:null),action:"/mock/upload","after-upload":l=>l.data.url,max:2,onOnSuccess:t},null,8,["modelValue","after-upload"])]),_:1}),r(b,{title:"自定义默认内容、容器大小、建议尺寸、限制类型、不限制数量"},{default:F(()=>[r(x,{modelValue:i(w),"onUpdate:modelValue":n[2]||(n[2]=l=>M(w)?w.value=l:null),action:"/mock/upload","after-upload":l=>l.data.url,width:200,height:130,dimension:{width:400,height:260},ext:["png"],size:200*1024,max:0,onOnSuccess:t},{default:F(()=>[r(I,{name:"i-noto:identification-card",class:"size-50 opacity-50"})]),_:1},8,["modelValue","after-upload"])]),_:1})])}}});typeof E=="function"&&E(we);export{we as default};
