
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * https://fantastic-admin.hurui.me
 */
    
import{_ as ne}from"./index.vue_vue_type_script_setup_true_lang-AsNzxvIs.js";import{_ as oe}from"./index.vue_vue_type_script_setup_true_lang-D4ztVb3N.js";import{d as re,a5 as ue,x as ie,y as ce,bz as fe,I as de,e as L,al as K,bA as pe,J as ve,K as J,aZ as h,E as me,ae as he,bB as O,z as I,o as d,u as p,h as x,f as o,c as R,F as G,R as X,n as Y,A as z,G as xe,t as Z,l as q,g as v,w as ye,aj as _e,X as C,Y as V,i as ge}from"./index-DXZKKOp8.js";import ke from"./index-C_SOQX8W.js";import{_ as be}from"./item.vue_vue_type_script_setup_true_lang-DcyjhSo4.js";const Re={class:"h-12 flex flex-shrink-0 items-center"},we={class:"h-full w-14 flex-center"},Se=["onKeydown"],Me={key:0,class:"h-full w-14 flex-center border-s"},Ie={class:"w-full flex justify-between px-4 py-3"},ze={class:"flex gap-8"},Ce={class:"inline-flex items-center gap-1 text-xs"},Ve={class:"inline-flex items-center gap-1 text-xs"},Be={key:0,class:"inline-flex items-center gap-1 text-xs"},Te=["data-index","onClick","onMouseover"],$e={class:"flex flex-1 flex-col gap-1 truncate border-s px-4 py-3"},Ee={class:"truncate text-start text-base font-bold"},Ne={key:1,class:"h-full flex-col-center py-6 text-secondary-foreground/50"},Fe={key:2,class:"h-full flex-col-center py-6 text-secondary-foreground/50"},Pe=re({name:"NavSearchModal",__name:"search",props:{modelValue:{type:Boolean,default:!1},modelModifiers:{}},emits:["update:modelValue"],setup(Q){const y=ue(Q,"modelValue"),W=ie(),w=ce(),B=fe(),ee=de(),i=L(""),U=K("searchInputRef"),{focused:te}=pe(U),T=L([]),n=L(-1),$=K("searchResultRef"),M=K("searchResultItemRef"),_=ve(()=>{let a=[];return a=T.value.filter(e=>{let s=!1;return i.value!==""&&(e.title&&(typeof e.title=="function"?e.title().includes(i.value)&&(s=!0):e.title.includes(i.value)&&(s=!0)),e.path.includes(i.value)&&(s=!0),B.getRouteMatchedByPath(e.path).some(l=>{var u,t,r,c;return typeof((u=l.meta)==null?void 0:u.title)=="function"?(t=l.meta)==null?void 0:t.title().includes(i.value):(c=(r=l.meta)==null?void 0:r.title)==null?void 0:c.includes(i.value)})&&(s=!0)),s}),a});J(()=>y.value,a=>{a?(i.value="",n.value=-1,h("up",E),h("down",N),h("enter",F),h("esc",e=>{w.settings.navSearch.enableHotkeys&&(e.preventDefault(),y.value=!1)})):(h.unbind("up",E),h.unbind("down",N),h.unbind("enter",F),h.unbind("esc"))}),J(()=>_.value,()=>{n.value=-1,H()}),me(()=>{se(),h("command+k, ctrl+k",a=>{w.settings.navSearch.enableHotkeys&&(a.preventDefault(),y.value=!0)})}),he(()=>{h.unbind("command+k, ctrl+k")});function se(){T.value=[],ee.allMenus.forEach(a=>{P(a.children)})}function le(a){var s;let e=!0;return(s=a.children)!=null&&s.every(l=>{var u;return((u=l.meta)==null?void 0:u.menu)===!1})&&(e=!1),e}function P(a,e,s){a.forEach(l=>{var u,t,r,c,f,g,m;((u=l.meta)==null?void 0:u.menu)!==!1&&(l.children&&le(l)?P(l.children,O(e,l.path),(r=(t=l.meta)==null?void 0:t.icon)!=null?r:s):T.value.push({path:O(e,l.path),icon:(f=(c=l.meta)==null?void 0:c.icon)!=null?f:s,title:(g=l.meta)==null?void 0:g.title,link:(m=l.meta)==null?void 0:m.link}))})}function E(){_.value.length&&(n.value-=1,n.value<0&&(n.value=_.value.length-1),H())}function N(){_.value.length&&(n.value+=1,n.value>_.value.length-1&&(n.value=0),H())}function F(){var a,e;n.value!==-1&&((e=(a=M.value)==null?void 0:a.find(s=>Number.parseInt(s.dataset.index)===n.value))==null||e.click())}function H(){var a,e,s,l,u,t,r,c,f,g;if((l=(s=(e=(a=$.value)==null?void 0:a.areaRef)==null?void 0:e.ref)==null?void 0:s.el)!=null&&l.viewportElement){const m=$.value.areaRef.ref.el.viewportElement;let k=0;if(n.value!==-1){k=m.scrollTop;const b=(r=(t=(u=M.value)==null?void 0:u.find(D=>Number.parseInt(D.dataset.index)===n.value))==null?void 0:t.offsetTop)!=null?r:0,S=(g=(f=(c=M.value)==null?void 0:c.find(D=>Number.parseInt(D.dataset.index)===n.value))==null?void 0:f.clientHeight)!=null?g:0,j=m.scrollTop,A=m.clientHeight;b+S>j+A?k=b+S-A:b<=j&&(k=b-16)}m.scrollTo({top:k})}}function ae(a,e){e?window.open(e,"_blank"):W.push(a),y.value=!1}return(a,e)=>{const s=xe,l=oe,u=ne;return d(),I(u,{ref_key:"searchResultRef",ref:$,modelValue:y.value,"onUpdate:modelValue":e[3]||(e[3]=t=>y.value=t),border:"",footer:p(w).mode==="pc",closable:!1,class:"w-full lg-max-w-2xl","content-class":"flex flex-col p-0 min-h-auto","header-class":"p-0","footer-class":"p-0",onOpened:e[4]||(e[4]=t=>te.value=!0)},{header:x(()=>[o("div",Re,[o("div",we,[v(s,{name:"i-ri:search-line",class:"size-4 text-foreground/30"})]),ye(o("input",{ref_key:"searchInputRef",ref:U,"onUpdate:modelValue":e[0]||(e[0]=t=>ge(i)?i.value=t:null),placeholder:"搜索页面，支持标题、URL模糊查询",class:"h-full w-full border-0 rounded-md bg-transparent text-base text-foreground focus-outline-none placeholder-foreground/30",onKeydown:[e[1]||(e[1]=C(V(t=>y.value=!1,["prevent"]),["esc"])),C(V(E,["prevent"]),["up"]),C(V(N,["prevent"]),["down"]),C(V(F,["prevent"]),["enter"])]},null,40,Se),[[_e,p(i)]]),p(w).mode==="mobile"?(d(),R("div",Me,[v(s,{name:"i-carbon:close",class:"size-4",onClick:e[2]||(e[2]=t=>y.value=!1)})])):z("",!0)])]),footer:x(()=>[o("div",Ie,[o("div",ze,[o("div",Ce,[v(l,null,{default:x(()=>[v(s,{name:"i-ion:md-return-left",class:"size-4"})]),_:1}),e[5]||(e[5]=o("span",null,"访问",-1))]),o("div",Ve,[v(l,null,{default:x(()=>[v(s,{name:"i-ant-design:caret-up-filled",class:"size-4"})]),_:1}),v(l,null,{default:x(()=>[v(s,{name:"i-ant-design:caret-down-filled",class:"size-4"})]),_:1}),e[6]||(e[6]=o("span",null,"切换",-1))])]),p(w).settings.navSearch.enableHotkeys?(d(),R("div",Be,[v(l,null,{default:x(()=>[...e[7]||(e[7]=[q(" ESC ",-1)])]),_:1}),e[8]||(e[8]=o("span",null,"退出",-1))])):z("",!0)])]),default:x(()=>[o("div",null,[p(_).length>0?(d(!0),R(G,{key:0},X(p(_),(t,r)=>{var c;return d(),R("div",{ref_for:!0,ref_key:"searchResultItemRef",ref:M,key:t.path,class:"p-4","data-index":r,onClick:f=>ae(t.path,t.link),onMouseover:f=>n.value=r},[o("a",{class:Y(["flex cursor-pointer items-center border rounded-lg",{"-mt-4":r!==0,"bg-accent":r===p(n)}])},[t.icon?(d(),I(s,{key:0,name:t.icon,class:Y(["size-5 basis-16 transition",{"scale-120 text-primary":r===p(n)}])},null,8,["name","class"])):z("",!0),o("div",$e,[o("div",Ee,Z((c=typeof t.title=="function"?t.title():t.title)!=null?c:"[ 无标题 ]"),1),p(B).getRouteMatchedByPath(t.path).length?(d(),I(ke,{key:0,class:"truncate"},{default:x(()=>[(d(!0),R(G,null,X(p(B).getRouteMatchedByPath(t.path),(f,g)=>(d(),I(be,{key:g,class:"text-xs"},{default:x(()=>{var m,k,b,S;return[q(Z((S=typeof((m=f.meta)==null?void 0:m.title)=="function"?(k=f.meta)==null?void 0:k.title():(b=f.meta)==null?void 0:b.title)!=null?S:"[ 无标题 ]"),1)]}),_:2},1024))),128))]),_:2},1024)):z("",!0)])],2)],40,Te)}),128)):p(i)===""?(d(),R("div",Ne,[v(s,{name:"i-tabler:mood-smile",class:"size-10"}),e[9]||(e[9]=o("p",{class:"m-2 text-base"}," 输入你要搜索的导航 ",-1))])):(d(),R("div",Fe,[v(s,{name:"i-tabler:mood-empty",class:"size-10"}),e[10]||(e[10]=o("p",{class:"m-2 text-base"}," 没有找到你想要的 ",-1))]))])]),_:1},8,["modelValue","footer"])}}});export{Pe as _};
