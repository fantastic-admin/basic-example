
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * https://fantastic-admin.hurui.me
 */
    
import{_ as ae}from"./index.vue_vue_type_script_setup_true_lang-CVzIja2y.js";import{_ as ne}from"./index.vue_vue_type_script_setup_true_lang-CwF9tzsY.js";import{_ as oe}from"./index.vue_vue_type_script_setup_true_lang-CP_Tumhm.js";import{d as re,a6 as ue,x as ie,y as ce,bD as fe,I as de,e as L,am as U,bE as pe,J as ve,K as J,aY as m,E as me,af as he,bF as O,z as C,o as d,u as p,h,g as c,c as b,F as Y,R as j,f as n,n as G,A as V,G as _e,t as Z,l as q,w as xe,ak as ge,Y as z,Z as T,i as ye}from"./index-CJB5jCfL.js";import ke from"./index-CSyk7AIq.js";import{_ as be}from"./item.vue_vue_type_script_setup_true_lang-BpmNkGtN.js";const we={class:"h-12 flex flex-shrink-0 items-center"},Re={class:"h-full w-14 flex-center"},Se=["onKeydown"],Me={key:0,class:"h-full w-14 flex-center border-s"},Ie={class:"w-full flex justify-between px-4 py-3"},Ce={class:"flex gap-8"},Ve={class:"inline-flex items-center gap-1 text-xs"},ze={class:"inline-flex items-center gap-1 text-xs"},Te={key:0,class:"inline-flex items-center gap-1 text-xs"},$e=["data-index","onClick","onMouseover"],Be={class:"flex flex-1 flex-col gap-1 truncate border-s px-4 py-3"},Ee={class:"truncate text-start text-base font-bold"},Fe={key:1,class:"h-full flex-col-center py-6 text-secondary-foreground/50"},Ne={key:2,class:"h-full flex-col-center py-6 text-secondary-foreground/50"},Ae=re({name:"NavSearchModal",__name:"search",props:{modelValue:{type:Boolean,default:!1},modelModifiers:{}},emits:["update:modelValue"],setup(Q){const x=ue(Q,"modelValue"),W=ie(),w=ce(),$=fe(),X=de(),f=L(""),P=U("searchInputRef"),{focused:ee}=pe(P),B=L([]),o=L(0),E=U("searchResultRef"),I=U("searchResultItemRef"),g=ve(()=>{let a=[];return a=B.value.filter(e=>{let s=!1;return f.value!==""&&(e.title&&(typeof e.title=="function"?e.title().includes(f.value)&&(s=!0):e.title.includes(f.value)&&(s=!0)),e.path.includes(f.value)&&(s=!0),$.getRouteMatchedByPath(e.path).some(l=>{var u,v,t,r;return typeof((u=l.meta)==null?void 0:u.title)=="function"?(v=l.meta)==null?void 0:v.title().includes(f.value):(r=(t=l.meta)==null?void 0:t.title)==null?void 0:r.includes(f.value)})&&(s=!0)),s}),a});J(()=>x.value,a=>{a?(f.value="",o.value=0,m("up",F),m("down",N),m("enter",D),m("esc",e=>{w.settings.navSearch.enableHotkeys&&(e.preventDefault(),x.value=!1)})):(m.unbind("up",F),m.unbind("down",N),m.unbind("enter",D),m.unbind("esc"))}),J(()=>g.value,()=>{o.value=0,H()}),me(()=>{te(),m("command+k, ctrl+k",a=>{w.settings.navSearch.enableHotkeys&&(a.preventDefault(),x.value=!0)})}),he(()=>{m.unbind("command+k, ctrl+k")});function te(){B.value=[],X.allMenus.forEach(a=>{A(a.children)})}function se(a){var s;let e=!0;return(s=a.children)!=null&&s.every(l=>{var u;return((u=l.meta)==null?void 0:u.menu)===!1})&&(e=!1),e}function A(a,e,s){a.forEach(l=>{var u,v,t,r,y,i,_;((u=l.meta)==null?void 0:u.menu)!==!1&&(l.children&&se(l)?A(l.children,O(e,l.path),(t=(v=l.meta)==null?void 0:v.icon)!=null?t:s):B.value.push({path:O(e,l.path),icon:(y=(r=l.meta)==null?void 0:r.icon)!=null?y:s,title:(i=l.meta)==null?void 0:i.title,link:(_=l.meta)==null?void 0:_.link}))})}function F(){g.value.length&&(o.value-=1,o.value<0&&(o.value=g.value.length-1),H())}function N(){g.value.length&&(o.value+=1,o.value>g.value.length-1&&(o.value=0),H())}function D(){var a,e;(e=(a=I.value)==null?void 0:a.find(s=>Number.parseInt(s.dataset.index)===o.value))==null||e.click()}function H(){var a,e,s,l,u,v,t,r,y;if((s=(e=(a=E.value)==null?void 0:a.ref)==null?void 0:e.el)!=null&&s.viewportElement){const i=E.value.ref.el.viewportElement;let _=0;if(g.value.length>0){_=i.scrollTop;const k=(v=(u=(l=I.value)==null?void 0:l.find(K=>Number.parseInt(K.dataset.index)===o.value))==null?void 0:u.offsetTop)!=null?v:0,R=(y=(r=(t=I.value)==null?void 0:t.find(K=>Number.parseInt(K.dataset.index)===o.value))==null?void 0:r.clientHeight)!=null?y:0,S=i.scrollTop,M=i.clientHeight;k+R>S+M?_=k+R-M:k<=S&&(_=k-16)}i.scrollTo({top:_})}}function le(a,e){e?window.open(e,"_blank"):W.push(a),x.value=!1}return(a,e)=>{const s=_e,l=oe,u=ne,v=ae;return d(),C(v,{modelValue:x.value,"onUpdate:modelValue":e[3]||(e[3]=t=>x.value=t),border:"",footer:p(w).mode==="pc",closable:!1,class:"w-full lg-max-w-2xl","content-class":"flex flex-col p-0 min-h-auto","header-class":"p-0","footer-class":"p-0",onOpened:e[4]||(e[4]=t=>ee.value=!0)},{header:h(()=>[n("div",we,[n("div",Re,[c(s,{name:"i-ri:search-line",class:"size-4 text-foreground/30"})]),xe(n("input",{ref_key:"searchInputRef",ref:P,"onUpdate:modelValue":e[0]||(e[0]=t=>ye(f)?f.value=t:null),placeholder:"搜索页面，支持标题、URL模糊查询",class:"h-full w-full border-0 rounded-md bg-transparent text-base text-foreground focus-outline-none placeholder-foreground/30",onKeydown:[e[1]||(e[1]=z(T(t=>x.value=!1,["prevent"]),["esc"])),z(T(F,["prevent"]),["up"]),z(T(N,["prevent"]),["down"]),z(T(D,["prevent"]),["enter"])]},null,40,Se),[[ge,p(f)]]),p(w).mode==="mobile"?(d(),b("div",Me,[c(s,{name:"i-carbon:close",class:"size-4",onClick:e[2]||(e[2]=t=>x.value=!1)})])):V("",!0)])]),footer:h(()=>[n("div",Ie,[n("div",Ce,[n("div",Ve,[c(l,null,{default:h(()=>[c(s,{name:"i-ion:md-return-left",class:"size-4"})]),_:1}),e[5]||(e[5]=n("span",null,"访问",-1))]),n("div",ze,[c(l,null,{default:h(()=>[c(s,{name:"i-ant-design:caret-up-filled",class:"size-4"})]),_:1}),c(l,null,{default:h(()=>[c(s,{name:"i-ant-design:caret-down-filled",class:"size-4"})]),_:1}),e[6]||(e[6]=n("span",null,"切换",-1))])]),p(w).settings.navSearch.enableHotkeys?(d(),b("div",Te,[c(l,null,{default:h(()=>[...e[7]||(e[7]=[q(" ESC ",-1)])]),_:1}),e[8]||(e[8]=n("span",null,"退出",-1))])):V("",!0)])]),default:h(()=>[c(u,{ref_key:"searchResultRef",ref:E},{default:h(()=>[p(g).length>0?(d(!0),b(Y,{key:0},j(p(g),(t,r)=>{var y;return d(),b("div",{ref_for:!0,ref_key:"searchResultItemRef",ref:I,key:t.path,class:"p-4","data-index":r,onClick:i=>le(t.path,t.link),onMouseover:i=>o.value=r},[n("a",{class:G(["flex cursor-pointer items-center border rounded-lg",{"-mt-4":r!==0,"bg-accent":r===p(o)}])},[t.icon?(d(),C(s,{key:0,name:t.icon,class:G(["size-5 basis-16 transition",{"scale-120 text-primary":r===p(o)}])},null,8,["name","class"])):V("",!0),n("div",Be,[n("div",Ee,Z((y=typeof t.title=="function"?t.title():t.title)!=null?y:"[ 无标题 ]"),1),p($).getRouteMatchedByPath(t.path).length?(d(),C(ke,{key:0,class:"truncate"},{default:h(()=>[(d(!0),b(Y,null,j(p($).getRouteMatchedByPath(t.path),(i,_)=>(d(),C(be,{key:_,class:"text-xs"},{default:h(()=>{var k,R,S,M;return[q(Z((M=typeof((k=i.meta)==null?void 0:k.title)=="function"?(R=i.meta)==null?void 0:R.title():(S=i.meta)==null?void 0:S.title)!=null?M:"[ 无标题 ]"),1)]}),_:2},1024))),128))]),_:2},1024)):V("",!0)])],2)],40,$e)}),128)):p(f)===""?(d(),b("div",Fe,[c(s,{name:"i-tabler:mood-smile",class:"size-10"}),e[9]||(e[9]=n("p",{class:"m-2 text-base"}," 输入你要搜索的导航 ",-1))])):(d(),b("div",Ne,[c(s,{name:"i-tabler:mood-empty",class:"size-10"}),e[10]||(e[10]=n("p",{class:"m-2 text-base"}," 没有找到你想要的 ",-1))]))]),_:1},512)]),_:1},8,["modelValue","footer"])}}});export{Ae as _};
