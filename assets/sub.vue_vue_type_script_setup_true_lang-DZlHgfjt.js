
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * https://fantastic-admin.hurui.me
 */
    
import{_}from"./index.vue_vue_type_script_setup_true_lang-CwF9tzsY.js";import{d as E,am as F,at as B,J as g,a as v,L as j,c as M,o as m,F as x,g as K,z as b,A as C,u as n,bq as U,T as N,m as V,aK as W,h as T,n as J,R as O,br as z,aa as Z}from"./index-CJB5jCfL.js";import{r as D,_ as G}from"./item.vue_vue_type_script_setup_true_lang-BkEpGKnc.js";const ee=E({name:"SubMenu",__name:"sub",props:{uniqueKey:{},menu:{},level:{default:0}},setup(o){var q;const s=o,w=F("itemRef"),H=F("subMenuRef"),t=B(D),f=(q=s.menu.path)!=null?q:t.getUseId(s.menu),k=g(()=>t.openedMenus.includes(s.uniqueKey.at(-1))),A=g(()=>t.isMenuPopup?{enter(e){e.offsetHeight>window.innerHeight&&(e.style.height="".concat(window.innerHeight,"px"))},afterEnter:()=>{},beforeLeave:e=>{e.style.maxHeight="".concat(e.offsetHeight,"px"),e.style.overflow="hidden"},leave:e=>{e.style.maxHeight="0"},afterLeave(e){e.style.maxHeight="",e.style.overflow=""}}:CSS.supports("height","calc-size(auto, size)")?{}:{enter(e){requestAnimationFrame(()=>{e.dataset.height=e.offsetHeight.toString(),e.style.maxHeight="0",e.offsetHeight,e.style.maxHeight="".concat(e.dataset.height,"px"),e.style.overflow="hidden"})},afterEnter(e){e.style.maxHeight="",e.style.overflow=""},enterCancelled(e){e.style.maxHeight="",e.style.overflow=""},beforeLeave(e){e.style.maxHeight="".concat(e.offsetHeight,"px"),e.style.overflow="hidden"},leave(e){e.style.maxHeight="0"},afterLeave(e){e.style.maxHeight="",e.style.overflow=""},leaveCancelled(e){e.style.maxHeight="",e.style.overflow=""}}),I=g(()=>t.isMenuPopup?{enterActiveClass:"ease-in-out duration-300",enterFromClass:"opacity-0 translate-x-4",enterToClass:"opacity-100",leaveActiveClass:"ease-in-out duration-300",leaveFromClass:"opacity-100",leaveToClass:"opacity-0"}:{enterActiveClass:"ease-in-out duration-300",enterFromClass:v("opacity-0 translate-y-4 scale-95 blur-4",CSS.supports("height","calc-size(auto, size)")&&"h-0"),enterToClass:"opacity-100 translate-y-0 scale-100 blur-0",leaveActiveClass:"ease-in-out duration-300",leaveFromClass:"opacity-100 translate-y-0 scale-100 blur-0",leaveToClass:v("opacity-0 translate-y-4 scale-95 blur-4",CSS.supports("height","calc-size(auto, size)")&&"h-0")}),c=g(()=>{var e,a;return(a=(e=s.menu.children)==null?void 0:e.some(h=>{var r;return((r=h.meta)==null?void 0:r.menu)!==!1}))!=null?a:!1});function $(){var e;t.isMenuPopup&&c.value||(e=s.menu.meta)!=null&&e.link||requestAnimationFrame(()=>{c.value?t.handleSubMenuClick(f,s.uniqueKey):t.handleMenuItemClick(f)})}let l;function R(){t.isMenuPopup&&(t.mouseInMenu=s.uniqueKey,l==null||l(),{stop:l}=z(()=>{if(c.value)t.openMenu(f,s.uniqueKey),Z(()=>{requestAnimationFrame(()=>{var P,S;const e=(P=w.value)==null?void 0:P.ref,a=(S=H.value)==null?void 0:S.$el;if(!e||!a)return;const h=e.getBoundingClientRect(),{top:r,left:i,width:d,height:y}=h;let u=0,p=0;t.props.mode==="vertical"||s.level!==0?(u=r+e.scrollTop,p=i+d,u+a.offsetHeight>window.innerHeight&&(u=Math.max(0,window.innerHeight-a.offsetHeight))):(u=r+y,p=i,u+a.offsetHeight>window.innerHeight&&(a.style.height="".concat(window.innerHeight-u,"px"))),p+a.offsetWidth>document.documentElement.clientWidth&&(p=i-d),Object.assign(a.style,{top:"".concat(u,"px"),insetInlineStart:"".concat(p,"px"),willChange:"transform",transform:"translateZ(0)"})})});else{const e=s.menu.children?t.subMenus[f].indexPath.at(-1):t.items[f].indexPath.at(-1);t.openMenu(e,t.subMenus[e].indexPath)}},300))}function L(){t.isMenuPopup&&(t.mouseInMenu=[],l==null||l(),{stop:l}=z(()=>{requestAnimationFrame(()=>{t.mouseInMenu.length===0?t.closeMenu(s.uniqueKey):c.value&&!t.mouseInMenu.includes(s.uniqueKey.at(-1))&&t.closeMenu(s.uniqueKey.at(-1))})},300))}return(e,a)=>{const h=j("SubMenu"),r=_;return m(),M(x,null,[K(G,{ref_key:"itemRef",ref:w,"unique-key":o.uniqueKey,item:o.menu,level:o.level,"sub-menu":n(c),expand:n(k),onClick:$,onMouseenter:R,onMouseleave:L},null,8,["unique-key","item","level","sub-menu","expand"]),n(c)?(m(),b(U,{key:0,to:"body",disabled:!n(t).isMenuPopup},[K(N,V(n(I),W(n(A))),{default:T(()=>[n(k)?(m(),b(r,{key:0,ref_key:"subMenuRef",ref:H,scrollbar:!1,mask:n(t).isMenuPopup,class:J(n(v)("sub-menu static h-[calc-size(auto,size)] rounded-lg will-change-transform",{"bg-[var(--g-sub-sidebar-bg)]":n(t).isMenuPopup,"border shadow-xl fixed z-3000 w-[200px]":n(t).isMenuPopup,"mx-1":n(t).isMenuPopup&&(n(t).props.mode==="vertical"||o.level!==0),"py-1 overscroll-contain":n(t).isMenuPopup}))},{default:T(()=>[(m(!0),M(x,null,O(o.menu.children,i=>{var d,y,u;return m(),M(x,{key:(d=i.path)!=null?d:n(t).getUseId(i)},[((y=i.meta)==null?void 0:y.menu)!==!1?(m(),b(h,{key:0,"unique-key":[...o.uniqueKey,(u=i.path)!=null?u:n(t).getUseId(i)],menu:i,level:o.level+1},null,8,["unique-key","menu","level"])):C("",!0)],64)}),128))]),_:1},8,["mask","class"])):C("",!0)]),_:1},16)],8,["disabled"])):C("",!0)],64)}}});export{ee as _};
