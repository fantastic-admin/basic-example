
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * https://fantastic-admin.hurui.me
 */
    
import{e as h,J,E as K,af as R,au as j,K as O}from"./index-CJB5jCfL.js";function _(r,k={x:0,y:0,width:100,height:100},G=1,d,q=null){const v=h({...k}),u=h({...v.value}),i=h(1),L=h(!1),p=h(!1),Y=h(0),B=h(null),X=h(1),x=h({x:0,y:0}),H=J(()=>u.value.x!==v.value.x||u.value.y!==v.value.y||u.value.width!==v.value.width||u.value.height!==v.value.height);let y=null;function D(e){if(e.length<2)return 0;const t=e[0].clientX-e[1].clientX,n=e[0].clientY-e[1].clientY;return Math.hypot(t,n)}function M(e){var a;const t=r.value;if(!t)return{x:0,y:0};const n=t.createSVGPoint();n.x=e.clientX,n.y=e.clientY;const l=(a=t.getScreenCTM())==null?void 0:a.inverse();return l?n.matrixTransform(l):{x:0,y:0}}function N(e,t){const n=r.value;if(!n)return{dx:0,dy:0};const l=Math.max(1,n.clientWidth),a=Math.max(1,n.clientHeight),s=u.value.width/l,o=u.value.height/a;return{dx:e*s,dy:t*o}}function F(e){var n;L.value=!0;const t=((n=e.touches)==null?void 0:n[0])||e;x.value={x:t.clientX,y:t.clientY},r.value&&(r.value.style.cursor="grabbing")}function A(e){var o;if(!L.value)return;const t=((o=e.touches)==null?void 0:o[0])||e,n=t.clientX-x.value.x,l=t.clientY-x.value.y;if(n===0&&l===0)return;const{dx:a,dy:s}=N(n,l);u.value.x-=a,u.value.y-=s,x.value={x:t.clientX,y:t.clientY}}function m(){L.value=!1,r.value&&(r.value.style.cursor="")}function Z(e){q&&q(),e.preventDefault();const t=e.deltaY>0?.9:1.1;w(t,M(e))}function C(e){e.preventDefault();const t=M(e),n=1.5*(1+G/100);I(n,t)}function I(e,t){y&&cancelAnimationFrame(y);const n=i.value,l=n*e;let a=null;const s=200,o=f=>f<.5?2*f*f:-1+(4-2*f)*f,c=f=>{a==null&&(a=f);const V=Math.min((f-a)/s,1),z=(n+(l-n)*o(V))/i.value;w(z,t),V<1?y=requestAnimationFrame(c):y=null};requestAnimationFrame(c)}function w(e,t){const n=i.value*e,l=n/i.value,a=u.value.width/l,s=u.value.height/l,o=(t.x-u.value.x)*(1-1/l),c=(t.y-u.value.y)*(1-1/l);u.value.x+=o,u.value.y+=c,u.value.width=a,u.value.height=s,i.value=n}function S(e){e.touches.length===2?(p.value=!0,Y.value=D(e.touches),B.value={...u.value},X.value=i.value):(e.preventDefault(),F(e))}function T(e){if(p.value&&e.touches.length===2){e.preventDefault();const t=D(e.touches);if(!Y.value||!t)return;const n=t/Y.value,l=X.value*n/i.value,a=(e.touches[0].clientX+e.touches[1].clientX)/2,s=(e.touches[0].clientY+e.touches[1].clientY)/2,o=M({clientX:a,clientY:s});u.value={...B.value},i.value=X.value,w(l,o)}else e.preventDefault(),A(e)}function E(e){e.touches.length<2&&(p.value=!1),m()}function P(e=!1){if(!e){u.value={...v.value},i.value=1;return}const t={...u.value},n=i.value,l=300;let a=null;const s=o=>{a==null&&(a=o);const c=Math.min((o-a)/l,1);u.value={x:t.x+(v.value.x-t.x)*c,y:t.y+(v.value.y-t.y)*c,width:t.width+(v.value.width-t.width)*c,height:t.height+(v.value.height-t.height)*c},i.value=n+(1-n)*c,c<1&&requestAnimationFrame(s)};requestAnimationFrame(s)}function U(e,t={}){const{overwriteCurrentIfNotZoomed:n=!0}=t,l=u.value.x!==v.value.x||u.value.y!==v.value.y||u.value.width!==v.value.width||u.value.height!==v.value.height;v.value={...e},!l&&n&&(u.value={...v.value},i.value=1)}function b(){const e=r.value;e&&(e.addEventListener("mousedown",F),e.addEventListener("mousemove",A),e.addEventListener("mouseup",m),e.addEventListener("mouseleave",m),e.addEventListener("wheel",Z,{passive:!1}),e.addEventListener("dblclick",C),e.addEventListener("touchstart",S,{passive:!1}),e.addEventListener("touchmove",T,{passive:!1}),e.addEventListener("touchend",E),e.addEventListener("touchcancel",E))}function g(){const e=r.value;e&&(e.removeEventListener("mousedown",F),e.removeEventListener("mousemove",A),e.removeEventListener("mouseup",m),e.removeEventListener("mouseleave",m),e.removeEventListener("wheel",Z),e.removeEventListener("dblclick",C),e.removeEventListener("touchstart",S),e.removeEventListener("touchmove",T),e.removeEventListener("touchend",E),e.removeEventListener("touchcancel",E))}K(()=>{(!d||d.value)&&b()}),R(g),j(()=>{if(d)return d.value?b():g(),()=>g()}),O(r,()=>{g(),(!d||d.value)&&b()});function W(e,t=!1){const n={x:u.value.x+u.value.width/2,y:u.value.y+u.value.height/2};t?I(e,n):w(e,n)}return{viewBox:u,resetZoom:P,isZoom:H,setInitialViewBox:U,scale:i,zoomByFactor:W}}export{_ as R};
