
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * https://fantastic-admin.hurui.me
 */
    
import{i as Bt,e as Ct,E as Et,K as Ft,aa as Wt,u as Tt}from"./index-CJB5jCfL.js";const K="http://www.w3.org/2000/svg",At="http://www.w3.org/1999/xlink",Rt='system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", "Liberation Sans", sans-serif';let wt=new WeakMap;function pt(M){let C=wt.get(M);return C||(C=getComputedStyle(M),wt.set(M,C)),C}function $t(){wt=new WeakMap}function B(M){return document.createElementNS(K,M)}function St(M){return"".concat(M,", ").concat(Rt)}function jt({svg:M,title:C,legend:k,legendItems:et,backgroundColor:it,stretchTitle:j=!1,titleEmbedded:rt=!1}){const st=Bt(M)?M:Ct(M),J=Ct(!1),E=["fill","fill-opacity","stroke","stroke-width","stroke-opacity","opacity","color","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-dasharray","stroke-dashoffset","font-family","font-size","font-style","font-weight","font-variant","letter-spacing","word-spacing","text-anchor","dominant-baseline","shape-rendering","vector-effect","paint-order","mix-blend-mode","isolation","filter","clip-path","mask","transform","transform-origin","visibility","display"],U=new Set(["font-family"]);async function b({timeoutMs:i=4e3,log:r="warn"}={}){if(typeof window>"u"||typeof document>"u")return console.warn("SVG export only works in the browser."),null;const c=performance.now()+i,h=()=>{const m=Tt(st);return m&&document.contains(m)?m:null};let l=h();if(l)return l;let o=!1;const y=m=>{if(!o&&m)try{m.disconnect()}catch(_){}o=!0};let $;const A=new Promise(m=>{try{$=new MutationObserver(()=>{const _=h();_&&(y($),m(_))}),$.observe(document.documentElement,{childList:!0,subtree:!0})}catch(_){m(null)}});for(;performance.now()<c;){const m=await Promise.race([A,new Promise(_=>requestAnimationFrame(_))]);if(await Wt(),l=h()||m,l)return y($),l}return y($),console.warn("SVG element not found or not mounted (timed out)."),null}Et(async()=>{try{await b(),J.value=!0}catch(i){J.value=!1}}),Ft(st,async()=>{try{await b(),J.value=!0}catch(i){J.value=!1}});const d=new Map;function x(i){if(d.has(i))return d.get(i);const r=B("svg");r.setAttribute("width","0"),r.setAttribute("height","0"),r.style.position="absolute",r.style.left="-99999px",r.style.top="-99999px";const c=B(i);r.appendChild(c),document.body.appendChild(r);const h=window.getComputedStyle(c),l={};for(const o of E)l[o]=h.getPropertyValue(o);return document.body.removeChild(r),d.set(i,l),l}function z(i){const r=pt(i),c=x(i.tagName.toLowerCase()),h=[];for(const l of E){let o=r.getPropertyValue(l)||"";const y=c[l]||"";if(U.has(l)){l==="font-family"&&o&&(o=St(o)),o&&h.push("".concat(l,":").concat(o,";"));continue}o&&o!==y&&h.push("".concat(l,":").concat(o,";"))}return h.join("")}function v(i,r){i.getAttribute("width")&&r.setAttribute("width",i.getAttribute("width")),i.getAttribute("height")&&r.setAttribute("height",i.getAttribute("height")),i.getAttribute("viewBox")&&r.setAttribute("viewBox",i.getAttribute("viewBox"));const c=[i,...Array.from(i.querySelectorAll("*"))],h=[r,...Array.from(r.querySelectorAll("*"))];for(let l=0;l<c.length;l+=1){const o=c[l],y=h[l],$=z(o);$&&y.setAttribute("style",$),["fill","stroke","filter","clip-path","mask"].forEach(A=>{const m=o.getAttribute(A);m&&y.setAttribute(A,m)})}}function T(i){const r=i.getAttribute("viewBox");if(!r)return null;const[c,h,l,o]=r.split(/\s+|,/).map(Number);return[c,h,l,o].some(y=>Number.isNaN(y))?null:{minX:c,minY:h,width:l,height:o}}function P(i){i.getAttribute("xmlns")||i.setAttribute("xmlns",K),i.getAttribute("xmlns:xlink")||i.setAttribute("xmlns:xlink",At),i.getAttribute("xml:space")||i.setAttribute("xml:space","preserve")}function tt(i){const r=document.createElement("div");return r.style.position="absolute",r.style.left="-99999px",r.style.top="-99999px",r.style.width="0",r.style.height="0",document.body.appendChild(r),r.appendChild(i),r}function dt(i){try{i.remove()}catch(r){}}function nt(i,r,c,h,l){var Z,H,W;if(!C.value||!C.value.text)return 0;const o={text:C.value.text||"",color:C.value.color||"#111",fontSize:C.value.fontSize||20,bold:!!C.value.bold,textAlign:(((Z=C.value)==null?void 0:Z.textAlign)||"center").toLowerCase(),paddingLeft:(H=C.value.paddingLeft)!=null?H:0,paddingRight:(W=C.value.paddingRight)!=null?W:0,subtitle:C.value.subtitle||null},y=B("g");y.setAttribute("id","__vdu_export_title"),i.appendChild(y);const $=c+o.paddingLeft,A=c+r-(o.paddingRight||0),m=c+r/2;let _="start",F=$;o.textAlign==="center"?(_="middle",F=m):o.textAlign==="right"&&(_="end",F=A);const G=h,O=Math.round(o.fontSize*.4),N=B("text");N.setAttribute("x",String(F)),N.setAttribute("y",String(G+o.fontSize)),N.setAttribute("text-anchor",_),N.setAttribute("dominant-baseline","ideographic"),N.setAttribute("style","font-family:".concat(l,"; font-size:").concat(o.fontSize,"px; font-weight:").concat(o.bold?"700":"400","; fill:").concat(o.color,"; ").concat(j?"transform: scale(0.65, 1); transform-origin: center;":"")),N.textContent=o.text,y.appendChild(N);let D=o.fontSize;if(o.subtitle&&o.subtitle.text){const n={color:o.subtitle.color||"#666",text:o.subtitle.text,fontSize:o.subtitle.fontSize||Math.max(12,Math.round(o.fontSize*.8)),bold:!!o.subtitle.bold},t=B("text");t.setAttribute("x",String(F)),t.setAttribute("y",String(G+o.fontSize+O+n.fontSize)),t.setAttribute("text-anchor",_),t.setAttribute("dominant-baseline","ideographic"),t.setAttribute("style","font-family:".concat(l,"; font-size:").concat(n.fontSize,"px; font-weight:").concat(n.bold?"600":"400","; fill:").concat(n.color,"; ").concat(j?"transform: scale(0.65, 1); transform-origin: center;":"")),t.textContent=n.text,y.appendChild(t),D+=O+n.fontSize}return D+Math.round(o.fontSize*.4)}function Y(i,r,c,h,l){if(!k.value||!k.value.show||!Array.isArray(et.value)||!et.value.length)return 0;const o={bold:!!k.value.bold,backgroundColor:k.value.backgroundColor||"transparent",color:k.value.color||"#111",fontSize:k.value.fontSize||14,paddingX:14,paddingY:10,itemGapX:18,itemGapY:12,markerSize:Math.max(8,Math.round((k.value.fontSize||14)*.9)),markerTextGap:8,lineHeight:Math.round((k.value.fontSize||14)*1.2),maxWidth:r},y=B("g");y.setAttribute("id","__vdu_export_legend"),y.setAttribute("transform","translate(".concat(c,", ").concat(h,")")),i.appendChild(y);const $=B("rect");$.setAttribute("rx","6"),$.setAttribute("ry","6"),$.setAttribute("fill",o.backgroundColor),y.appendChild($);const A=B("g");y.appendChild(A);const m=B("text");m.setAttribute("x","0"),m.setAttribute("y","0"),m.setAttribute("style","font-family:".concat(l,"; font-size:").concat(o.fontSize,"px; font-weight:").concat(o.bold?"600":"400","; opacity:0;")),A.appendChild(m);const _=e=>(m.textContent=e||"",m.getComputedTextLength()),F=Math.max(1,o.maxWidth-o.paddingX*2);function G(e,u){const s=String(e||"").split(/\s+/).filter(Boolean),a=[];if(!s.length)return[""];let g=s.shift();for(;s.length;){const w="".concat(g," ").concat(s[0]);if(_(w)<=u)g=w,s.shift();else if(_(g)>u&&g.length>1){let f="";for(const X of g){const R=f+X;if(_(R)<=u)f=R;else break}const L=g.slice(f.length);a.push(f),g=L.length?L:s.shift()||""}else a.push(g),g=s.shift()||""}g&&a.push(g);const S=a[a.length-1]||"";if(_(S)>u&&S.length>1){let w="";for(const L of S){const X=w+L;if(_(X)<=u)w=X;else break}const f=S.slice(w.length);a[a.length-1]=w,f&&a.push(f)}return a}const O=Math.PI/180;function N(e,u,s,a,g=-90){const S=g*O;let w="";for(let f=0;f<s;f+=1){const L=S+f*2*Math.PI/s,X=e+Math.cos(L)*a,R=u+Math.sin(L)*a;w+=(f===0?"M":"L")+X+","+R}return w+"Z"}function D(e,u,s=5,a,g){const S=-90*O;let w="";for(let f=0;f<s*2;f+=1){const L=f%2===0?a:g,X=S+f*Math.PI/s,R=e+Math.cos(X)*L,ht=u+Math.sin(X)*L;w+=(f===0?"M":"L")+R+","+ht}return w+"Z"}const Z=et.value.map(e=>{const u=Math.max(1,F-(o.markerSize+o.markerTextGap)),s=G(e.name||"",u),a=Math.max(...s.map(_),0),g=o.markerSize+o.markerTextGap+a,S=Math.max(o.markerSize,s.length*o.lineHeight);return{...e,lines:s,itemW:g,itemH:S}}),H=[];let W={items:[],width:0,height:0};for(const e of Z){const u=(W.items.length?o.itemGapX:0)+e.itemW;W.items.length&&W.width+u>F?(H.push(W),W={items:[e],width:e.itemW,height:e.itemH}):(W.items.push(e),W.width+=u,W.height=Math.max(W.height,e.itemH))}W.items.length&&H.push(W);let n=o.paddingY;for(const e of H){let u=Math.max(o.paddingX,(o.maxWidth-e.width)/2);for(let s=0;s<e.items.length;s+=1){const a=e.items[s],g=u+o.markerSize/2,S=n+e.height/2.5,w=o.markerSize/2,f=String(a.shape||"rect").toLowerCase();if(f==="circle"){const p=B("circle");p.setAttribute("cx",String(g)),p.setAttribute("cy",String(S)),p.setAttribute("r",String(w*.8)),p.setAttribute("fill",a.color||"#000"),A.appendChild(p)}else if(f==="rect"||f==="square"){const p=B("path");p.setAttribute("d",N(g,S,4,w,-45)),p.setAttribute("fill",a.color||"#000"),A.appendChild(p)}else if(f==="diamond"){const p=B("path");p.setAttribute("d",N(g,S,4,w,45)),p.setAttribute("fill",a.color||"#000"),A.appendChild(p)}else if(f==="triangle"){const p=B("path");p.setAttribute("d",N(g,S,3,w,-90)),p.setAttribute("fill",a.color||"#000"),A.appendChild(p)}else if(f==="pentagon"){const p=B("path");p.setAttribute("d",N(g,S,5,w,-90)),p.setAttribute("fill",a.color||"#000"),A.appendChild(p)}else if(f==="hexagon"){const p=B("path");p.setAttribute("d",N(g,S,6,w,0)),p.setAttribute("fill",a.color||"#000"),A.appendChild(p)}else if(f==="star"){const p=B("path"),ot=w,gt=w*.5;p.setAttribute("d",D(g,S,5,ot,gt)),p.setAttribute("fill",a.color||"#000"),A.appendChild(p)}else{const p=B("rect");p.setAttribute("x",String(u)),p.setAttribute("y",String(n+(e.height-o.markerSize)/2)),p.setAttribute("width",String(o.markerSize)),p.setAttribute("height",String(o.markerSize)),p.setAttribute("fill",a.color||"#000"),A.appendChild(p)}const L=u+o.markerSize+o.markerTextGap,X=n+(e.height-a.lines.length*o.lineHeight)/2+o.fontSize,R=B("text");R.setAttribute("x",String(L)),R.setAttribute("y",String(X)),R.setAttribute("style","font-family:".concat(l,"; font-size:").concat(o.fontSize,"px; font-weight:").concat(o.bold?"600":"400","; fill:").concat(o.color,";")),R.setAttribute("dominant-baseline","ideographic");let ht=!0;for(const p of a.lines){const ot=B("tspan");ht||ot.setAttribute("dy",String(o.lineHeight)),ot.setAttribute("x",String(L)),ot.textContent=p,R.appendChild(ot),ht=!1}A.appendChild(R),u+=a.itemW+(s<e.items.length-1?o.itemGapX:0)}n+=e.height+o.itemGapY}H.length&&(n-=o.itemGapY);const t=n+o.paddingY;return $.setAttribute("x","0"),$.setAttribute("y","0"),$.setAttribute("width",String(o.maxWidth)),$.setAttribute("height",String(t)),m.remove(),t+Math.round(o.fontSize*.4)}function lt(i){const r=i.cloneNode(!0);return r.querySelectorAll("script").forEach(c=>c.remove()),v(i,r),P(r),r}function ft(i){const r=Array.from(i.childNodes).filter(l=>l.nodeType===1&&l.nodeName.toLowerCase()==="defs"),c=Array.from(i.childNodes).filter(l=>!(l.nodeType===1&&l.nodeName.toLowerCase()==="defs")),h=document.createElementNS(K,"g");h.setAttribute("id","__vdu_export_content");for(const l of c)h.appendChild(l);for(const l of r)i.appendChild(l);return i.appendChild(h),h}function V(i,r){r<=0||i.setAttribute("transform","translate(0, ".concat(r,")"))}function ut(i,r){if(r<=0)return;const c=T(i),h=i.getAttribute("height");if(c)i.setAttribute("viewBox","".concat(c.minX," ").concat(c.minY," ").concat(c.width," ").concat(c.height+r)),h&&i.setAttribute("height",String(Number(h)+r));else if(h)i.setAttribute("height",String(Number(h)+r));else{const l=i.getBBox();i.setAttribute("viewBox","0 0 ".concat(Math.max(1,l.width)," ").concat(Math.max(1,l.height+r)))}}function q(i){const r=T(i);if(r)return r.width;const c=Number(i.getAttribute("width"));return!Number.isNaN(c)&&c>0?c:i.getBBox().width||0}function I(i){const r=T(i);if(r)return r.height;const c=Number(i.getAttribute("height"));return!Number.isNaN(c)&&c>0?c:i.getBBox().height||0}async function Q(i){var c,h,l;const r=tt(i);$t();try{if((c=document.fonts)!=null&&c.ready)try{await Promise.race([document.fonts.ready,new Promise(D=>setTimeout(D,4e3))])}catch(D){}const o=ft(i),y=T(i),$=y?y.minX:0,A=y?y.minY:0,m=Math.max(1,q(i)),_=Math.max(1,I(i)),F=St(pt(i).getPropertyValue("font-family")||"");let G=(h=rt?null:nt(i,m,$,A,F))!=null?h:0;const O=k&&k.value&&k.value.position?String(k.value.position).toLowerCase():"top";k&&k.value&&k.value.show&&O==="top"&&(G+=Y(i,m,$,A+G,F)),V(o,G);let N=0;k&&k.value&&k.value.show&&O==="bottom"&&(N+=Y(i,m,$,A+G+_,F)),ut(i,G+N),i.style.backgroundColor=(l=it.value)!=null?l:"#FFF",await Ht(i,{mode:"raster"}),Gt(i,C.value.text?-6:-48)}finally{dt(r),$t()}}async function ct(){const i=await b(),r=lt(i);await Q(r);const c='<?xml version="1.0" standalone="no"?>\n'.concat(new XMLSerializer().serializeToString(r)),h=new Blob([c],{type:"image/svg+xml;charset=utf-8"}),l=URL.createObjectURL(h),o="data:image/svg+xml;charset=utf-8,".concat(encodeURIComponent(c));return{blob:h,url:l,text:c,dataUrl:o}}async function at(i){var l;const{url:r}=await ct(),c=i||((l=C.value)==null?void 0:l.text)||"chart",h=document.createElement("a");h.href=r,h.download=c.endsWith(".svg")?c:"".concat(c,".svg"),document.body.appendChild(h),h.click(),document.body.removeChild(h),URL.revokeObjectURL(r)}return{ready:J,getSvg:ct,exportSvg:at}}function Gt(M,C=-50){if(!C)return;const k=M.getAttribute("viewBox"),et=E=>{if(!E)return;const U=M.getAttribute("height");if(!U)return;const b=/^(\d+(\.\d+)?)(px)?$/.exec(U.trim());if(!b)return;const d=parseFloat(b[1])||0,x=Math.max(1,d+E);M.setAttribute("height",String(x))};if(k){const E=k.trim().split(/\s+|,/).map(Number);if(E.length!==4||E.some(P=>!Number.isFinite(P)))return;const[U,b,d,x]=E,z=b+C,v=-C,T=Math.max(1,x+v);M.setAttribute("viewBox","".concat(U," ").concat(z," ").concat(d," ").concat(T)),et(v);return}let it=Number(M.getAttribute("width")),j=Number(M.getAttribute("height"));if(!(it>0&&j>0)){const E=M.getBBox();it=Math.max(1,E.width||1),j=Math.max(1,E.height||1)}const rt=C,st=-C,J=Math.max(1,j+st);M.setAttribute("viewBox","0 ".concat(rt," ").concat(it," ").concat(J)),(function(){const E=M.getAttribute("height");if(!E)return;const U=/^(\d+(\.\d+)?)(px)?$/.exec(E.trim());if(!U)return;const b=parseFloat(U[1])||0,d=Math.max(1,b+st);M.setAttribute("height",String(d))})()}async function Ht(M,{mode:C="raster"}={}){const k=Array.from(M.querySelectorAll("foreignObject"));if(!k.length)return{converted:0,rasterized:0,skipped:0,errors:0};let et=0,it=0,j=0,rt=0;const st=b=>["div","p","span","strong","em","b","i","br"].includes(b),J=b=>{var d;try{const x=b.firstElementChild;if(!x)return!1;const z=[x];for(;z.length;){const v=z.pop();if(v.nodeType===3)continue;if(v.nodeType!==1)return!1;const T=(v.tagName||"").toLowerCase();if(!st(T)||(d=v.querySelector)!=null&&d.call(v,"img,svg,canvas,video,foreignObject"))return!1;for(const P of Array.from(v.childNodes))z.push(P)}return!0}catch(x){return!1}};function E(b){var d;try{const x=b.firstElementChild;if(!x)return null;const z=(n,t=0)=>Number.isFinite(+n)?+n:t,v=z(b.getAttribute("x"),0),T=z(b.getAttribute("y"),0);let P=z(b.getAttribute("width"),NaN);if(!Number.isFinite(P)||P<=0){const n=(d=b.getBBox)==null?void 0:d.call(b);P=Math.max(1,z(n==null?void 0:n.width,0))}const tt=(n,t)=>{if(!n)return Math.round(t*1.2);const e=n.trim().toLowerCase();if(e==="normal")return Math.round(t*1.2);if(e.endsWith("px"))return parseFloat(e)||Math.round(t*1.2);if(e.endsWith("%"))return parseFloat(e)/100*t||Math.round(t*1.2);if(e.endsWith("em"))return(parseFloat(e)||1)*t;if(e.endsWith("rem")){const s=parseFloat(getComputedStyle(document.documentElement).fontSize)||t;return(parseFloat(e)||1)*s}const u=Number(e);return Number.isFinite(u)?u*t:Math.round(t*1.2)},dt=n=>{const t=u=>{const s=(u||"").trim().toLowerCase();if(s.endsWith("px"))return parseFloat(s)||0;if(s.endsWith("rem")){const g=parseFloat(getComputedStyle(document.documentElement).fontSize)||16;return(parseFloat(s)||0)*g}if(s.endsWith("em")){const g=parseFloat(getComputedStyle(document.body).fontSize)||16;return(parseFloat(s)||0)*g}const a=Number(s);return Number.isFinite(a)?a:0},e=(n||"").split(/\s+/).map(t).filter(Number.isFinite);return e.length?e.length===1?[e[0],e[0],e[0],e[0]]:e.length===2?[e[0],e[1],e[0],e[1]]:e.length===3?[e[0],e[1],e[2],e[1]]:[e[0],e[1],e[2],e[3]]:[0,0,0,0]},nt=(n,t)=>{var Mt;const e=pt(n);let u=e.getPropertyValue("font-family")||(t==null?void 0:t.ff)||"system-ui";u=St(u);let s=parseFloat(e.getPropertyValue("font-size"));Number.isFinite(s)||(s=(t==null?void 0:t.fs)||14);const a=e.getPropertyValue("font-weight")||(t==null?void 0:t.fw)||"400",g=e.getPropertyValue("font-style")||(t==null?void 0:t.fsty)||"normal",S=e.getPropertyValue("font-stretch")||(t==null?void 0:t.fstc)||"normal",w=e.getPropertyValue("letter-spacing")||(t==null?void 0:t.lsp)||"normal",f=e.getPropertyValue("word-spacing")||(t==null?void 0:t.wsp)||"0px",L=e.getPropertyValue("font-kerning")||(t==null?void 0:t.kern)||"auto",X=e.getPropertyValue("font-variant-ligatures")||(t==null?void 0:t.liga)||"normal",R=e.getPropertyValue("text-transform")||(t==null?void 0:t.ttfm)||"none",ht=e.getPropertyValue("color")||(t==null?void 0:t.fill)||"#000",p=e.getPropertyValue("line-height"),ot=!p||p.trim().toLowerCase()==="normal"?(Mt=t==null?void 0:t.lh)!=null?Mt:Math.round(s*1.2):tt(p,s),gt=(e.getPropertyValue("text-align")||(t==null?void 0:t.ta)||"start").trim().toLowerCase();let mt=parseFloat(e.getPropertyValue("padding-top"))||0,bt=parseFloat(e.getPropertyValue("padding-right"))||0,xt=parseFloat(e.getPropertyValue("padding-bottom"))||0,yt=parseFloat(e.getPropertyValue("padding-left"))||0;const vt=e.getPropertyValue("padding");if(vt&&mt===0&&bt===0&&xt===0&&yt===0){const[Nt,Lt,Pt,Vt]=dt(vt);mt=Nt,bt=Lt,xt=Pt,yt=Vt}const kt=parseFloat(e.getPropertyValue("border-left-width"))||0,zt=parseFloat(e.getPropertyValue("border-right-width"))||0,_t=e.getPropertyValue("box-sizing")||"content-box";return{ff:u,fs:s,fw:a,fsty:g,fstc:S,lsp:w,wsp:f,kern:L,liga:X,ttfm:R,fill:ht,lh:ot,ta:gt,padL:yt,padR:bt,padT:mt,padB:xt,bL:kt,bR:zt,box:_t}},Y=n=>/^(div|p|section|article|ul|ol|li|h[1-6])$/.test(n),lt={__para__:!0},ft={__br__:!0},V=[],ut=nt(x),q=(n,t,e)=>{if(n.nodeType===3){const a=(n.nodeValue||"").replace(/\s+/g," ").trim();a&&V.push({text:a,style:t,path:e.slice()});return}if(n.nodeType!==1)return;const u=n.tagName.toLowerCase();if(u==="br"){V.push({...ft,path:e.slice()});return}const s=nt(n,t);e.push(n);for(const a of Array.from(n.childNodes))q(a,s,e);e.pop(),Y(u)&&V.push({...lt,path:e.slice()})};for(q(x,ut,[x]);V.length&&(V.at(-1).__para__||V.at(-1).__br__);)V.pop();if(!V.length)return null;const I=V.filter(n=>!n.__para__&&!n.__br__),Q=(()=>{if(!I.length)return[x];const n=I.map(u=>u.path),t=Math.min(...n.map(u=>u.length));let e=0;for(;e<t;){const u=n[0][e];if(n.every(s=>s[e]===u))e+=1;else break}return n[0].slice(0,Math.max(1,e))})(),ct=Q[Q.length-1]||x,at=nt(ct);let i=0,r=0,c=0;for(const n of Q){const t=nt(n);i+=t.padL,r+=t.padR,c+=t.padT}const h=[Math.max(1,P-i-r)];for(const n of Q)try{const t=pt(n);if(n.clientWidth&&n.clientWidth>0){const s=parseFloat(t.paddingLeft)||0,a=parseFloat(t.paddingRight)||0,g=Math.max(1,n.clientWidth-s-a);h.push(g)}const e=t.width,u=parseFloat(e);if(Number.isFinite(u)&&u>0){const s=t.boxSizing||t.getPropertyValue("box-sizing")||"content-box",a=parseFloat(t.paddingLeft)||0,g=parseFloat(t.paddingRight)||0,S=parseFloat(t.borderLeftWidth)||0,w=parseFloat(t.borderRightWidth)||0,f=s==="border-box"?Math.max(1,u-a-g-S-w):Math.max(1,u);h.push(f)}}catch(t){}let l=Math.floor(Math.min(...h.filter(Number.isFinite)))-1;l>0||(l=1);let o="start",y=v+i;at.ta==="center"?(o="middle",y=v+i+l/2):(at.ta==="right"||at.ta==="end")&&(o="end",y=v+(P-r));const $=b.ownerSVGElement||b.closest("svg"),A=document.createElementNS(K,"text");A.setAttribute("x",String(y)),A.setAttribute("y",String(T+c)),A.setAttribute("text-anchor",o),A.setAttribute("dominant-baseline","text-before-edge"),A.setAttribute("xml:space","preserve");const m=document.createElementNS(K,"text");m.setAttribute("x","0"),m.setAttribute("y","0"),m.setAttribute("opacity","0"),($||b).appendChild(m);const _=n=>"font-family:".concat(n.ff,"; font-size:").concat(n.fs,"px; font-weight:").concat(n.fw,"; font-style:").concat(n.fsty,"; font-stretch:").concat(n.fstc,"; letter-spacing:").concat(n.lsp,"; word-spacing:").concat(n.wsp,"; font-kerning:").concat(n.kern,"; font-variant-ligatures:").concat(n.liga,"; text-transform:").concat(n.ttfm,";"),F=(n,t)=>(m.textContent=n||"",m.setAttribute("style",_(t)),m.getComputedTextLength()),G=n=>F(" ",n),O=[];let N=[],D=0;const Z=()=>{N.length&&O.push({segs:N.slice()}),N=[],D=0},H=(n,t,e)=>{let u=F(n,t);if(e){const s=G(t);u+=s,N.push({text:" ",...t,w:s,isSpace:!0})}N.push({text:n,...t,w:u}),D+=u},W=(n,t,e)=>{let u="";for(const s of n){const a=u+s;if(F(a,t)<=e)u=a;else break}return u||n[0]||""};for(const n of V){if(n.__para__||n.__br__){Z();continue}const t=n.style,e=n.text.split(/(\s+)/).filter(a=>a.length>0),u=(a,g)=>{if(!a)return;const S=Math.max(1,l),w=F(a,t)+(g?G(t):0);if(N.length===0)if(w<=S)H(a,t,!1);else{let f=a;for(;f;){const L=W(f,t,S);H(L,t,!1),f=f.slice(L.length),f&&Z()}}else if(D+w<=S)H(a,t,g);else if(Z(),F(a,t)<=S)H(a,t,!1);else{let f=a;for(;f;){const L=W(f,t,S);H(L,t,!1),f=f.slice(L.length),f&&Z()}}};let s=!1;for(const a of e){if(/^\s+$/.test(a)){s=!0;continue}u(a,s),s=!1}}Z();for(let n=0;n<O.length;n+=1){const t=O[n].segs,e=Math.max(...t.map(s=>s.fs||at.fs),at.fs);let u=!0;for(const s of t){const a=document.createElementNS(K,"tspan");u&&(a.setAttribute("x",String(y)),n>0&&a.setAttribute("dy",String(e)),u=!1),a.setAttribute("style","".concat(_(s)," fill:").concat(s.fill,";")),a.textContent=s.text,A.appendChild(a)}if(!t.length&&n>0){const s=document.createElementNS(K,"tspan");s.setAttribute("x",String(y)),s.setAttribute("dy",String(e)),s.textContent="",A.appendChild(s)}}try{m.remove()}catch(n){}return A}catch(x){return null}}const U=b=>{try{const d=document.createElement("div");d.style.position="absolute",d.style.left="-99999px",d.style.top="-99999px",d.style.visibility="hidden",d.style.pointerEvents="none",d.style.width="auto",d.style.height="auto";const x=b.cloneNode(!0);x.style.width="auto",x.style.height="auto",x.style.display="inline-block",x.style.maxWidth="none",x.style.maxHeight="none",x.style.boxSizing="content-box",document.body.appendChild(d),d.appendChild(x);const z=x.getBoundingClientRect(),v=Math.ceil(z.width||x.scrollWidth||0),T=Math.ceil(z.height||x.scrollHeight||0);return d.remove(),{w:Math.max(1,v),h:Math.max(1,T)}}catch(d){return{w:0,h:0}}};for(const b of k)try{if(b.hasAttribute("data-no-svg-export")){b.remove(),j+=1;continue}if(J(b)){const d=E(b);if(d){b.parentNode.replaceChild(d,b),et+=1;continue}}j+=1}catch(d){rt+=1}if(C==="raster"){const b=Array.from(M.querySelectorAll("foreignObject"));for(const d of b)try{if(d.hasAttribute("data-no-svg-export")){d.remove(),j+=1;continue}await new Promise(I=>requestAnimationFrame(I));const x=d.getBBox();let z=Math.max(1,Math.ceil(x.width)),v=Math.max(1,Math.ceil(x.height));const T=d.firstElementChild;if(T){const I=U(T),Q=parseFloat(d.getAttribute("width")||"0")||0,ct=parseFloat(d.getAttribute("height")||"0")||0;z=Math.max(z,Q,I.w),v=Math.max(v,ct,I.h)}if(!(z>0&&v>0)){j+=1;continue}const P=document.createElementNS(K,"svg");P.setAttribute("xmlns",K),P.setAttribute("xmlns:xlink",At),P.setAttribute("width",String(z)),P.setAttribute("height",String(v)),P.setAttribute("viewBox","0 0 ".concat(z," ").concat(v));const tt=d.cloneNode(!0);tt.setAttribute("x","0"),tt.setAttribute("y","0"),tt.setAttribute("width",String(z)),tt.setAttribute("height",String(v)),P.appendChild(tt);const dt=new XMLSerializer().serializeToString(P),nt="data:image/svg+xml;charset=utf-8,"+encodeURIComponent(dt),Y=document.createElement("canvas"),lt=2;Y.width=Math.max(1,Math.floor(z*lt)),Y.height=Math.max(1,Math.floor(v*lt));const ft=Y.getContext("2d"),V=new Image;V.decoding="sync",V.crossOrigin="anonymous",await new Promise((I,Q)=>{V.onload=I,V.onerror=Q,V.src=nt}),ft.drawImage(V,0,0,Y.width,Y.height);const ut=Y.toDataURL("image/png"),q=document.createElementNS(K,"image");q.setAttributeNS(At,"href",ut),q.setAttribute("href",ut),q.setAttribute("x",d.getAttribute("x")||String(x.x)),q.setAttribute("y",d.getAttribute("y")||String(x.y)),q.setAttribute("width",String(z)),q.setAttribute("height",String(v)),d.parentNode.replaceChild(q,d),it+=1}catch(x){rt+=1}}return{converted:et,rasterized:it,skipped:j,errors:rt}}export{jt as O};
