
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * https://fantastic-admin.hurui.me
 */
    
const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./Tooltip-D0pGX8qz-BS2YwyOE.js","./vue-data-ui-8Gmf-dDN.js","./index-CJB5jCfL.js","./index-D6D_bXIl.css","./alert-I_0TAljB.js","./vue-data-ui-C46fMXq5.css","./vue-ui-accordion-DNRtKVZI-Cfsr7GT0.js","./useNestedProp-DaR1dBmj-yWXLkJlG.js","./DataTable-BfEbVwm4-B-GxLkq-.js","./Shape-12_eh8zD-Cy1mu6XW.js","./PenAndPaper--ADXtx65-ugytqLuo.js","./ColorPicker-BYn8PF2Z-DkxHqz9_.js","./vClickOutside-C6WiFswA-B2BXHGcD.js","./UserOptions-Cy-iNhZU-CnpDVImt.js","./img-CqYIrJ8I-E54QgU9o.js","./dom-to-png-WXGPkYro-BQsfl1t5.js","./PackageVersion-By5ZZJ0U-Cc8IPeAX.js","./BaseDraggableDialog-BFDTrOH0-Bty23wRr.js"])))=>i.map(i=>d[i]);
import{e as c,J as g,E as No,a8 as Po,K as Oe,c1 as Y,c as b,o as v,z as ee,A as x,f as G,g as Se,h,r as p,j as P,k as M,u as s,c3 as Gt,O as H,n as Ht,F as pe,R as fe,Y as Qe,Z as et,t as be,bq as Mo,l as Wt,m as zo,N as Lo,c4 as W,aa as Ut}from"./index-CJB5jCfL.js";import{s as Ro,J as De,x as Vo,E as Kt,A as jo,v as Yo,o as V,$ as Go,c as F,u as Ho,F as ae,d as Wo,L as Be,m as qt,a2 as Uo,e as Ko,f as qo,g as Jo}from"./vue-data-ui-8Gmf-dDN.js";import{E as Xo,M as Zo}from"./useResponsive-DfdjqQps-DzVAt69W.js";import{s as Qo,i as tt}from"./useNestedProp-DaR1dBmj-yWXLkJlG.js";import{m as el}from"./usePrinter-ChVMpU2f-B27PF0nl.js";import{T as tl,j as ol}from"./BaseScanner-BMpwQAfz-mc47WWxo.js";import{O as ll}from"./useSvgExport-ByUukOZt-XO0OK7cR.js";import{i as al}from"./useThemeCheck-DGJ31Vi5-GRZcYzX8.js";import{a as rl}from"./useUserOptionState-BIvW1Kz7-D70wY835.js";import{o as nl}from"./useChartAccessibility-9icAAmYg-CuAxjhEs.js";import sl from"./Legend-D2xmnFPH-CItLelVI.js";import ul from"./Title-D0nD-PMs-DAiwElB_.js";import il from"./img-CqYIrJ8I-E54QgU9o.js";import"./alert-I_0TAljB.js";import"./Shape-12_eh8zD-Cy1mu6XW.js";import"./dom-to-png-WXGPkYro-BQsfl1t5.js";const Jt={style:{chart:{backgroundColor:"#1A1A1A",color:"#CCCCCC",tooltip:{backgroundColor:"#1A1A1A",backgroundOpacity:70,color:"#CCCCCC",borderColor:"#5A5A5A"},legend:{backgroundColor:"#1A1A1A",color:"#CCCCCC"},title:{color:"#CCCCCC",subtitle:{color:"#757575"}},nodes:{stroke:"#1A1A1A"},links:{stroke:"#5A5A5A"}}},table:{th:{backgroundColor:"#1A1A1A",color:"#CCCCCC"},td:{backgroundColor:"#1A1A1A",color:"#CCCCCC"}}},Xt={style:{chart:{backgroundColor:"#FFF8E1",color:"#424242",tooltip:{backgroundColor:"#FFECB3",backgroundOpacity:30,color:"#424242",borderColor:"#FF8A65"},legend:{backgroundColor:"#FFF8E1",color:"#424242"},title:{color:"#424242",subtitle:{color:"#757575"}},nodes:{stroke:"#3A3A3A"},links:{stroke:"#3A3A3A"}}},table:{th:{backgroundColor:"#FFF8E1",color:"#424242"},td:{backgroundColor:"#FFF8E1",color:"#424242"}}},Zt={style:{chart:{backgroundColor:"#1E1E1E",color:"#BDBDBD",tooltip:{backgroundColor:"#1E1E1E",backgroundOpacity:30,color:"#FFF8E1",borderColor:"#FF8A65"},title:{color:"#FFF8E1",subtitle:{color:"#BDBDBD"}},legend:{backgroundColor:"#1E1E1E",color:"#BDBDBD"},nodes:{stroke:"#1E1E1E"},links:{stroke:"#1E1E1E"}}},table:{th:{backgroundColor:"#1E1E1E",color:"#BDBDBD"},td:{backgroundColor:"#1E1E1E",color:"#BDBDBD"}}},Qt={style:{chart:{backgroundColor:"#1A1A1A",color:"#99AA99",tooltip:{backgroundColor:"#2A2F2A",color:"#AACCAA",borderColor:"#66CC66"},title:{color:"#66CC66",subtitle:{color:"#99AA99"}},legend:{backgroundColor:"#1A1A1A",color:"#99AA99"},nodes:{stroke:"#1A1A1A"},links:{stroke:"#1A1A1A"}}},table:{th:{backgroundColor:"#1A1A1A",color:"#99AA99"},td:{backgroundColor:"#1A1A1A",color:"#AACCAA"}}},eo={style:{chart:{backgroundColor:"#fbfafa",color:"#8A9892",tooltip:{backgroundColor:"#fbfafa",color:"#8A9892"},title:{color:"#8A9892",subtitle:{color:"#99AA99"}},legend:{backgroundColor:"#fbfafa",color:"#99AA99"},nodes:{stroke:"#fbfafa"},links:{stroke:"#fbfafa"}}},table:{th:{backgroundColor:"#fbfafa",color:"#8F837A"},td:{backgroundColor:"#fbfafa",color:"#8F837A"}}},to={style:{chart:{backgroundColor:"#f6f6fb",color:"#50606C",tooltip:{backgroundColor:"#f6f6fb",color:"#50606C"},title:{color:"#50606C",subtitle:{color:"#718890"}},legend:{backgroundColor:"#f6f6fb",color:"#61747E"},nodes:{stroke:"#f6f6fb"},links:{stroke:"#f6f6fb"}}},table:{th:{backgroundColor:"#f6f6fb",color:"#50606C"},td:{backgroundColor:"#f6f6fb",color:"#50606C"}}},oo={default:{},dark:Jt,celebration:Xt,celebrationNight:Zt,hack:Qt,zen:eo,concrete:to},Hl=Object.freeze(Object.defineProperty({__proto__:null,celebration:Xt,celebrationNight:Zt,concrete:to,dark:Jt,default:oo,hack:Qt,zen:eo},Symbol.toStringTag,{value:"Module"})),cl=["id"],vl={key:1,ref:"noTitle",class:"vue-data-ui-no-title-space",style:"height:36px; width: 100%;background:transparent"},dl=["id"],hl=["xmlns","viewBox"],gl=["width","height"],pl=["id"],fl=["stop-color"],bl=["stop-color"],ml=["d","fill","stroke","stroke-width"],yl=["x","y","height","width","fill","stroke","stroke-width","rx","aria-label","onMouseenter","onMouseleave","onClick","onKeydown","onFocus","onBlur"],Cl={key:1},kl=["x","y","font-size","fill"],Al=["x","y","font-size","fill"],wl={key:4,class:"vue-data-ui-watermark"},$l=["id"],xl=["onClick"],_l=["innerHTML"],El={__name:"vue-ui-flow",props:{config:{type:Object,default(){return{}}},dataset:{type:Array,default(){return[]}}},setup(lo,{expose:ao}){const ro=Y(()=>W(()=>import("./Tooltip-D0pGX8qz-BS2YwyOE.js"),__vite__mapDeps([0,1,2,3,4,5]),import.meta.url)),no=Y(()=>W(()=>import("./vue-data-ui-8Gmf-dDN.js").then(o=>o.aA),__vite__mapDeps([1,2,3,4,5]),import.meta.url)),so=Y(()=>W(()=>import("./vue-ui-accordion-DNRtKVZI-Cfsr7GT0.js"),__vite__mapDeps([6,2,3,1,4,5,7]),import.meta.url)),uo=Y(()=>W(()=>import("./DataTable-BfEbVwm4-B-GxLkq-.js"),__vite__mapDeps([8,2,3,9,1,4,5]),import.meta.url)),io=Y(()=>W(()=>import("./PenAndPaper--ADXtx65-ugytqLuo.js"),__vite__mapDeps([10,2,3,1,4,5,11,12]),import.meta.url)),co=Y(()=>W(()=>import("./UserOptions-Cy-iNhZU-CnpDVImt.js"),__vite__mapDeps([13,2,3,12,1,4,5,14,15]),import.meta.url)),vo=Y(()=>W(()=>import("./PackageVersion-By5ZZJ0U-Cc8IPeAX.js"),__vite__mapDeps([16,2,3]),import.meta.url)),ho=Y(()=>W(()=>import("./BaseDraggableDialog-BFDTrOH0-Bty23wRr.js"),__vite__mapDeps([17,2,3,1,4,5]),import.meta.url)),{vue_ui_flow:go}=Qo(),{isThemeValid:po,warnInvalidTheme:fo}=al(),T=lo,U=c(De()),N=c(null),ot=c(0),lt=c(0),Ie=c(!1),Ne=c(""),at=c(null),rt=c(null),nt=c(null),re=c(null),me=c(null),st=c(!1),ne=c(null),Pe=c(null),Me=c(null),ut=g(()=>!!T.dataset&&T.dataset.length);No(()=>{st.value=!0,ct()});const K=c(!1);function it(o){K.value=o,ot.value+=1}const e=c(je()),{loading:ze,FINAL_DATASET:ye,manualLoading:Le}=tl({...Po(T),FINAL_CONFIG:e,prepareConfig:je,skeletonDataset:[["A","B",2,"#CACACA"],["B","C",1,"#CACACA"],["C","D",.5,"#CACACA"],["E","F",1,"#AAAAAA"],["F","G",.5,"#AAAAAA"],["G","H",.25,"#AAAAAA"]],skeletonConfig:Vo({defaultConfig:e.value,userConfig:{userOptions:{show:!1},nodeCategories:{B:"A",C:"B"},nodeCategoryColors:{A:"#CACACA",B:"#AAAAAA"},table:{show:!1},style:{chart:{backgroundColor:"#99999930",legend:{backgroundColor:"transparent"},nodes:{labels:{show:!1},stroke:"#666666"},links:{stroke:"#666666"}}}}})}),bo=g(()=>!!e.value.debug);function ct(){if(Kt(T.dataset)&&(jo({componentName:"VueUiFlow",type:"dataset",debug:bo.value}),Le.value=!0),Kt(T.dataset)||(Le.value=e.value.loading),e.value.responsive){const o=Xo(()=>{const{width:l,height:t}=Zo({chart:N.value,title:e.value.style.chart.title.text?rt.value:null,legend:e.value.style.chart.legend.show?at.value:null,source:nt.value});requestAnimationFrame(()=>{ht.value=l,gt.value=t})});re.value&&(me.value&&re.value.unobserve(me.value),re.value.disconnect()),re.value=new ResizeObserver(o),me.value=N.value.parentNode,re.value.observe(me.value)}}const{userOptionsVisible:Re,setUserOptionsVisibility:vt,keepUserOptionState:dt}=rl({config:e.value}),{svgRef:Ve}=nl({config:e.value.style.chart.title});function je(){const o=tt({userConfig:T.config,defaultConfig:go});let l=o;const t=o.theme;if(t)if(!po.value(o))fo(o),l=o;else{const a=tt({userConfig:oo[t]||T.config,defaultConfig:o});l={...tt({userConfig:T.config,defaultConfig:a}),customPalette:o.customPalette.length?o.customPalette:Yo[t]||V}}else l=o;return l.nodeCategories=T.config.nodeCategories||{},l.nodeCategoryColors=T.config.nodeCategoryColors||{},l}const ht=c(e.value.style.chart.width),gt=c(e.value.style.chart.height);Oe(()=>T.config,o=>{ze.value||(e.value=je()),Re.value=!e.value.userOptions.showOnChartHover,ct(),lt.value+=1,O.value.showTable=e.value.table.show},{deep:!0}),Oe(()=>T.dataset,o=>{Array.isArray(o)&&o.length>0&&(Le.value=!1)},{deep:!0});const{isPrinting:pt,isImaging:ft,generatePdf:bt,generateImage:mt}=el({elementId:"flow_".concat(U.value),fileName:e.value.style.chart.title.text||"vue-ui-flow",options:e.value.userOptions.print}),mo=g(()=>e.value.userOptions.show&&!e.value.style.chart.title.text),Ce=g(()=>Go(e.value.customPalette)),ke=g(()=>e.value.style.chart.nodes.width),O=c({showTable:e.value.table.show,showTooltip:e.value.style.chart.tooltip.show});Oe(e,()=>{O.value={showTable:e.value.table.show,showTooltip:e.value.style.chart.tooltip.show}},{immediate:!0});const yt=g(()=>!ye.value||!ye.value.length?[]:ye.value.map((o,l)=>[o[0],o[1],F(o[2]),o[3]?Ho(o[3]):Ce.value[l]||Ce.value[l%Ce.value.length]||V[l]||V[l%V.length]]));function yo(o){var Dt,Bt;const l={},t={};function a(r,u){l[r]||(l[r]={level:null,inflow:0,outflow:0,children:[],color:null,uid:De()}),l[r].level===null&&(l[r].level=u),t[u]||(t[u]=[]),t[u].includes(r)||t[u].push(r)}o.forEach(([r,u,i])=>{var f,$;const y=($=(f=l[r])==null?void 0:f.level)!=null?$:0,w=y+1;a(r,y),a(u,w),l[r].children.push({target:u,value:i}),l[r].outflow+=i,l[u].inflow+=i});const n=new Set(o.map(([r])=>r)),_=new Set(o.map(([,r])=>r)),oe=Array.from(n).filter(r=>!_.has(r)),ve={};oe.forEach((r,u)=>{ve[r]=Ce.value[u]||V[u%V.length]});const de={};o.forEach(([r,u,i,y])=>{y&&(de[r]=y,de[u]=y)}),Object.keys(l).forEach((r,u)=>{var w,f;const i=(w=e.value.nodeCategories)==null?void 0:w[r],y=i?(f=e.value.nodeCategoryColors)==null?void 0:f[i]:null;l[r].color=de[r]||y||(oe.includes(r)?ve[r]:null)||V[u%V.length]}),Object.keys(l).forEach(r=>{l[r].value=Math.max(l[r].inflow,l[r].outflow)});const Ee=se.value,Ke=At.value.width,le=At.value.height,L=Object.keys(t).map(Number).sort((r,u)=>r-u),Fe=L.length||1,qe=Fe>1?Ke/(Fe-1):0,D=Number(ke.value),z=Number((Bt=(Dt=e.value.style.chart.nodes.gapPx)!=null?Dt:e.value.style.chart.nodes.gap)!=null?Bt:8),he=Number(e.value.style.chart.nodes.minHeight||0);function d(r){const u=t[r],i=u.length;if(!i)return 1/0;const y=Math.max(0,(i-1)*z),w=Math.max(0,le-y),f=Math.min(he,i?w/i:0);let $=0,B=u.map(C=>l[C].value||0),k=B.reduce((C,I)=>C+I,0);for(let C=0;C<12;C+=1){const I=k>0?(w-$)/k:0,R=[];for(let E=0;E<B.length;E+=1){const j=B[E];j<0||j*I<f&&R.push(E)}if(!R.length)return Math.max(0,I);for(const E of R)$+=f,k-=B[E],B[E]=-1;if(k<=0)return 0}return k>0?Math.max(0,(w-$)/k):0}const m=L.map(d),J=m.length?Math.min(...m):0,X={};L.forEach(r=>{const u=t[r],i=u.length,y=Math.max(0,(i-1)*z),w=Math.max(0,le-y),f=Math.min(he,i?w/i:0),$=u.map(C=>Math.max(f,(l[C].value||0)*J)),B=$.reduce((C,I)=>C+I,0)+y;let k=Math.max(0,(le-B)/2);u.forEach((C,I)=>{const R=$[I],E=Ee.left+r*qe,j=k;X[C]={x:E,y:j,absoluteY:j,height:R,i:I,color:l[C].color,value:l[C].value,id:De()},k+=R,I<i-1&&(k+=z)})});const Ot=[],ge=Ee.top,Je={},Xe={};Object.keys(l).forEach(r=>{var u,i;Je[r]=(i=(u=X[r])==null?void 0:u.y)!=null?i:0,Xe[r]=0});const So=1e-6,Do=.25,Bo=!!e.value.style.chart.links.smooth,St=.5;return L.forEach(r=>{t[r].forEach(u=>{const i=l[u],y=X[u];if(!i.children||!i.children.length)return;let w=y.y;i.children.forEach(({target:f,value:$})=>{const B=X[f],k=l[f],C=i.outflow>0?$/i.outflow:0,I=k.inflow>0?$/k.inflow:0,R=F(w+ge),E=F(w+C*y.height+ge),j=Je[f];let Te=j+I*B.height;Xe[f]+=$;const Io=k.inflow>0&&Xe[f]>=k.inflow-So,It=B.y+B.height;(Io||Te>It-Do)&&(Te=It);const Nt=F(j+ge),Pt=F(Te+ge),Z=F(y.x+D),Q=F(B.x);let Ze;if(!Bo||Q<=Z)Ze="M ".concat(Z," ").concat(R," L ").concat(Z," ").concat(E," L ").concat(Q," ").concat(Pt," L ").concat(Q," ").concat(Nt," Z");else{const Mt=Q-Z,zt=F(Z+Mt*St),Lt=F(Q-Mt*St),Rt=R,Vt=Nt,jt=E,Yt=Pt;Ze="M ".concat(Z," ").concat(Rt," C ").concat(zt," ").concat(Rt,", ").concat(Lt," ").concat(Vt,", ").concat(Q," ").concat(Vt," L ").concat(Q," ").concat(Yt," C ").concat(Lt," ").concat(Yt,", ").concat(zt," ").concat(jt,", ").concat(Z," ").concat(jt," Z")}Ot.push({id:De(),source:u,target:f,path:Ze,value:$,sourceColor:i.color,targetColor:l[f].color}),w=E-ge,Je[f]=Te})})}),{nodeCoordinates:X,links:Ot}}const S=g(()=>{const o=yo(ye.value);return{nodes:Object.keys(o.nodeCoordinates).map((l,t)=>({...o.nodeCoordinates[l],name:l})),links:o.links}}),Ct=g(()=>ht.value),kt=g(()=>gt.value),se=g(()=>e.value.style.chart.padding),At=g(()=>({width:Math.max(0,Ct.value-40-se.value.right-se.value.left),height:Math.max(0,kt.value-se.value.top-se.value.bottom)})),ue=g(()=>({width:Ct.value,height:kt.value}));function Co(o){const l={},t={},a=new Set;return yt.value.forEach(([n,_,oe])=>{l[n]||(l[n]=[]),t[_]||(t[_]=[]),l[n].push(_),t[_].push(n)}),l[o]&&l[o].forEach(n=>a.add(n)),t[o]&&t[o].forEach(n=>a.add(n)),Array.from(a).concat(o)}const A=c(null),te=c(null),ie=c(null),Ae=c(!1),we=c(null);function wt(o,l){q.value=[],A.value=Co(o.name),te.value=o.name,we.value=o.id;const t=o.name,a=yt.value;let n=0,_=0,oe=[],ve=[];const de=new Set(a.map(([d])=>d)),Ee=new Set(a.map(([,d])=>d)),Ke=Array.from(de).filter(d=>!Ee.has(d)),le=a.filter(([d])=>Ke.includes(d)).reduce((d,[m,J,X])=>d+X,0),L={};S.value.nodes.forEach(d=>{L[d.name]=d.color}),a.forEach(([d,m,J])=>{m===t&&(n+=J,oe.push({source:d,value:J,color:L[d]})),d===t&&(_+=J,ve.push({target:m,value:J,color:L[m]}))});const Fe=Math.max(n,_),qe=le>0?Fe/le*100:0,D={name:t,inflow:n,outflow:_,from:oe,to:ve,percentOfTotal:qe,color:L[t]||"#000000"};e.value.events.datapointEnter&&e.value.events.datapointEnter({datapoint:D,seriesIndex:l}),ie.value={datapoint:D},Ie.value=!0;let z="";const he=e.value.style.chart.tooltip.customFormat;if(Ae.value=!1,Jo(he))try{const d=he({datapoint:D,series:S.value,config:e.value});typeof d=="string"&&(Ne.value=d,Ae.value=!0)}catch(d){console.warn("Custom format cannot be applied.")}if(!Ae.value){const d=e.value.style.chart.tooltip.showPercentage?"<div>".concat(ae({p:e.value.style.chart.tooltip.translations.percentOfTotal,v:D.percentOfTotal,s:"%",r:e.value.style.chart.tooltip.roundingPercentage}),"</div>"):"";z+='<div style="width:100%;text-align:center;border-bottom:1px solid '.concat(e.value.style.chart.tooltip.borderColor,';padding-bottom:6px;margin-bottom:3px;"><span style="margin-right:4px; color:').concat(D.color,'">⏹</span>').concat(D.name).concat(d,"</div>"),D.from.length&&(z+="<div>".concat(e.value.style.chart.tooltip.translations.from,"</div>"),D.from.forEach(m=>{z+='<div><span style="color:'.concat(m.color,'">⏹←</span> ').concat(m.source,": ").concat(Be(e.value.style.chart.nodes.labels.formatter,m.value,ae({p:e.value.style.chart.nodes.labels.prefix,v:m.value,s:e.value.style.chart.nodes.labels.suffix,r:e.value.style.chart.nodes.labels.rounding})),"</div>")})),D.to.length&&(z+='<div style="margin-top:6px;">'.concat(e.value.style.chart.tooltip.translations.to,"</div>"),D.to.forEach(m=>{z+='<div><span style="color:'.concat(m.color,'">⏹→</span> ').concat(m.target,": ").concat(Be(e.value.style.chart.nodes.labels.formatter,m.value,ae({p:e.value.style.chart.nodes.labels.prefix,v:m.value,s:e.value.style.chart.nodes.labels.suffix,r:e.value.style.chart.nodes.labels.rounding})),"</div>")})),Ne.value=z}}function $e(o){we.value=null;const l=ie.value;e.value.events.datapointLeave&&e.value.events.datapointLeave({datapoint:l,seriesIndex:o}),A.value=null,te.value=null,Ie.value=!1}function Ye(o){const l=ie.value;e.value.events.datapointClick&&e.value.events.datapointClick({datapoint:l,seriesIndex:o})}const $t=g(()=>S.value.links.map(({source:o,target:l,sourceColor:t,targetColor:a,value:n})=>({source:o,target:l,sourceColor:t,targetColor:a,value:n})));function Ge(o=null){Ut(()=>{const l=$t.value.map((n,_)=>[[n.source],[n.target],[n.value]]),t=[[e.value.style.chart.title.text],[e.value.style.chart.title.subtitle.text],[[e.value.table.columnNames.source],[e.value.table.columnNames.target],[e.value.table.columnNames.value]]].concat(l),a=Ko(t);o?o(a):qo({csvContent:a,title:e.value.style.chart.title.text||"vue-ui-flow"})})}const xe=g(()=>{const o=[e.value.table.columnNames.source,e.value.table.columnNames.target,e.value.table.columnNames.value],l=$t.value.map((a,n)=>[{color:a.sourceColor,name:a.source,shape:"square"},{color:a.targetColor,name:a.target,shape:"square"},ae({p:e.value.style.chart.nodes.labels.prefix,v:a.value,s:e.value.style.chart.nodes.labels.suffix,r:e.value.style.chart.nodes.labels.rounding})]),t={th:{backgroundColor:e.value.table.th.backgroundColor,color:e.value.table.th.color,outline:e.value.table.th.outline},td:{backgroundColor:e.value.table.td.backgroundColor,color:e.value.table.td.color,outline:e.value.table.td.outline},breakpoint:e.value.table.responsiveBreakpoint};return{colNames:[e.value.table.columnNames.source,e.value.table.columnNames.target,e.value.table.columnNames.value],head:o,body:l,config:t}});function ko(){return S.value}function xt(){O.value.showTable=!O.value.showTable}const _e=c(!1);function He(){_e.value=!_e.value}function _t(){O.value.showTooltip=!O.value.showTooltip}const Et=g(()=>{const o=new Set(S.value.nodes.map(l=>e.value.nodeCategories[l.name]||"__uncategorized__"));return Array.from(o).map(l=>({name:l,color:e.value.nodeCategoryColors[l]||V[0],shape:"square",count:S.value.nodes.filter(t=>(e.value.nodeCategories[t.name]||"__uncategorized__")===l).length})).map((l,t)=>({...l,segregate:()=>Ue({legend:l,i:t}),opacity:q.value.length?q.value.includes(t)?1:.5:1,display:"".concat(l.name," (").concat(l.count,")")}))}),We=g(()=>Et.value.filter(o=>o.name!=="__uncategorized__")),q=c([]);function Ue({legend:o,i:l}){var a;const t=o.name;if((a=A.value)!=null&&a.every(n=>e.value.nodeCategories[n]===t)){A.value=null,te.value=null,q.value=[];return}q.value=[l],A.value=S.value.nodes.filter(n=>e.value.nodeCategories[n.name]===t).map(n=>n.name),te.value=null}const Ao=g(()=>({cy:"flow-legend",backgroundColor:e.value.style.chart.legend.backgroundColor,color:e.value.style.chart.legend.color,fontSize:e.value.style.chart.legend.fontSize,paddingBottom:e.value.style.chart.legend.paddingBottom,fontWeight:e.value.style.chart.legend.bold?"bold":"normal"}));async function wo({scale:o=2}={}){if(!N.value)return;const{width:l,height:t}=N.value.getBoundingClientRect(),a=l/t,{imageUri:n,base64:_}=await il({domElement:N.value,base64:!0,img:!0,scale:o});return{imageUri:n,base64:_,title:e.value.style.chart.title.text,width:l,height:t,aspectRatio:a}}const ce=g(()=>{const o=e.value.table.useDialog&&!e.value.table.show,l=O.value.showTable;return{component:o?ho:so,title:"".concat(e.value.style.chart.title.text).concat(e.value.style.chart.title.subtitle.text?": ".concat(e.value.style.chart.title.subtitle.text):""),props:o?{backgroundColor:e.value.table.th.backgroundColor,color:e.value.table.th.color,headerColor:e.value.table.th.color,headerBg:e.value.table.th.backgroundColor,isFullscreen:K.value,fullscreenParent:N.value,forcedWidth:Math.min(800,window.innerWidth*.8)}:{hideDetails:!0,config:{open:l,maxHeight:1e4,body:{backgroundColor:e.value.style.chart.backgroundColor,color:e.value.style.chart.color},head:{backgroundColor:e.value.style.chart.backgroundColor,color:e.value.style.chart.color}}}}});Oe(()=>O.value.showTable,o=>{e.value.table.show||(o&&e.value.table.useDialog&&ne.value?ne.value.open():"close"in ne.value&&ne.value.close())});function Ft(){O.value.showTable=!1,Pe.value&&Pe.value.setTableIconState(!1)}const $o=g(()=>We.value.map(o=>({...o,name:o.display}))),xo=g(()=>e.value.style.chart.backgroundColor),_o=g(()=>e.value.style.chart.legend),Eo=g(()=>e.value.style.chart.title),{exportSvg:Fo,getSvg:To}=ll({svg:Ve,title:Eo,legend:_o,legendItems:$o,backgroundColor:xo});async function Tt({isCb:o}){if(o){const{blob:l,url:t,text:a,dataUrl:n}=await To();e.value.userOptions.callbacks.svg({blob:l,url:t,text:a,dataUrl:n})}else Fo()}async function Oo(o,l){if(wt(o,l),O.value.showTooltip&&(await Ut(),N.value&&Me.value)){const{left:t,top:a}=N.value.getBoundingClientRect();Me.value.placeTooltip({x:(t!=null?t:0)+12,y:(a!=null?a:0)+12})}}return ao({getData:ko,getImage:wo,generateCsv:Ge,generateImage:mt,generateSvg:Tt,generatePdf:bt,toggleTable:xt,toggleAnnotator:He,toggleTooltip:_t,drillCategory:Ue,unselectNode:$e,toggleFullscreen:it}),(o,l)=>(v(),b("div",{ref_key:"flowChart",ref:N,class:Ht("vue-data-ui-component vue-ui-flow ".concat(K.value?"vue-data-ui-wrapper-fullscreen":"")),style:H("font-family:".concat(e.value.style.fontFamily,";width:100%; text-align:center;background:").concat(e.value.style.chart.backgroundColor)),id:"flow_".concat(U.value),onMouseenter:l[2]||(l[2]=()=>s(vt)(!0)),onMouseleave:l[3]||(l[3]=()=>s(vt)(!1))},[e.value.userOptions.buttons.annotator?(v(),ee(s(io),{key:0,svgRef:s(Ve),backgroundColor:e.value.style.chart.backgroundColor,color:e.value.style.chart.color,active:_e.value,onClose:He},{"annotator-action-close":h(()=>[p(o.$slots,"annotator-action-close",{},void 0,!0)]),"annotator-action-color":h(({color:t})=>[p(o.$slots,"annotator-action-color",P(M({color:t})),void 0,!0)]),"annotator-action-draw":h(({mode:t})=>[p(o.$slots,"annotator-action-draw",P(M({mode:t})),void 0,!0)]),"annotator-action-undo":h(({disabled:t})=>[p(o.$slots,"annotator-action-undo",P(M({disabled:t})),void 0,!0)]),"annotator-action-redo":h(({disabled:t})=>[p(o.$slots,"annotator-action-redo",P(M({disabled:t})),void 0,!0)]),"annotator-action-delete":h(({disabled:t})=>[p(o.$slots,"annotator-action-delete",P(M({disabled:t})),void 0,!0)]),_:3},8,["svgRef","backgroundColor","color","active"])):x("",!0),mo.value?(v(),b("div",vl,null,512)):x("",!0),e.value.style.chart.title.text?(v(),b("div",{key:2,ref_key:"chartTitle",ref:rt,style:"width:100%;background:transparent;padding-bottom:24px"},[(v(),ee(ul,{key:"title_".concat(lt.value),config:{title:{cy:"flow-title",...e.value.style.chart.title},subtitle:{cy:"flow-subtitle",...e.value.style.chart.title.subtitle}}},null,8,["config"]))],512)):x("",!0),G("div",{id:"legend-top-".concat(U.value)},null,8,dl),e.value.userOptions.show&&ut.value&&(s(dt)||s(Re))?(v(),ee(s(co),{ref_key:"userOptionsRef",ref:Pe,key:"user_option_".concat(ot.value),backgroundColor:e.value.style.chart.backgroundColor,color:e.value.style.chart.color,isPrinting:s(pt),isImaging:s(ft),uid:U.value,hasPdf:e.value.userOptions.buttons.pdf,hasXls:e.value.userOptions.buttons.csv,hasImg:e.value.userOptions.buttons.img,hasSvg:e.value.userOptions.buttons.svg,hasTable:e.value.userOptions.buttons.table,callbacks:e.value.userOptions.callbacks,hasFullscreen:e.value.userOptions.buttons.fullscreen,isFullscreen:K.value,titles:{...e.value.userOptions.buttonTitles},chartElement:N.value,position:e.value.userOptions.position,hasAnnotator:e.value.userOptions.buttons.annotator,printScale:e.value.userOptions.print.scale,isAnnotation:_e.value,hasTooltip:e.value.style.chart.tooltip.show&&e.value.userOptions.buttons.tooltip,isTooltip:O.value.showTooltip,tableDialog:e.value.table.useDialog,onToggleTooltip:_t,onToggleFullscreen:it,onGeneratePdf:s(bt),onGenerateCsv:Ge,onGenerateImage:s(mt),onGenerateSvg:Tt,onToggleTable:xt,onToggleAnnotator:He,style:H({visibility:s(dt)?s(Re)?"visible":"hidden":"visible"})},Gt({_:2},[o.$slots.menuIcon?{name:"menuIcon",fn:h(({isOpen:t,color:a})=>[p(o.$slots,"menuIcon",P(M({isOpen:t,color:a})),void 0,!0)]),key:"0"}:void 0,o.$slots.optionTooltip?{name:"optionTooltip",fn:h(()=>[p(o.$slots,"optionTooltip",{},void 0,!0)]),key:"1"}:void 0,o.$slots.optionPdf?{name:"optionPdf",fn:h(()=>[p(o.$slots,"optionPdf",{},void 0,!0)]),key:"2"}:void 0,o.$slots.optionCsv?{name:"optionCsv",fn:h(()=>[p(o.$slots,"optionCsv",{},void 0,!0)]),key:"3"}:void 0,o.$slots.optionImg?{name:"optionImg",fn:h(()=>[p(o.$slots,"optionImg",{},void 0,!0)]),key:"4"}:void 0,o.$slots.optionSvg?{name:"optionSvg",fn:h(()=>[p(o.$slots,"optionSvg",{},void 0,!0)]),key:"5"}:void 0,o.$slots.optionTable?{name:"optionTable",fn:h(()=>[p(o.$slots,"optionTable",{},void 0,!0)]),key:"6"}:void 0,o.$slots.optionFullscreen?{name:"optionFullscreen",fn:h(({toggleFullscreen:t,isFullscreen:a})=>[p(o.$slots,"optionFullscreen",P(M({toggleFullscreen:t,isFullscreen:a})),void 0,!0)]),key:"7"}:void 0,o.$slots.optionAnnotator?{name:"optionAnnotator",fn:h(({toggleAnnotator:t,isAnnotator:a})=>[p(o.$slots,"optionAnnotator",P(M({toggleAnnotator:t,isAnnotator:a})),void 0,!0)]),key:"8"}:void 0]),1032,["backgroundColor","color","isPrinting","isImaging","uid","hasPdf","hasXls","hasImg","hasSvg","hasTable","callbacks","hasFullscreen","isFullscreen","titles","chartElement","position","hasAnnotator","printScale","isAnnotation","hasTooltip","isTooltip","tableDialog","onGeneratePdf","onGenerateImage","style"])):x("",!0),(v(),b("svg",{ref_key:"svgRef",ref:Ve,xmlns:s(Wo),viewBox:"0 0 ".concat(ue.value.width," ").concat(ue.value.height),class:Ht({"vue-data-ui-fullscreen--on":K.value,"vue-data-ui-fulscreen--off":!K.value}),style:H({maxWidth:"100%",overflow:"visible",background:"transparent",color:e.value.style.chart.color})},[Se(s(vo)),o.$slots["chart-background"]?(v(),b("foreignObject",{key:0,x:0,y:0,width:ue.value.width,height:ue.value.height,style:{pointerEvents:"none"}},[p(o.$slots,"chart-background",{},void 0,!0)],8,gl)):x("",!0),G("defs",null,[(v(!0),b(pe,null,fe(S.value.links,(t,a)=>(v(),b("linearGradient",{id:t.id,x1:"0%",y1:"0%",x2:"100%",y2:"0%"},[G("stop",{offset:"0%","stop-color":t.sourceColor},null,8,fl),G("stop",{offset:"100%","stop-color":t.targetColor},null,8,bl)],8,pl))),256))]),(v(!0),b(pe,null,fe(S.value.links,t=>(v(),b("path",{class:"vue-ui-flow-link",d:t.path,"stroke-linejoin":"round","stroke-miterlimit":"1",fill:"url(#".concat(t.id,")"),stroke:e.value.style.chart.links.stroke,"stroke-width":e.value.style.chart.links.strokeWidth,style:H("\n                    opacity:".concat(A.value?A.value.includes(t.source)&&A.value.includes(t.target)?1:.3:te.value?[t.target,t.source].includes(te.value)?1:.3:e.value.style.chart.links.opacity,"\n                "))},null,12,ml))),256)),(v(!0),b(pe,null,fe(S.value.nodes,(t,a)=>(v(),b("rect",{class:"vue-ui-flow-node",x:t.x,y:s(F)(t.absoluteY)+e.value.style.chart.padding.top,height:s(F)(t.height),width:ke.value,fill:t.color,stroke:e.value.style.chart.nodes.stroke,"stroke-width":e.value.style.chart.nodes.strokeWidth,rx:e.value.style.chart.nodes.borderRadius,style:H({opacity:A.value?A.value.includes(t.name)?1:.3:1,outline:we.value!==null&&we.value===t.id?"2px solid currentColor":void 0}),role:"button",tabindex:"0","aria-label":"".concat(t.name,": ").concat(s(Be)(e.value.style.chart.nodes.labels.formatter,t.value,s(ae)({p:e.value.style.chart.nodes.labels.prefix,v:t.value,s:e.value.style.chart.nodes.labels.suffix,r:e.value.style.chart.nodes.labels.rounding}))),onMouseenter:n=>wt(t,a),onMouseleave:n=>$e(a),onClick:n=>Ye(a),onKeydown:[Qe(et(n=>Ye(a),["prevent"]),["enter"]),Qe(et(n=>Ye(a),["prevent"]),["space"]),Qe(et(n=>$e(a),["prevent"]),["esc"])],onFocus:n=>Oo(t,a),onBlur:n=>$e(a)},null,44,yl))),256)),e.value.style.chart.nodes.labels.show?(v(),b("g",Cl,[(v(!0),b(pe,null,fe(S.value.nodes,(t,a)=>(v(),b("text",{x:t.x+ke.value/2,y:(e.value.style.chart.nodes.labels.showValue?s(F)(t.absoluteY+t.height/2-e.value.style.chart.nodes.labels.fontSize/4):t.absoluteY+t.height/2+e.value.style.chart.nodes.labels.fontSize/3)+e.value.style.chart.padding.top,"font-size":e.value.style.chart.nodes.labels.fontSize,fill:s(qt)(t.color),"text-anchor":"middle",style:H("pointer-events: none; opacity:".concat(A.value?A.value.includes(t.name)?1:0:1))},be(e.value.style.chart.nodes.labels.abbreviation.use?s(Uo)({source:t.name,length:e.value.style.chart.nodes.labels.abbreviation.length}):t.name),13,kl))),256)),e.value.style.chart.nodes.labels.showValue?(v(!0),b(pe,{key:0},fe(S.value.nodes,(t,a)=>(v(),b("text",{x:t.x+ke.value/2,y:s(F)(t.absoluteY+t.height/2+e.value.style.chart.nodes.labels.fontSize/1.3)+e.value.style.chart.padding.top,"font-size":e.value.style.chart.nodes.labels.fontSize,fill:s(qt)(t.color),"text-anchor":"middle",style:H("pointer-events: none; opacity:".concat(A.value?A.value.includes(t.name)?1:0:1))},be(s(Be)(e.value.style.chart.nodes.labels.formatter,t.value,s(ae)({p:e.value.style.chart.nodes.labels.prefix,v:t.value,s:e.value.style.chart.nodes.labels.suffix,r:e.value.style.chart.nodes.labels.rounding}),{datapoint:t,seriesIndex:a})),13,Al))),256)):x("",!0)])):x("",!0),p(o.$slots,"svg",{svg:ue.value},void 0,!0)],14,hl)),o.$slots.watermark?(v(),b("div",wl,[p(o.$slots,"watermark",P(M({isPrinting:s(pt)||s(ft)})),void 0,!0)])):x("",!0),G("div",{id:"legend-bottom-".concat(U.value)},null,8,$l),st.value?(v(),ee(Mo,{key:5,to:e.value.style.chart.legend.position==="top"?"#legend-top-".concat(U.value):"#legend-bottom-".concat(U.value)},[G("div",{ref_key:"chartLegend",ref:at},[e.value.style.chart.legend.show&&We.value.length?(v(),ee(sl,{key:0,legendSet:We.value,config:Ao.value,onClickMarker:l[0]||(l[0]=t=>Ue(t))},{item:h(({legend:t,index:a})=>[s(ze)?x("",!0):(v(),b("div",{key:0,onClick:n=>t.segregate(),style:H("opacity:".concat(q.value.length?q.value.includes(a)?1:.5:1))},be(t.display),13,xl))]),_:1},8,["legendSet","config"])):x("",!0),p(o.$slots,"legend",{legend:Et.value},void 0,!0)],512)],8,["to"])):x("",!0),o.$slots.source?(v(),b("div",{key:6,ref_key:"source",ref:nt,dir:"auto"},[p(o.$slots,"source",{},void 0,!0)],512)):x("",!0),Se(s(ro),{ref_key:"tooltip",ref:Me,show:O.value.showTooltip&&Ie.value,backgroundColor:e.value.style.chart.tooltip.backgroundColor,color:e.value.style.chart.tooltip.color,fontSize:e.value.style.chart.tooltip.fontSize,borderRadius:e.value.style.chart.tooltip.borderRadius,borderColor:e.value.style.chart.tooltip.borderColor,borderWidth:e.value.style.chart.tooltip.borderWidth,backgroundOpacity:e.value.style.chart.tooltip.backgroundOpacity,position:e.value.style.chart.tooltip.position,offsetY:e.value.style.chart.tooltip.offsetY,parent:N.value,content:Ne.value,isCustom:Ae.value,isFullscreen:K.value,smooth:e.value.style.chart.tooltip.smooth,backdropFilter:e.value.style.chart.tooltip.backdropFilter,smoothForce:e.value.style.chart.tooltip.smoothForce,smoothSnapThreshold:e.value.style.chart.tooltip.smoothSnapThreshold},{"tooltip-before":h(()=>[p(o.$slots,"tooltip-before",P(M({...ie.value})),void 0,!0)]),"tooltip-after":h(()=>[p(o.$slots,"tooltip-after",P(M({...ie.value})),void 0,!0)]),_:3},8,["show","backgroundColor","color","fontSize","borderRadius","borderColor","borderWidth","backgroundOpacity","position","offsetY","parent","content","isCustom","isFullscreen","smooth","backdropFilter","smoothForce","smoothSnapThreshold"]),ut.value&&e.value.userOptions.buttons.table?(v(),ee(Lo(ce.value.component),zo({key:7},ce.value.props,{ref_key:"tableUnit",ref:ne,onClose:Ft}),Gt({content:h(()=>[Se(s(uo),{colNames:xe.value.colNames,head:xe.value.head,body:xe.value.body,config:xe.value.config,title:e.value.table.useDialog?"":ce.value.title,withCloseButton:!e.value.table.useDialog,onClose:Ft},{th:h(({th:t})=>[G("div",{innerHTML:t,style:{display:"flex","align-items":"center"}},null,8,_l)]),td:h(({td:t})=>[Wt(be(t.name||t),1)]),_:1},8,["colNames","head","body","config","title","withCloseButton"])]),_:2},[e.value.table.useDialog?{name:"title",fn:h(()=>[Wt(be(ce.value.title),1)]),key:"0"}:void 0,e.value.table.useDialog?{name:"actions",fn:h(()=>[G("button",{tabindex:"0",class:"vue-ui-user-options-button",onClick:l[1]||(l[1]=t=>Ge(e.value.userOptions.callbacks.csv))},[Se(s(no),{name:"excel",stroke:ce.value.props.color},null,8,["stroke"])])]),key:"1"}:void 0]),1040)):x("",!0),s(ze)?(v(),ee(ol,{key:8})):x("",!0)],46,cl))}},Fl=Ro(El,[["__scopeId","data-v-b23619de"]]),Wl=Object.freeze(Object.defineProperty({__proto__:null,default:Fl},Symbol.toStringTag,{value:"Module"}));export{Hl as a,Wl as b,Fl as v};
