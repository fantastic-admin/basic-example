
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * https://fantastic-admin.hurui.me
 */
    
const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./PackageVersion-TgflyMpU-q2MkeeNq.js","./index-DXZKKOp8.js","./index-B7kifsnL.css"])))=>i.map(i=>d[i]);
import{e as y,a7 as ye,J as o,K as D,a9 as H,E as fe,c as r,o as s,A as h,z as he,u as i,g as pe,f as z,b_ as ce,r as Q,t as X,O as ge,c1 as me}from"./index-DXZKKOp8.js";import{s as ke,Q as be,A as $e,af as K,g as R,p as we,c as x,ap as xe,y as Le,O as q,z as Y,f as ee,I as Ae}from"./vue-data-ui-BN9YfUec.js";import{E as _e,M as Ce}from"./useResponsive-DfdjqQps-DzVAt69W.js";import{t as Ne,o as le}from"./useNestedProp-dJX_8vvZ-BzBW50KN.js";import{S as Se,T as Te}from"./BaseScanner-BgWxam9d-B19ueoDW.js";import{k as ze}from"./useFitSvgText-2crs6Fv5-CJteLozF.js";import{J as Fe}from"./themes-AUNCOb2G-RAhReTPj.js";import"./alert-l5XlVwCh.js";const Me=["id"],je=["xmlns","viewBox"],Ee=["width","height"],Oe=["id"],Ie=["stop-color"],Ve=["stop-color"],Be={key:1},Ze=["d","fill"],De=["d","fill"],Re=["d","stroke","stroke-width","stroke-linecap","stroke-linejoin"],qe=["d","stroke","stroke-width","stroke-linecap","stroke-linejoin"],Ge=["d"],Pe=["fill","d"],We=["x","y","width","height"],Je=["x","y","fill","font-size","font-weight"],Ue=["stroke","cx","cy","fill"],He=["x","y","font-size","fill","font-weight"],Qe={__name:"vue-ui-spark-trend",props:{config:{type:Object,default(){return{}}},dataset:{type:Array,default(){return[]}}},setup(ae){const te=ce(()=>me(()=>import("./PackageVersion-TgflyMpU-q2MkeeNq.js"),__vite__mapDeps([0,1,2]),import.meta.url)),{vue_ui_spark_trend:ue}=Ne(),m=ae,F=y(null),G=y(null),P=y(null),L=y(null),_=y(null),C=y(!1),p=y(null),A=y(be()),e=y(E()),{loading:$,FINAL_DATASET:M,manualLoading:j}=Se({...ye(m),FINAL_CONFIG:e,prepareConfig:E,skeletonDataset:[1,2,3,5,8,13,21,34,55,89,144,233],skeletonConfig:$e({defaultConfig:e.value,userConfig:{style:{animation:{show:!1},backgroundColor:"#99999930",line:{stroke:"#6A6A6A",useColorTrend:!1},dataLabel:{show:!1,useColorTrend:!1,color:"#6A6A6A"}}}})});function E(){const l=le({userConfig:m.config,defaultConfig:ue});return l.theme?{...le({userConfig:Fe.vue_ui_spark_trend[l.theme]||m.config,defaultConfig:l})}:l}const c=o(()=>K({data:M.value,threshold:e.value.downsample.threshold}));D(()=>m.config,l=>{e.value=E(),V.value=e.value.style.width,w.value=e.value.style.height,W()},{deep:!0});function O(l){return l.map(a=>x(a))}const k=y(K({data:M.value,threshold:e.value.downsample.threshold}).map(l=>e.value.style.animation.show||[void 0,1/0,-1/0,null,NaN].includes(l)?null:l));D(c,l=>{p.value&&(cancelAnimationFrame(p.value),p.value=null),e.value.style.animation.show?k.value=Array(l.length).fill(null):k.value=l.map(a=>![void 0,1/0,-1/0,null].includes(a)&&!Number.isNaN(a)?a:null),I(),H(()=>T(".vue-ui-sparktrend-progress-label",6))},{deep:!0,immediate:!0}),D(()=>JSON.stringify(m.dataset),()=>{p.value&&(cancelAnimationFrame(p.value),p.value=null),j.value=R(m.dataset);const l=c.value;k.value=e.value.style.animation.show?Array(l.length).fill(null):l.map(a=>Number.isFinite(a)?a:null),I(),H(()=>T(".vue-ui-sparktrend-progress-label",6))},{deep:!1,immediate:!0});function I(){let l=1e3/e.value.style.animation.animationFrames,a=performance.now();if(!$.value&&e.value.style.animation.show&&e.value.style.animation.animationFrames&&M.value.length>1){let n=function(){C.value=!0;let b=performance.now(),U=b-a;U>l?(a=b-U%l,f<c.value.length?(k.value.push(c.value[f]),f+=1,p.value=requestAnimationFrame(n)):(cancelAnimationFrame(p.value),k.value=O(c.value),C.value=!1,T(".vue-ui-sparktrend-progress-label",6))):p.value=requestAnimationFrame(n)};k.value=[];let f=0;n()}}fe(()=>{W()});const ne=o(()=>e.value.debug);function W(){if(R(m.dataset)&&(we({componentName:"VueUiSparkTrend",type:"dataset",debug:ne.value}),j.value=!0),R(m.dataset)||(j.value=!1),e.value.responsive){const l=_e(()=>{const{width:a,height:n}=Ce({chart:F.value,source:P.value});requestAnimationFrame(()=>{V.value=a,w.value=n})});L.value&&(_.value&&L.value.unobserve(_.value),L.value.disconnect()),L.value=new ResizeObserver(l),_.value=F.value.parentNode,L.value.observe(_.value)}I(),T(".vue-ui-sparktrend-progress-label",6)}const V=y(e.value.style.width),w=y(e.value.style.height),v=o(()=>({height:w.value,width:V.value})),u=o(()=>({top:e.value.style.padding.top,left:e.value.style.padding.left,right:v.value.width-e.value.style.padding.right,bottom:v.value.height-e.value.style.padding.bottom,height:v.value.height-(e.value.style.padding.top+e.value.style.padding.bottom)-(e.value.style.dataLabel.show?e.value.style.dataLabel.fontSize:0),width:v.value.width-(e.value.style.padding.left+e.value.style.padding.right)})),B=o(()=>{const l=O(c.value).filter(Number.isFinite);if(!l.length)return{max:0,min:0};let a=l[0],n=l[0];for(let f=1;f<l.length;f++){const b=l[f];b>a&&(a=b),b<n&&(n=b)}return{max:a,min:n}}),oe=o(()=>{const l=c.value,a=l.length?l[l.length-1]:"x";return[A.value,l.length,Number.isFinite(a)?a:"x",e.value.downsample.threshold,e.value.style.line.smooth?"s":"l"].join("-")}),N=o(()=>{const l=B.value.min>=0?0:B.value.min;return Math.abs(l)}),se=o(()=>B.value.max+N.value);function J(l){return l/se.value}const re=o(()=>c.value.length),t=o(()=>k.value.map((l,a)=>{const n=isNaN(l)||[void 0,null,"NaN",NaN,1/0,-1/0].includes(l)?0:l||0;return{value:x(l),absoluteValue:x(n),plotValue:x(n+N.value),toMax:J(n+N.value),x:u.value.left+x(a*(u.value.width/(re.value-1)))-e.value.style.padding.right,y:u.value.bottom-x(u.value.height*J(n+N.value))}})),S=o(()=>{const l=O(c.value);return e.value.style.trendLabel.trendType==="global"?xe(l):e.value.style.trendLabel.trendType==="n-1"&&l.length>1?(l.at(-1)/l.at(-2)-1)*100:e.value.style.trendLabel.trendType==="lastToFirst"?(l.at(-1)/l[0]-1)*100:0}),Z=o(()=>C.value||S.value===0?"neutral":S.value>0?"positive":"negative"),g=o(()=>e.value.style.arrow.colors[Z.value]),ie=o(()=>{const l={x:t.value[0].x,y:v.value.height-6},a={x:t.value[t.value.length-1].x,y:v.value.height-6},n=[];return t.value.forEach(f=>{n.push("".concat(f.x,",").concat(f.y," "))}),[l.x,l.y,...n,a.x,a.y].toString()}),ve=o(()=>{let l=[];return t.value.forEach(a=>{l.push("".concat(a.x,",").concat(a.y," "))}),"M ".concat(l.toString())}),d=o(()=>w.value/2-e.value.style.trendLabel.fontSize),de=o(()=>u.value.left*.8),{fitText:T}=ze({svgRef:G,unitWidth:de,fontSize:e.value.style.trendLabel.fontSize});return(l,a)=>(s(),r("div",{ref_key:"sparkTrendChart",ref:F,class:"vue-data-ui-component vue-ui-spark-trend",id:A.value,style:ge("width:100%;font-family:".concat(e.value.style.fontFamily,";background:").concat(e.value.style.backgroundColor))},[(s(),r("svg",{key:oe.value,ref_key:"svgRef",ref:G,xmlns:i(Le),viewBox:"0 0 ".concat(v.value.width," ").concat(v.value.height),style:"width:100%;background:transparent;overflow:visible"},[pe(i(te)),l.$slots["chart-background"]?(s(),r("foreignObject",{key:0,x:0,y:0,width:v.value.width<=0?10:v.value.width,height:v.value.height<=0?10:v.value.height,style:{pointerEvents:"none"}},[Q(l.$slots,"chart-background",{},void 0,!0)],8,Ee)):h("",!0),z("defs",null,[z("linearGradient",{x1:"0%",y1:"0%",x2:"0%",y2:"100%",id:"pill_gradient_".concat(A.value)},[z("stop",{offset:"0%","stop-color":i(q)(e.value.style.line.useColorTrend?g.value:e.value.style.line.stroke,e.value.style.area.opacity)},null,8,Ie),z("stop",{offset:"100%","stop-color":e.value.style.backgroundColor},null,8,Ve)],8,Oe)]),e.value.style.area.show&&t.value[0]?(s(),r("g",Be,[e.value.style.line.smooth?(s(),r("path",{key:0,d:"M ".concat(t.value[0].x,",").concat(u.value.bottom," ").concat(i(Y)(t.value)," L ").concat(t.value.at(-1).x,",").concat(u.value.bottom," Z"),fill:e.value.style.area.useGradient?"url(#pill_gradient_".concat(A.value,")"):i(q)(e.value.style.line.useColorTrend?g.value:e.value.style.line.stroke,e.value.style.area.opacity),stroke:"none"},null,8,Ze)):(s(),r("path",{key:1,d:"M".concat(ie.value,"Z"),fill:e.value.style.area.useGradient?"url(#pill_gradient_".concat(A.value,")"):i(q)(e.value.style.line.useColorTrend?g.value:e.value.style.line.stroke,e.value.style.area.opacity),stroke:"none"},null,8,De))])):h("",!0),e.value.style.line.smooth&&t.value.length?(s(),r("path",{key:2,d:"M ".concat(i(Y)(t.value)),stroke:e.value.style.line.useColorTrend?g.value:e.value.style.line.stroke,fill:"none","stroke-width":e.value.style.line.strokeWidth,"stroke-linecap":e.value.style.line.strokeLinecap,"stroke-linejoin":e.value.style.line.strokeLinejoin},null,8,Re)):h("",!0),!e.value.style.line.smooth&&t.value.length?(s(),r("path",{key:3,d:ve.value,stroke:e.value.style.line.useColorTrend?g.value:e.value.style.line.stroke,fill:"none","stroke-width":e.value.style.line.strokeWidth,"stroke-linecap":e.value.style.line.strokeLinecap,"stroke-linejoin":e.value.style.line.strokeLinejoin},null,8,qe)):h("",!0),i($)?(s(),r("path",{key:4,fill:"#6A6A6A",d:"M ".concat(u.value.left/2+6,", ").concat(d.value+7," ").concat(u.value.left/2-7,", ").concat(d.value," ").concat(u.value.left/2-7,", ").concat(d.value+14," Z")},null,8,Ge)):(s(),r("path",{key:5,fill:g.value,d:Z.value==="positive"?"M ".concat(u.value.left/2,", ").concat(d.value," ").concat(u.value.left/2-7,", ").concat(d.value+12," ").concat(u.value.left/2+7,", ").concat(d.value+12," Z"):Z.value==="negative"?"M ".concat(u.value.left/2,", ").concat(d.value+12," ").concat(u.value.left/2-7,", ").concat(d.value," ").concat(u.value.left/2+7,", ").concat(d.value," Z"):"M ".concat(u.value.left/2+6,", ").concat(d.value+7," ").concat(u.value.left/2-7,", ").concat(d.value," ").concat(u.value.left/2-7,", ").concat(d.value+14," Z")},null,8,Pe)),i($)?(s(),r("rect",{key:6,x:u.value.left/2-e.value.style.trendLabel.fontSize-2,y:w.value/2+e.value.style.trendLabel.fontSize-2,width:e.value.style.trendLabel.fontSize*2,height:e.value.style.trendLabel.fontSize,fill:"#6A6A6A80",rx:"3"},null,8,We)):h("",!0),!C.value&&!i($)?(s(),r("text",{key:7,class:"vue-ui-sparktrend-progress-label",x:u.value.left/2,y:w.value/2+e.value.style.trendLabel.fontSize*2,"text-anchor":"middle",fill:e.value.style.trendLabel.useColorTrend?g.value:e.value.style.trendLabel.color,"font-size":e.value.style.trendLabel.fontSize,"font-weight":e.value.style.trendLabel.bold?"bold":"normal"},X(i(ee)({p:S.value>0?"+":"",v:S.value,s:"%",r:e.value.style.trendLabel.rounding})),9,Je)):h("",!0),t.value.length&&t.value.at(-1).x!==void 0?(s(),r("circle",{key:8,stroke:e.value.style.backgroundColor,"stroke-width":2,cx:t.value.at(-1).x,cy:t.value.at(-1).y,r:4,fill:i($)?"#6A6A6A":g.value},null,8,Ue)):h("",!0),t.value.length&&t.value.at(-1).x!==void 0&&e.value.style.dataLabel.show?(s(),r("text",{key:9,"text-anchor":"middle",x:t.value.at(-1).x,y:t.value.at(-1).y-e.value.style.dataLabel.fontSize/1.5,"font-size":e.value.style.dataLabel.fontSize,fill:e.value.style.dataLabel.useColorTrend?g.value:e.value.style.dataLabel.color,"font-weight":e.value.style.dataLabel.bold?"bold":"normal"},X(i(Ae)(e.value.style.dataLabel.formatter,t.value.at(-1).value,i(ee)({p:e.value.style.dataLabel.prefix,v:t.value.at(-1).value,s:e.value.style.dataLabel.suffix,r:e.value.style.dataLabel.rounding}),{datapoint:t.value.at(-1)})),9,He)):h("",!0)],8,je)),l.$slots.source?(s(),r("div",{key:0,ref_key:"source",ref:P,dir:"auto"},[Q(l.$slots,"source",{},void 0,!0)],512)):h("",!0),i($)?(s(),he(Te,{key:1})):h("",!0)],12,Me))}},nl=ke(Qe,[["__scopeId","data-v-b0090f77"]]);export{nl as default};
