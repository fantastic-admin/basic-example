
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * https://fantastic-admin.hurui.me
 */
    
const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./PackageVersion-TgflyMpU-q2MkeeNq.js","./index-DXZKKOp8.js","./index-B7kifsnL.css","./Tooltip-68Yi_FFl-CRPaJsgv.js","./vue-data-ui-BN9YfUec.js","./alert-l5XlVwCh.js","./vue-data-ui-D1HaM8UR.css"])))=>i.map(i=>d[i]);
import{ab as ke,E as Q,e as c,a7 as xe,K as H,J as C,c as r,o as s,A as f,g as K,z as we,O as p,f as v,t as I,u as d,b_ as X,F as k,R as A,n as L,h as Z,r as j,j as ee,k as te,c1 as le}from"./index-DXZKKOp8.js";import{s as _e,Q as ae,A as $e,v as Ce,m as u,a as F,C as Se,g as Ie,p as oe,b as Ae,f as M,y as Fe,O as se,G as re,I as ie,F as ze}from"./vue-data-ui-BN9YfUec.js";import{t as Be,o as ne}from"./useNestedProp-dJX_8vvZ-BzBW50KN.js";import{o as De}from"./useChartAccessibility-9icAAmYg-BcUQIUvr.js";import{J as Ee}from"./themes-AUNCOb2G-RAhReTPj.js";import{S as Oe,T as Le}from"./BaseScanner-BgWxam9d-B19ueoDW.js";import"./alert-l5XlVwCh.js";const Pe=["xmlns","viewBox"],Ne=["id"],Re=["stop-color"],Te=["stop-color"],Ve=["stop-color"],je={id:"stackPill",clipPathUnits:"objectBoundingBox"},Me=["fill"],Ge={key:0,"clip-path":"url(#stackPill)"},Ye=["x","width","height","fill"],Ue=["x","width","height","fill","stroke"],We=["x","width","height","onClick","onMouseenter","onMouseleave"],qe=["width","height","rx"],Je=["onClick"],Qe={style:{display:"flex","flex-direction":"row","align-items":"center",gap:"4px","justify-content":"center"}},He=["height","width"],Ke=["id"],Xe=["stop-color"],Ze=["stop-color"],et=["fill"],tt={key:2,ref:"source",dir:"auto"},lt={__name:"vue-ui-sparkstackbar",props:{config:{type:Object,default(){return{}}},dataset:{type:Array,default(){return[]}}},emits:["selectDatapoint"],setup(ue,{emit:de}){const ve=X(()=>le(()=>import("./PackageVersion-TgflyMpU-q2MkeeNq.js"),__vite__mapDeps([0,1,2]),import.meta.url)),ce=X(()=>le(()=>import("./Tooltip-68Yi_FFl-CRPaJsgv.js"),__vite__mapDeps([3,4,1,2,5,6]),import.meta.url)),{vue_ui_sparkstackbar:pe}=Be(),x=ue,ge=ke();Q(()=>{ge["chart-background"]&&console.warn("VueUiSparkStackbar does not support the #chart-background slot.")});const G=c(null),z=c(ae()),P=c(!1),N=c(""),e=c(R()),{loading:w,FINAL_DATASET:m}=Oe({...xe(x),FINAL_CONFIG:e,prepareConfig:R,skeletonDataset:[{name:"_",value:8,color:"#808080"},{name:"_",value:5,color:"#ADADAD"},{name:"_",value:3,color:"#DBDBDB"}],skeletonConfig:$e({defaultConfig:e.value,userConfig:{style:{backgroundColor:"#99999930",animation:{show:!1},bar:{gradient:{inderlayerColor:"#6A6A6A"}},title:{backgroundColor:"transparent"}}}})}),{svgRef:ye}=De({config:e.value.style.title});function R(){const t=ne({userConfig:x.config,defaultConfig:pe});return t.theme?{...ne({userConfig:Ee.vue_ui_sparkstackbar[t.theme]||x.config,defaultConfig:t}),customPalette:Ce[t.theme]||u}:t}H(()=>x.config,t=>{e.value=R(),W()},{deep:!0}),H(()=>m.value,t=>{b.value=m.value.map((o,l)=>({...o,color:o.color?F(o.color):S.value[l]||u[l]||u[l%u.length]})),Y()},{deep:!0});const S=C(()=>Se(e.value.customPalette)),b=c(m.value.map((t,o)=>({...t,value:e.value.style.animation.show?0:t.value||0,color:t.color?F(t.color):S.value[o]||u[o]||u[o%u.length]}))),_=c(!0);function Y(){if(!e.value.style.animation.show)return;const t=e.value.style.animation.animationFrames,o=m.value.map(i=>i.value||0),l=o.map(i=>i/t),a=o.reduce((i,n)=>i+n,0);let h=0;_.value=!0,b.value=m.value.map((i,n)=>({...i,value:0,color:i.color?F(i.color):S.value[n]||u[n]||u[n%u.length]}));function O(){h+=a/t,h<a?(b.value=b.value.map((i,n)=>({...i,value:Math.min(i.value+l[n],o[n]),color:i.color?F(i.color):S.value[n]||u[n]||u[n%u.length]})),requestAnimationFrame(O)):(_.value=!1,b.value=m.value.map((i,n)=>({...i,value:o[n],color:i.color?F(i.color):S.value[n]||u[n]||u[n%u.length],id:ae()})))}O()}Q(()=>{W()});const U=C(()=>e.value.debug);function W(){Ie(x.dataset)?oe({componentName:"VueUiSparkStackbar",type:"dataset",debug:U.value}):x.dataset.forEach((t,o)=>{Ae({datasetObject:t,requiredAttributes:["name","value"]}).forEach(l=>{oe({componentName:"VueUiSparkStackbar",type:"datasetSerieAttribute",property:l,index:o,debug:U.value})})}),Y()}const g=c({width:500,height:16}),y=c([]),q=C(()=>m.value.map(t=>t.value||0).filter((t,o)=>!y.value.includes(o)).reduce((t,o)=>t+o,0)),B=C(()=>b.value.map((t,o)=>{const l=t.value||0,a=l/q.value,h=isNaN(a)?0:a,O=h*g.value.width;return{...t,value:l,proportion:h,width:O,seriesIndex:o,proportionLabel:M({v:h*100,s:"%",r:e.value.style.legend.percentage.rounding})}})),T=C(()=>B.value.filter((t,o)=>!y.value.includes(o)));function fe(t){y.value.includes(t)?y.value=y.value.filter(o=>o!==t):y.value.length<b.value.length-1&&y.value.push(t)}const D=C(()=>{let t=0;const o=[];for(let l=0;l<T.value.length;l+=1)o.push({...T.value[l],start:t}),t+=T.value[l].width;return o}),he=de;function J(t,o,l=!1){he("selectDatapoint",{datapoint:t,index:o}),e.value.events.datapointClick&&!l&&e.value.events.datapointClick({datapoint:t,seriesIndex:t.seriesIndex})}const V=c(null),E=c(!1),$=c(null);function me({datapoint:t,seriesIndex:o}){P.value=!1,$.value=null,e.value.events.datapointLeave&&e.value.events.datapointLeave({datapoint:t,seriesIndex:t.seriesIndex})}function be({datapoint:t,seriesIndex:o}){if(e.value.events.datapointEnter&&e.value.events.datapointEnter({datapoint:t,seriesIndex:t.seriesIndex}),!e.value.style.tooltip.show)return;V.value={datapoint:t,seriesIndex:o,config:e.value,series:B.value},P.value=!0,$.value=o;const l=e.value.style.tooltip.customFormat;if(ze(l))try{const a=l({seriesIndex:t.seriesIndex,datapoint:t,series:B.value,config:e.value});typeof a=="string"&&(N.value=a,E.value=!0)}catch(a){console.warn("Custom format cannot be applied."),E.value=!1}if(!E.value){let a="";a+='<div style="width:100%;text-align:center;border-bottom:1px solid '.concat(e.value.style.tooltip.borderColor,';padding-bottom:6px;margin-bottom:3px;">').concat(t.name,"</div>"),a+='<div style="display:flex;flex-direction:row;gap:6px;align-items:center;"><svg viewBox="0 0 12 12" height="14" width="14"><circle cx="6" cy="6" r="6" stroke="none" fill="'.concat(t.color,'"/></svg>'),a+="<b>".concat(t.proportionLabel,"</b>"),a+="<span>(".concat(ie(e.value.style.legend.value.formatter,t.value,M({p:e.value.style.legend.value.prefix,v:t.value,s:e.value.style.legend.value.suffix,r:e.value.style.legend.value.rounding}),{datapoint:t,seriesIndex:o}),")</span>"),N.value="<div>".concat(a,"</div>")}}return(t,o)=>(s(),r("div",{class:"vue-data-ui-component vue-ui-spark-stackbar",ref_key:"sparkstackbarChart",ref:G,style:p("width:100%; background:".concat(e.value.style.backgroundColor))},[e.value.style.title.text?(s(),r("div",{key:0,style:p("width:calc(100% - 12px);background:transparent;margin:0 auto;margin:".concat(e.value.style.title.margin,";padding: 0 6px;text-align:").concat(e.value.style.title.textAlign))},[v("div",{class:"atom-title",style:p("font-size:".concat(e.value.style.title.fontSize,"px;color:").concat(e.value.style.title.color,";font-weight:").concat(e.value.style.title.bold?"bold":"normal"))},I(e.value.style.title.text),5),e.value.style.title.subtitle.text?(s(),r("div",{key:0,class:"atom-subtitle",style:p("font-size:".concat(e.value.style.title.subtitle.fontSize,"px;color:").concat(e.value.style.title.subtitle.color,";font-weight:").concat(e.value.style.title.subtitle.bold?"bold":"normal"))},I(e.value.style.title.subtitle.text),5)):f("",!0)],4)):f("",!0),(s(),r("svg",{ref_key:"svgRef",ref:ye,xmlns:d(Fe),width:"100%",viewBox:"0 0 ".concat(g.value.width," ").concat(g.value.height)},[K(d(ve)),v("defs",null,[(s(!0),r(k,null,A(D.value,(l,a)=>(s(),r("linearGradient",{key:"stack_gradient_".concat(a),gradientTransform:"rotate(90)",id:"stack_gradient_".concat(a,"_").concat(z.value)},[v("stop",{offset:"0%","stop-color":l.color},null,8,Re),v("stop",{offset:"50%","stop-color":d(se)(d(re)(l.color,.05),100-e.value.style.bar.gradient.intensity)},null,8,Te),v("stop",{offset:"100%","stop-color":l.color},null,8,Ve)],8,Ne))),128)),v("clipPath",je,[v("rect",{x:"0.005",y:"-2",width:"0.99",height:"5",rx:"3",ry:"3",fill:e.value.style.backgroundColor},null,8,Me)])]),q.value>0?(s(),r("g",Ge,[(s(!0),r(k,null,A(D.value,(l,a)=>(s(),r("rect",{key:"stack_underlayer_".concat(a),x:l.start,y:0,width:l.width,height:g.value.height,fill:e.value.style.bar.gradient.underlayerColor,class:L({animated:!_.value&&!d(w)}),style:p({opacity:$.value!==null&&e.value.style.tooltip.show?$.value===a?1:.5:1})},null,14,Ye))),128)),(s(!0),r(k,null,A(D.value,(l,a)=>(s(),r("rect",{key:"stack_".concat(a),x:l.start,y:0,width:l.width,height:g.value.height,fill:e.value.style.bar.gradient.show?"url(#stack_gradient_".concat(a,"_").concat(z.value,")"):l.color,stroke:e.value.style.backgroundColor,"stroke-linecap":"round",class:L({animated:!_.value&&!d(w)}),style:p({opacity:$.value!==null&&e.value.style.tooltip.show?$.value===a?1:.5:1})},null,14,Ue))),128)),(s(!0),r(k,null,A(D.value,(l,a)=>(s(),r("rect",{key:"stack_trap_".concat(a),x:l.start,y:0,width:l.width,height:g.value.height,fill:"transparent",stroke:"none",class:L({animated:!_.value&&!d(w)}),onClick:()=>J(l,a),onMouseenter:()=>be({datapoint:l,seriesIndex:a}),onMouseleave:h=>me({datapoint:l,seriesIndex:a})},null,42,We))),128))])):(s(),r("rect",{key:1,x:2,y:1,width:g.value.width-4,height:g.value.height-2,stroke:"#CCCCCC","stroke-width":"2",fill:"transparent",rx:(g.value.height-4)/2},null,8,qe))],8,Pe)),e.value.style.legend.show?(s(),r("div",{key:1,style:p("background:transparent;margin:0 auto;margin:".concat(e.value.style.legend.margin,";justify-content:").concat(e.value.style.legend.textAlign==="left"?"flex-start":e.value.style.legend.textAlign==="right"?"flex-end":"center")),class:"vue-ui-sparkstackbar-legend"},[(s(!0),r(k,null,A(B.value,(l,a)=>(s(),r("div",{style:p("font-size:".concat(e.value.style.legend.fontSize,"px;")),class:L({"vue-ui-sparkstackbar-legend-item":!0,"vue-ui-sparkstackbar-legend-item-unselected":y.value.includes(a)}),onClick:h=>{fe(a),J(l,a,!0)}},[v("div",Qe,[(s(),r("svg",{height:"".concat(e.value.style.legend.fontSize,"px"),width:"".concat(e.value.style.legend.fontSize,"px"),viewBox:"0 0 10 10"},[v("defs",null,[v("radialGradient",{id:"legend_grad_".concat(a,"-").concat(z.value)},[v("stop",{offset:"0%","stop-color":d(w)?"#FFFFFF":d(se)(d(re)(l.color,.05),100-e.value.style.bar.gradient.intensity)},null,8,Xe),v("stop",{offset:"100%","stop-color":l.color},null,8,Ze)],8,Ke)]),v("circle",{cx:5,cy:5,r:5,fill:e.value.style.bar.gradient.show?"url(#legend_grad_".concat(a,"-").concat(z.value,")"):l.color},null,8,et)],8,He)),d(w)?f("",!0):(s(),r(k,{key:0},[v("span",{style:p("color:".concat(e.value.style.legend.name.color,"; font-weight:").concat(e.value.style.legend.name.bold?"bold":"normal"))},I(l.name),5),_.value?f("",!0):(s(),r(k,{key:0},[e.value.style.legend.percentage.show?(s(),r("span",{key:0,style:p("font-weight:".concat(e.value.style.legend.percentage.bold?"bold":"normal",";color:").concat(e.value.style.legend.percentage.color))},I(y.value.includes(a)?" - ":l.proportionLabel),5)):f("",!0),e.value.style.legend.value.show?(s(),r("span",{key:1,style:p("font-weight:".concat(e.value.style.legend.value.bold?"bold":"normal",";color:").concat(e.value.style.legend.value.color))}," ("+I(d(ie)(e.value.style.legend.value.formatter,l.value,d(M)({p:e.value.style.legend.value.prefix,v:l.value,s:e.value.style.legend.value.suffix,r:e.value.style.legend.value.rounding}),{datapoint:l,seriesIndex:a}))+") ",5)):f("",!0)],64))],64))])],14,Je))),256))],4)):f("",!0),K(d(ce),{show:P.value&&e.value.style.tooltip.show,parent:G.value,backgroundColor:e.value.style.tooltip.backgroundColor,color:e.value.style.tooltip.color,fontSize:e.value.style.tooltip.fontSize,borderRadius:e.value.style.tooltip.borderRadius,borderColor:e.value.style.tooltip.borderColor,borderWidth:e.value.style.tooltip.borderWidth,backgroundOpacity:e.value.style.tooltip.backgroundOpacity,position:e.value.style.tooltip.position,content:N.value,isCustom:E.value,offsetY:-124+e.value.style.tooltip.offsetY,blockShiftY:!0,smooth:e.value.style.tooltip.smooth,backdropFilter:e.value.style.tooltip.backdropFilter,smoothForce:e.value.style.tooltip.smoothForce,smoothSnapThreshold:e.value.style.tooltip.smoothSnapThreshold},{"tooltip-before":Z(()=>[j(t.$slots,"tooltip-before",ee(te({...V.value})),void 0,!0)]),"tooltip-after":Z(()=>[j(t.$slots,"tooltip-after",ee(te({...V.value})),void 0,!0)]),_:3},8,["show","parent","backgroundColor","color","fontSize","borderRadius","borderColor","borderWidth","backgroundOpacity","position","content","isCustom","offsetY","smooth","backdropFilter","smoothForce","smoothSnapThreshold"]),t.$slots.source?(s(),r("div",tt,[j(t.$slots,"source",{},void 0,!0)],512)):f("",!0),d(w)?(s(),we(Le,{key:3})):f("",!0)],4))}},dt=_e(lt,[["__scopeId","data-v-ae2ae4f4"]]);export{dt as default};
