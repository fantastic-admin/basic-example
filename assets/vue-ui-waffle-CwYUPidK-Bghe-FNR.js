
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * https://fantastic-admin.hurui.me
 */
    
const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./Tooltip-D0pGX8qz-BS2YwyOE.js","./vue-data-ui-8Gmf-dDN.js","./index-CJB5jCfL.js","./index-D6D_bXIl.css","./alert-I_0TAljB.js","./vue-data-ui-C46fMXq5.css","./DataTable-BfEbVwm4-B-GxLkq-.js","./Shape-12_eh8zD-Cy1mu6XW.js","./vue-ui-accordion-DNRtKVZI-Cfsr7GT0.js","./useNestedProp-DaR1dBmj-yWXLkJlG.js","./UserOptions-Cy-iNhZU-CnpDVImt.js","./vClickOutside-C6WiFswA-B2BXHGcD.js","./img-CqYIrJ8I-E54QgU9o.js","./dom-to-png-WXGPkYro-BQsfl1t5.js","./PenAndPaper--ADXtx65-ugytqLuo.js","./ColorPicker-BYn8PF2Z-DkxHqz9_.js","./PackageVersion-By5ZZJ0U-Cc8IPeAX.js","./BaseDraggableDialog-BFDTrOH0-Bty23wRr.js"])))=>i.map(i=>d[i]);
import{ac as Kl,J as v,e as i,a8 as Ql,K,av as al,E as Zl,aw as et,c1 as L,c,o as s,z as V,A as k,f as C,g as oe,h as d,r as g,j as A,k as $,u as h,c3 as Ae,O as ue,n as ol,F as _,R as D,m as $e,t as re,bq as lt,l as ul,N as tt,c4 as z,aa as at}from"./index-CJB5jCfL.js";import{s as ot,J as ut,x as rt,v as st,o as G,E as rl,A as _e,a as nt,$ as it,L as Q,F as P,d as ct,w as vt,X as dt,m as ht,u as gt,e as pt,f as ft,a2 as yt,g as bt,p as mt}from"./vue-data-ui-8Gmf-dDN.js";import{l as kt}from"./labelUtils-B3mOOEke-Caugf9-y.js";import{E as Ct,M as wt}from"./useResponsive-DfdjqQps-DzVAt69W.js";import{s as xt,i as Fe}from"./useNestedProp-DaR1dBmj-yWXLkJlG.js";import{T as At,j as $t}from"./BaseScanner-BMpwQAfz-mc47WWxo.js";import{m as _t}from"./usePrinter-ChVMpU2f-B27PF0nl.js";import{O as Ft}from"./useSvgExport-ByUukOZt-XO0OK7cR.js";import{i as It}from"./useThemeCheck-DGJ31Vi5-GRZcYzX8.js";import{a as Tt}from"./useUserOptionState-BIvW1Kz7-D70wY835.js";import{o as Et}from"./useChartAccessibility-9icAAmYg-CuAxjhEs.js";import Ot from"./img-CqYIrJ8I-E54QgU9o.js";import{b as Bt}from"./Shape-12_eh8zD-Cy1mu6XW.js";import Pt from"./Title-D0nD-PMs-DAiwElB_.js";import St from"./Legend-D2xmnFPH-CItLelVI.js";import"./alert-I_0TAljB.js";import"./dom-to-png-WXGPkYro-BQsfl1t5.js";const sl={style:{chart:{backgroundColor:"#1A1A1A",color:"#CCCCCC",layout:{rect:{rounded:!1,stroke:"#1A1A1A"}},legend:{backgroundColor:"#1A1A1A",color:"#CCCCCC"},title:{color:"#CCCCCC",subtitle:{color:"#757575"}},tooltip:{backgroundColor:"#1A1A1A",backgroundOpacity:70,color:"#CCCCCC",borderColor:"#5A5A5A"}}},table:{th:{backgroundColor:"#1A1A1A",color:"#CCCCCC"},td:{backgroundColor:"#1A1A1A",color:"#CCCCCC"}}},nl={style:{chart:{backgroundColor:"#FFF8E1",color:"#424242",layout:{rect:{rounded:!1,stroke:"#FFF8E1",useGradient:!1}},legend:{color:"#424242",backgroundColor:"#FFF8E1"},title:{color:"#424242",subtitle:{color:"#757575"}},tooltip:{backgroundColor:"#FFECB3",backgroundOpacity:30,color:"#424242",borderColor:"#FF8A65"}}},table:{th:{backgroundColor:"#FFF8E1",color:"#424242"},td:{backgroundColor:"#FFF8E1",color:"#424242"}}},il={style:{chart:{backgroundColor:"#1E1E1E",color:"#BDBDBD",layout:{rect:{rounded:!1,stroke:"#1E1E1E",useGradient:!1}},legend:{color:"#BDBDBD",backgroundColor:"#1E1E1E"},title:{color:"#FFF8E1",subtitle:{color:"#BDBDBD"}},tooltip:{backgroundColor:"#1E1E1E",backgroundOpacity:30,color:"#FFF8E1",borderColor:"#FF8A65"}}},table:{th:{backgroundColor:"#1E1E1E",color:"#BDBDBD"},td:{backgroundColor:"#1E1E1E",color:"#BDBDBD"}}},cl={style:{chart:{backgroundColor:"#1A1A1A",color:"#99AA99",layout:{rect:{rounded:!1,stroke:"#66CC66",useGradient:!1}},legend:{color:"#99AA99",backgroundColor:"#1A1A1A"},title:{color:"#66CC66",subtitle:{color:"#99AA99"}},tooltip:{backgroundColor:"#2A2F2A",color:"#AACCAA",borderColor:"#66CC66"}}},table:{th:{backgroundColor:"#1A1A1A",color:"#99AA99"},td:{backgroundColor:"#1A1A1A",color:"#AACCAA"}}},vl={style:{chart:{backgroundColor:"#fbfafa",color:"#8A9892",layout:{rect:{rounding:4,stroke:"#fbfafa"}},legend:{backgroundColor:"#fbfafa",color:"#99AA99"},title:{color:"#8A9892",subtitle:{color:"#99AA99"}},tooltip:{backgroundColor:"#fbfafa",color:"#8A9892"}}},table:{th:{backgroundColor:"#fbfafa",color:"#8F837A"},td:{backgroundColor:"#fbfafa",color:"#8F837A"}}},dl={style:{chart:{backgroundColor:"#f6f6fb",color:"#50606C",layout:{rect:{rounded:!1,stroke:"#404C5A",useGradient:!1}},legend:{backgroundColor:"#f6f6fb",color:"#61747E"},title:{color:"#50606C",subtitle:{color:"#718890"}},tooltip:{backgroundColor:"#f6f6fb",color:"#50606C"}}},table:{th:{backgroundColor:"#f6f6fb",color:"#50606C"},td:{backgroundColor:"#f6f6fb",color:"#50606C"}}},hl={default:{},dark:sl,celebration:nl,celebrationNight:il,hack:cl,zen:vl,concrete:dl},ka=Object.freeze(Object.defineProperty({__proto__:null,celebration:nl,celebrationNight:il,concrete:dl,dark:sl,default:hl,hack:cl,zen:vl},Symbol.toStringTag,{value:"Module"})),Lt=["id"],Vt=["id"],Dt=["xmlns","viewBox"],zt=["id"],Nt=["stop-color"],Mt=["stop-color"],Rt=["id"],Gt=["x","y","height","width"],Ut=["height","width"],Wt={key:0},jt=["rx","x","y","height","width","stroke","stroke-width","filter"],qt=["rx","x","y","height","width","fill","stroke","stroke-width","filter"],Ht={key:1},Xt=["rx","x","y","height","width","fill","filter"],Yt=["textContent","x","y","font-size","fill","filter"],Jt=["x","y","height","width","onMouseover","onMouseleave","onClick"],Kt={key:4,class:"vue-data-ui-watermark"},Qt=["id"],Zt=["onClick"],ea=["innerHTML"],la={__name:"vue-ui-waffle",props:{config:{type:Object,default(){return{}}},dataset:{type:Array,default(){return[]}}},emits:["selectLegend"],setup(gl,{expose:pl,emit:fl}){const yl=L(()=>z(()=>import("./Tooltip-D0pGX8qz-BS2YwyOE.js"),__vite__mapDeps([0,1,2,3,4,5]),import.meta.url)),bl=L(()=>z(()=>import("./vue-data-ui-8Gmf-dDN.js").then(l=>l.aA),__vite__mapDeps([1,2,3,4,5]),import.meta.url)),ml=L(()=>z(()=>import("./DataTable-BfEbVwm4-B-GxLkq-.js"),__vite__mapDeps([6,2,3,7,1,4,5]),import.meta.url)),kl=L(()=>z(()=>import("./vue-ui-accordion-DNRtKVZI-Cfsr7GT0.js"),__vite__mapDeps([8,2,3,1,4,5,9]),import.meta.url)),Cl=L(()=>z(()=>import("./UserOptions-Cy-iNhZU-CnpDVImt.js"),__vite__mapDeps([10,2,3,11,1,4,5,12,13]),import.meta.url)),wl=L(()=>z(()=>import("./PenAndPaper--ADXtx65-ugytqLuo.js"),__vite__mapDeps([14,2,3,1,4,5,15,11]),import.meta.url)),xl=L(()=>z(()=>import("./PackageVersion-By5ZZJ0U-Cc8IPeAX.js"),__vite__mapDeps([16,2,3]),import.meta.url)),Al=L(()=>z(()=>import("./BaseDraggableDialog-BFDTrOH0-Bty23wRr.js"),__vite__mapDeps([17,2,3,1,4,5]),import.meta.url)),{vue_ui_waffle:$l}=xt(),{isThemeValid:_l,warnInvalidTheme:Fl}=It(),m=gl,Il=Kl(),se=v(()=>!!m.dataset&&m.dataset.length),b=i(ut()),ne=i(!1),ie=i(""),U=i(null),Ie=i(0),F=i(null),Te=i(null),Ee=i(null),Oe=i(null),Be=i(null),Pe=i(0),Se=i(0),Le=i(0),Ve=i(!1),q=i(null),ce=i(null),e=i(ge()),{loading:De,FINAL_DATASET:Z,manualLoading:ve}=At({...Ql(m),FINAL_CONFIG:e,prepareConfig:ge,callback:()=>{Promise.resolve().then(async()=>{p.value=pe()})},skeletonDataset:[{name:"",values:[1],color:"#AAAAAA"},{name:"",values:[1],color:"#BABABA"},{name:"",values:[1],color:"#CACACA"}],skeletonConfig:rt({defaultConfig:e.value,userConfig:{useCustomCells:!1,userOptions:{show:!1},table:{show:!1},style:{chart:{backgroundColor:"#99999930",layout:{labels:{captions:{show:!1}},rect:{stroke:"#999999"}},legend:{backgroundColor:"transparent",showValue:!1,showPercentage:!1}}}}})}),{userOptionsVisible:de,setUserOptionsVisibility:ze,keepUserOptionState:Ne}=Tt({config:e.value}),{svgRef:he}=Et({config:e.value.style.chart.title});function ge(){const l=Fe({userConfig:m.config,defaultConfig:$l}),t=l.theme;if(!t)return l;if(!_l.value(l))return Fl(l),l;const a=Fe({userConfig:hl[t]||m.config,defaultConfig:l}),o=Fe({userConfig:m.config,defaultConfig:a});return{...o,customPalette:o.customPalette.length?o.customPalette:st[t]||G}}K(()=>m.config,l=>{De.value||(e.value=ge()),de.value=!e.value.userOptions.showOnChartHover,Re(),Pe.value+=1,Se.value+=1,Le.value+=1,w.value.showTable=e.value.table.show,w.value.showTooltip=e.value.style.chart.tooltip.show},{deep:!0});const S=al(null),W=al(null),Me=v(()=>!!e.value.debug);function Re(){if(rl(m.dataset)?(_e({componentName:"VueUiWaffle",type:"dataset",debug:Me.value}),se.value=!1,ve.value=!0):m.dataset.forEach((l,t)=>{nt({datasetObject:l,requiredAttributes:["name","values"]}).forEach(a=>{_e({componentName:"VueUiWaffle",type:"datasetSerieAttribute",property:a,index:t,debug:Me.value})})}),rl(m.dataset)||(ve.value=e.value.loading),e.value.responsive){const l=Ct(()=>{const{width:t,height:a}=wt({chart:F.value,title:e.value.style.chart.title.text?Te.value:null,legend:e.value.style.chart.legend.show?Ee.value:null,source:Oe.value,noTitle:Be.value});requestAnimationFrame(()=>{N.value.width=t,N.value.height=a,I.value.width=t,I.value.height=a})});S.value&&(W.value&&S.value.unobserve(W.value),S.value.disconnect()),S.value=new ResizeObserver(l),W.value=F.value.parentNode,S.value.observe(W.value)}}Zl(()=>{Ve.value=!0,Re()}),et(()=>{S.value&&(W.value&&S.value.unobserve(W.value),S.value.disconnect())});const{isPrinting:Ge,isImaging:Ue,generatePdf:We,generateImage:je}=_t({elementId:"vue-ui-waffle_".concat(b.value),fileName:e.value.style.chart.title.text||"vue-ui-waffle",options:e.value.userOptions.print}),Tl=v(()=>e.value.userOptions.show&&!e.value.style.chart.title.text),qe=v(()=>it(e.value.customPalette)),w=i({showTable:e.value.table.show,showTooltip:e.value.style.chart.tooltip.show});K(e,()=>{w.value={showTable:e.value.table.show,showTooltip:e.value.style.chart.tooltip.show}},{immediate:!0});const N=i({height:512,width:512}),I=i({top:0,left:0,height:512,width:512}),T=v(()=>(I.value.width-e.value.style.chart.layout.grid.size*e.value.style.chart.layout.grid.spaceBetween)/e.value.style.chart.layout.grid.size),E=v(()=>(I.value.height-e.value.style.chart.layout.grid.size*e.value.style.chart.layout.grid.spaceBetween)/e.value.style.chart.layout.grid.size),El=v(()=>Math.max(1e-4,I.value.width/e.value.style.chart.layout.grid.size)),He=v(()=>Math.max(1e-4,I.value.height/e.value.style.chart.layout.grid.size));function Xe(l){const t=e.value.style.chart.layout.grid.size*e.value.style.chart.layout.grid.size,a=l.reduce((x,xe)=>x+xe,0),o=l.map(x=>x/a*t),u=o.map(Math.floor),r=o.map(x=>x%1);let f=t-u.reduce((x,xe)=>x+xe,0);for(;f>0;){let x=r.indexOf(Math.max(...r));u[x]+=1,r[x]=0,f-=1}return u}const H=i(!1);function pe(){return H.value=Z.value.flatMap(l=>l.values.reduce((t,a)=>t+a,0)).reduce((l,t)=>l+t,0)===0,Z.value.map((l,t)=>({...l,color:gt(l.color)||qe.value[t]||G[t]||G[t%G.length],uid:"serie_".concat(t),absoluteIndex:t}))}const fe=v(()=>pe()),p=i(fe.value);K(()=>m.dataset,l=>{Array.isArray(l)&&l.length>0&&(ve.value=!1)},{immediate:!0}),K(()=>m.dataset,l=>{p.value=pe()},{deep:!0});const Ol=v(()=>{const l=p.value.filter((t,a)=>!y.value.includes(t.uid)).map((t,a)=>H.value?1:(t.values||[]).reduce((o,u)=>o+u,0));return Xe(l)}),Bl=v(()=>{const l=p.value.map((t,a)=>H.value?1:(t.values||[]).reduce((o,u)=>o+u));return Xe(l)}),X=v(()=>(Z.value.forEach((l,t)=>{[null,void 0].includes(l.values)&&_e({componentName:"VueUiWaffle",type:"datasetSerieAttribute",property:"values (number[])",index:t})}),p.value.filter((l,t)=>!y.value.includes(l.uid)).map((l,t)=>({absoluteIndex:l.absoluteIndex,uid:l.uid,name:l.name,color:l.color,value:(l.values||[]).reduce((a,o)=>a+o,0),absoluteValues:l.values||[],proportion:Ol.value[t]})))),ye=v(()=>p.value.map((l,t)=>({absoluteIndex:l.absoluteIndex,uid:l.uid,name:l.name,color:l.color,value:(l.values||[]).reduce((a,o)=>a+o,0),absoluteValues:l.values||[],proportion:Bl.value[t]})));function Pl(){return ye.value.map(l=>({name:l.name,color:l.color,value:l.value,proportion:l.proportion}))}const Sl=v(()=>{let l=0;return X.value.map((t,a)=>{const o=l,u=o+t.proportion,r=[];for(let f=Math.floor(o);f<Math.floor(u);f+=1)r.push(f);return l=u,{...t,start:o,rects:r}})}),n=v(()=>Sl.value.flatMap((l,t)=>l.rects.map((a,o)=>({isFirst:o===0,isLongEnough:a.length>2,name:l.name,color:l.color,value:l.value,serieIndex:t,absoluteStartIndex:o<3,serieId:l.uid,...l}))).map((l,t)=>({...l,isAbsoluteFirst:t%e.value.style.chart.layout.grid.size===0}))),j=v(()=>{const l=[];for(let t=0;t<e.value.style.chart.layout.grid.size;t+=1)for(let a=0;a<e.value.style.chart.layout.grid.size;a+=1)l.push({isStartOfLine:a===0,position:e.value.style.chart.layout.grid.vertical?t:a,x:(e.value.style.chart.layout.grid.vertical?t:a)*(T.value+e.value.style.chart.layout.grid.spaceBetween),y:(e.value.style.chart.layout.grid.vertical?a:t)*(E.value+e.value.style.chart.layout.grid.spaceBetween)+I.value.top});return l}),y=i([]),Y=i(!1),Ye=i(null),Je=i(null);function ee(l){if(H.value)return;if(!e.value.useAnimation){y.value.includes(l)?y.value=y.value.filter(u=>u!==l):y.value.length<M.value.length-1&&M.value.length>1&&y.value.push(l);return}const t=fe.value.find(u=>u.uid===l).values.reduce((u,r)=>u+r,0),a=p.value.find(u=>u.uid===l).values.reduce((u,r)=>u+r,0);let o=a;if(!(a===0&&t===0)){if(y.value.includes(l)){let u=function(){o>r?(cancelAnimationFrame(Ye.value),p.value=p.value.map((f,x)=>f.uid===l?{...f,values:[r]}:f),Y.value=!1):(Y.value=!0,o+=r*.025,p.value=p.value.map((f,x)=>f.uid===l?{...f,values:[o]}:f),Ye.value=requestAnimationFrame(u))};y.value=y.value.filter(f=>f!==l);const r=t;u()}else if(y.value.length<M.value.length-1&&M.value.length>1){let u=function(){o<a/100?(cancelAnimationFrame(Je.value),y.value.push(l),p.value=p.value.map((r,f)=>r.uid===l?{...r,values:[0]}:r),Y.value=!1):(Y.value=!0,o/=1.15,p.value=p.value.map(r=>r.uid===l?{...r,values:[o]}:r),Je.value=requestAnimationFrame(u))};u()}Rl("selectLegend",X.value.map(u=>({name:u.name,color:u.color,value:u.value,proportion:u.proportion/Math.pow(e.value.style.chart.layout.grid.size,2)})))}}function Ke(l){return ye.value.length?ye.value.find(a=>a.name===l)||(e.value.debug&&console.warn('VueUiWaffle - Series name not found "'.concat(l,'"')),null):(e.value.debug&&console.warn("VueUiWaffle - There are no series to show."),null)}function Ll(l){const t=Ke(l);t!==null&&y.value.includes(t.uid)&&ee(t.uid)}function Vl(l){const t=Ke(l);t!==null&&(y.value.includes(t.uid)||ee(t.uid))}function be({val:l,percentage:t,showVal:a,showPercentage:o,config:u}){return kt({config:u,val:l,percentage:t,showVal:a,showPercentage:o})}const M=v(()=>p.value.map((l,t)=>{const a=(l.values||[]).reduce((u,r)=>u+r,0),o=a/p.value.map(u=>(u.values||[]).reduce((r,f)=>r+f,0)).reduce((u,r)=>u+r,0);return{name:l.name,color:l.color||qe[t]||G[t]||G[t%G.length],value:a,proportion:o,uid:l.uid,shape:"square"}}).map((l,t)=>{const a=Q(e.value.style.chart.layout.labels.dataLabels.formatter,l.value,P({p:e.value.style.chart.layout.labels.dataLabels.prefix,v:l.value,s:e.value.style.chart.layout.labels.dataLabels.suffix,r:e.value.style.chart.legend.roundingValue}),{datapoint:l,index:t}),o=isNaN(l.value/O.value)?"-":P({v:l.value/O.value*100,s:"%",r:e.value.style.chart.legend.roundingPercentage}),u=be({val:a,percentage:o,showVal:e.value.style.chart.legend.showValue,showPercentage:e.value.style.chart.legend.showPercentage,config:e.value.style.chart.legend});return{...l,opacity:y.value.includes(l.uid)?.5:1,segregate:()=>ee(l.uid),isSegregated:y.value.includes(l.uid),display:"".concat(l.name).concat(e.value.style.chart.legend.showPercentage||e.value.style.chart.legend.showValue?": ":"").concat(u)}})),Dl=v(()=>({cy:"waffle-div-legend",backgroundColor:e.value.style.chart.legend.backgroundColor,color:e.value.style.chart.legend.color,fontSize:e.value.style.chart.legend.fontSize,paddingBottom:12,fontWeight:e.value.style.chart.legend.bold?"bold":""})),O=v(()=>X.value.map(l=>l.value).reduce((l,t)=>l+t,0)),me=i(null),ke=i(null);function zl(l){const t=n.value[l];e.value.events.datapointClick&&e.value.events.datapointClick({datapoint:t,seriesIndex:t.serieIndex})}function Nl(l){const t=n.value[l];e.value.events.datapointLeave&&e.value.events.datapointLeave({datapoint:t,seriesIndex:t.serieIndex}),ke.value=null,ne.value=!1,U.value=null}function Ml(l){if(y.value.length===m.dataset.length)return;const t=n.value[l];me.value={datapoint:t,seriesIndex:t.absoluteIndex,series:p.value,config:e.value},e.value.events.datapointEnter&&ke.value!==t.serieIndex&&e.value.events.datapointEnter({datapoint:t,seriesIndex:t.serieIndex}),ke.value=t.serieIndex,ne.value=!0,U.value=n.value[l].serieIndex;const a=e.value.style.chart.tooltip.customFormat;if(bt(a)&&mt(()=>a({seriesIndex:n.value[l].absoluteIndex,datapoint:t,series:p.value,config:e.value})))ie.value=a({seriesIndex:n.value[l].absoluteIndex,datapoint:t,series:p.value,config:e.value});else{let o="";o+='<div style="width:100%;text-align:center;border-bottom:1px solid '.concat(e.value.style.chart.tooltip.borderColor,';padding-bottom:6px;margin-bottom:3px;">').concat(t.name,"</div>"),o+='<div style="display:flex;flex-direction:row;gap:6px;align-items:center;"><svg viewBox="0 0 60 60" height="14" width="14"><rect x="0" y="0" height="60" width="60" stroke="none" rx="1" fill="'.concat(t.color,'" />').concat(Il.pattern?'<rect x="0" y="0" height="60" width="60" stroke="none" rx="1" stroke="none" fill="url(#pattern_'.concat(b.value,"_").concat(t.absoluteIndex,')"/>'):"","</svg>"),o+="<b>".concat(be({config:e.value.style.chart.tooltip,showVal:e.value.style.chart.tooltip.showValue,showPercentage:e.value.style.chart.tooltip.showPercentage,val:"<span>".concat(Q(e.value.style.chart.layout.labels.dataLabels.formatter,t.value,P({p:e.value.style.chart.layout.labels.dataLabels.prefix,v:t.value,s:e.value.style.chart.layout.labels.dataLabels.suffix,r:e.value.style.chart.tooltip.roundingValue}),{datapoint:t,seriesIndex:n.value[l].absoluteIndex,series:p.value}),"</span>"),percentage:"<span>".concat(P({v:H.value?1/Z.value.length*100:t.value/O.value*100,s:"%",r:e.value.style.chart.tooltip.roundingPercentage}),"</span>")}),"</b></div>"),ie.value=o}}const Rl=fl,B=v(()=>{const l=X.value.map(a=>({name:a.name,color:a.color})),t=X.value.map(a=>a.value);return{head:l,body:t}});function le(l){return e.value.useBlurOnHover&&![null,void 0].includes(U.value)&&U.value!==l?"url(#blur_".concat(b.value,")"):""}function Gl(l,t){return e.value.style.chart.layout.labels.captions.show?n.value.length&&!Y.value&&!e.value.style.chart.layout.grid.vertical&&(n.value[l].isFirst&&t.position<e.value.style.chart.layout.grid.size-2||n.value[l].isAbsoluteFirst&&l%e.value.style.chart.layout.grid.size===0&&n.value[l].absoluteStartIndex):!1}function Ul(l,t=null){const a=Q(e.value.style.chart.layout.labels.dataLabels.formatter,n.value[l].value,P({p:e.value.style.chart.layout.labels.dataLabels.prefix,v:n.value[l].value,s:e.value.style.chart.layout.labels.dataLabels.suffix,r:e.value.style.chart.layout.labels.captions.roundingValue}),{datapoint:n.value[l],position:t}),o=P({v:n.value[l].proportion,s:"%",r:e.value.style.chart.layout.labels.captions.roundingPercentage}),u=(e.value.style.chart.layout.labels.captions.serieNameAbbreviation?yt({source:n.value[l].name,length:e.value.style.chart.layout.labels.captions.serieNameMaxAbbreviationSize}):n.value[l].name)+(e.value.style.chart.layout.labels.captions.showPercentage||e.value.style.chart.layout.labels.captions.showValue?":":""),r=e.value.style.chart.layout.labels.captions.showSerieName?u:"",f=be({val:a,percentage:o,showVal:e.value.style.chart.layout.labels.captions.showValue,showPercentage:e.value.style.chart.layout.labels.captions.showPercentage,config:e.value.style.chart.layout.labels.dataLabels});return"".concat(r," ").concat(f)}function Ce(l=null){at(()=>{const t=B.value.head.map((u,r)=>[[u.name],[B.value.body[r]],[isNaN(B.value.body[r]/O.value)?"-":B.value.body[r]/O.value*100]]),a=[[e.value.style.chart.title.text],[e.value.style.chart.title.subtitle.text],[[""],["val"],["%"]]].concat(t),o=pt(a);l?l(o):ft({csvContent:o,title:e.value.style.chart.title.text||"vue-ui-waffle"})})}const te=v(()=>{const l=[' <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M18 16v2a1 1 0 0 1 -1 1h-11l6 -7l-6 -7h11a1 1 0 0 1 1 1v2" /></svg>',Q(e.value.style.chart.layout.labels.dataLabels.formatter,O.value,P({p:e.value.style.chart.layout.labels.dataLabels.prefix,v:O.value,s:e.value.style.chart.layout.labels.dataLabels.suffix,r:e.value.table.td.roundingValue})),"100%"],t=B.value.head.map((u,r)=>[{color:u.color,name:u.name},Q(e.value.style.chart.layout.labels.dataLabels.formatter,B.value.body[r],P({p:e.value.style.chart.layout.labels.dataLabels.prefix,v:B.value.body[r],s:e.value.style.chart.layout.labels.dataLabels.suffix,r:e.value.table.td.roundingValue})),isNaN(B.value.body[r]/O.value)?"-":P({v:B.value.body[r]/O.value*100,s:"%",r:e.value.table.td.roundingPercentage})]),a={th:{backgroundColor:e.value.table.th.backgroundColor,color:e.value.table.th.color,outline:e.value.table.th.outline},td:{backgroundColor:e.value.table.td.backgroundColor,color:e.value.table.td.color,outline:e.value.table.td.outline},shape:"square",breakpoint:e.value.table.responsiveBreakpoint},o=[e.value.table.columnNames.series,e.value.table.columnNames.value,e.value.table.columnNames.percentage];return{head:l,body:t,config:a,colNames:o}}),R=i(!1);function Qe(l){R.value=l,Ie.value+=1}function Ze(){w.value.showTable=!w.value.showTable}function el(){w.value.showTooltip=!w.value.showTooltip}const ae=i(!1);function we(){ae.value=!ae.value}async function Wl({scale:l=2}={}){if(!F.value)return;const{width:t,height:a}=F.value.getBoundingClientRect(),o=t/a,{imageUri:u,base64:r}=await Ot({domElement:F.value,base64:!0,img:!0,scale:l});return{imageUri:u,base64:r,title:e.value.style.chart.title.text,width:t,height:a,aspectRatio:o}}const J=v(()=>{const l=e.value.table.useDialog&&!e.value.table.show,t=w.value.showTable;return{component:l?Al:kl,title:"".concat(e.value.style.chart.title.text).concat(e.value.style.chart.title.subtitle.text?": ".concat(e.value.style.chart.title.subtitle.text):""),props:l?{backgroundColor:e.value.table.th.backgroundColor,color:e.value.table.th.color,headerColor:e.value.table.th.color,headerBg:e.value.table.th.backgroundColor,isFullscreen:R.value,fullscreenParent:F.value,forcedWidth:Math.min(500,window.innerWidth*.8)}:{hideDetails:!0,config:{open:t,maxHeight:1e4,body:{backgroundColor:e.value.style.chart.backgroundColor,color:e.value.style.chart.color},head:{backgroundColor:e.value.style.chart.backgroundColor,color:e.value.style.chart.color}}}}});K(()=>w.value.showTable,l=>{e.value.table.show||(l&&e.value.table.useDialog&&q.value?q.value.open():"close"in q.value&&q.value.close())});function ll(){w.value.showTable=!1,ce.value&&ce.value.setTableIconState(!1)}const jl=v(()=>M.value.map(l=>({...l,name:l.display}))),ql=v(()=>e.value.style.chart.backgroundColor),Hl=v(()=>e.value.style.chart.legend),Xl=v(()=>e.value.style.chart.title),{exportSvg:Yl,getSvg:Jl}=Ft({svg:he,title:Xl,legend:Hl,legendItems:jl,backgroundColor:ql});async function tl({isCb:l}){if(l){const{blob:t,url:a,text:o,dataUrl:u}=await Jl();e.value.userOptions.callbacks.svg({blob:t,url:a,text:o,dataUrl:u})}else Yl()}return pl({getData:Pl,getImage:Wl,generatePdf:We,generateCsv:Ce,generateImage:je,generateSvg:tl,hideSeries:Vl,showSeries:Ll,toggleTable:Ze,toggleTooltip:el,toggleAnnotator:we,toggleFullscreen:Qe}),(l,t)=>(s(),c("div",{class:ol("vue-data-ui-component vue-ui-waffle ".concat(R.value?"vue-data-ui-wrapper-fullscreen":"")),ref_key:"waffleChart",ref:F,id:"vue-ui-waffle_".concat(b.value),style:ue("font-family:".concat(e.value.style.fontFamily,";width:100%; text-align:center;background:").concat(e.value.style.chart.backgroundColor,";").concat(e.value.responsive?"height: 100%":"")),onMouseenter:t[2]||(t[2]=()=>h(ze)(!0)),onMouseleave:t[3]||(t[3]=()=>h(ze)(!1))},[e.value.userOptions.buttons.annotator?(s(),V(h(wl),{key:0,svgRef:h(he),backgroundColor:e.value.style.chart.backgroundColor,color:e.value.style.chart.color,active:ae.value,onClose:we},{"annotator-action-close":d(()=>[g(l.$slots,"annotator-action-close",{},void 0,!0)]),"annotator-action-color":d(({color:a})=>[g(l.$slots,"annotator-action-color",A($({color:a})),void 0,!0)]),"annotator-action-draw":d(({mode:a})=>[g(l.$slots,"annotator-action-draw",A($({mode:a})),void 0,!0)]),"annotator-action-undo":d(({disabled:a})=>[g(l.$slots,"annotator-action-undo",A($({disabled:a})),void 0,!0)]),"annotator-action-redo":d(({disabled:a})=>[g(l.$slots,"annotator-action-redo",A($({disabled:a})),void 0,!0)]),"annotator-action-delete":d(({disabled:a})=>[g(l.$slots,"annotator-action-delete",A($({disabled:a})),void 0,!0)]),_:3},8,["svgRef","backgroundColor","color","active"])):k("",!0),Tl.value?(s(),c("div",{key:1,ref_key:"noTitle",ref:Be,class:"vue-data-ui-no-title-space",style:"height:36px; width: 100%;background:transparent"},null,512)):k("",!0),e.value.style.chart.title.text?(s(),c("div",{key:2,ref_key:"chartTitle",ref:Te,style:"width:100%;background:transparent;padding-bottom:12px"},[(s(),V(Pt,{key:"title_".concat(Pe.value),config:{title:{cy:"waffle-title",...e.value.style.chart.title},subtitle:{cy:"waffle-subtitle",...e.value.style.chart.title.subtitle}}},null,8,["config"]))],512)):k("",!0),C("div",{id:"legend-top-".concat(b.value)},null,8,Vt),e.value.userOptions.show&&se.value&&(h(Ne)||h(de))?(s(),V(h(Cl),{ref_key:"userOptionsRef",ref:ce,key:"user_options_".concat(Ie.value),backgroundColor:e.value.style.chart.backgroundColor,color:e.value.style.chart.color,isPrinting:h(Ge),isImaging:h(Ue),uid:b.value,hasTooltip:e.value.userOptions.buttons.tooltip&&e.value.style.chart.tooltip.show,hasPdf:e.value.userOptions.buttons.pdf,hasImg:e.value.userOptions.buttons.img,hasSvg:e.value.userOptions.buttons.svg,hasXls:e.value.userOptions.buttons.csv,hasTable:e.value.userOptions.buttons.table,hasFullscreen:e.value.userOptions.buttons.fullscreen,isFullscreen:R.value,isTooltip:w.value.showTooltip,titles:{...e.value.userOptions.buttonTitles},chartElement:F.value,position:e.value.userOptions.position,hasAnnotator:e.value.userOptions.buttons.annotator,isAnnotation:ae.value,callbacks:e.value.userOptions.callbacks,printScale:e.value.userOptions.print.scale,tableDialog:e.value.table.useDialog,onToggleFullscreen:Qe,onGeneratePdf:h(We),onGenerateCsv:Ce,onGenerateImage:h(je),onGenerateSvg:tl,onToggleTable:Ze,onToggleTooltip:el,onToggleAnnotator:we,style:ue({visibility:h(Ne)?h(de)?"visible":"hidden":"visible"})},Ae({_:2},[l.$slots.menuIcon?{name:"menuIcon",fn:d(({isOpen:a,color:o})=>[g(l.$slots,"menuIcon",A($({isOpen:a,color:o})),void 0,!0)]),key:"0"}:void 0,l.$slots.optionTooltip?{name:"optionTooltip",fn:d(()=>[g(l.$slots,"optionTooltip",{},void 0,!0)]),key:"1"}:void 0,l.$slots.optionPdf?{name:"optionPdf",fn:d(()=>[g(l.$slots,"optionPdf",{},void 0,!0)]),key:"2"}:void 0,l.$slots.optionCsv?{name:"optionCsv",fn:d(()=>[g(l.$slots,"optionCsv",{},void 0,!0)]),key:"3"}:void 0,l.$slots.optionImg?{name:"optionImg",fn:d(()=>[g(l.$slots,"optionImg",{},void 0,!0)]),key:"4"}:void 0,l.$slots.optionSvg?{name:"optionSvg",fn:d(()=>[g(l.$slots,"optionSvg",{},void 0,!0)]),key:"5"}:void 0,l.$slots.optionTable?{name:"optionTable",fn:d(()=>[g(l.$slots,"optionTable",{},void 0,!0)]),key:"6"}:void 0,l.$slots.optionFullscreen?{name:"optionFullscreen",fn:d(({toggleFullscreen:a,isFullscreen:o})=>[g(l.$slots,"optionFullscreen",A($({toggleFullscreen:a,isFullscreen:o})),void 0,!0)]),key:"7"}:void 0,l.$slots.optionAnnotator?{name:"optionAnnotator",fn:d(({toggleAnnotator:a,isAnnotator:o})=>[g(l.$slots,"optionAnnotator",A($({toggleAnnotator:a,isAnnotator:o})),void 0,!0)]),key:"8"}:void 0]),1032,["backgroundColor","color","isPrinting","isImaging","uid","hasTooltip","hasPdf","hasImg","hasSvg","hasXls","hasTable","hasFullscreen","isFullscreen","isTooltip","titles","chartElement","position","hasAnnotator","isAnnotation","callbacks","printScale","tableDialog","onGeneratePdf","onGenerateImage","style"])):k("",!0),(s(),c("svg",{ref_key:"svgRef",ref:he,xmlns:h(ct),class:ol({"vue-data-ui-fullscreen--on":R.value,"vue-data-ui-fulscreen--off":!R.value}),viewBox:"0 0 ".concat(N.value.width<=0?10:N.value.width," ").concat(N.value.height<=0?10:N.value.height),style:ue("max-width:100%;overflow:visible;background:transparent;color:".concat(e.value.style.chart.color))},[oe(h(xl)),C("defs",null,[(s(!0),c(_,null,D(n.value,(a,o)=>(s(),c("radialGradient",{cx:"50%",cy:"50%",r:"50%",fx:"50%",fy:"50%",id:"gradient_".concat(b.value,"_").concat(o)},[C("stop",{offset:"0%","stop-color":h(vt)(h(dt)(a.color,.05),100-e.value.style.chart.layout.rect.gradientIntensity)},null,8,Nt),C("stop",{offset:"100%","stop-color":a.color},null,8,Mt)],8,zt))),256))]),C("defs",null,[C("filter",{id:"blur_".concat(b.value),x:"-50%",y:"-50%",width:"200%",height:"200%"},[...t[4]||(t[4]=[C("feGaussianBlur",{in:"SourceGraphic",stdDeviation:2},null,-1),C("feColorMatrix",{type:"saturate",values:"0"},null,-1)])],8,Rt)]),e.value.useCustomCells&&n.value.length?(s(!0),c(_,{key:0},D(j.value,(a,o)=>(s(),c("foreignObject",{x:a.x,y:a.y,height:E.value<=0?1e-4:E.value,width:T.value<=0?1e-4:T.value,class:"vue-ui-waffle-custom-cell-foreignObject"},[g(l.$slots,"cell",$e({ref_for:!0},{cell:{...a,color:n.value[o].color,...n.value[o]},isSelected:[null,void 0].includes(U.value)?!0:n.value[o].serieIndex===U.value}),void 0,!0)],8,Gt))),256)):k("",!0),!n.value.length&&!e.value.useCustomCells?(s(),c("rect",{key:1,x:12,y:12,height:I.value.height-24,width:I.value.width-24,rx:3,fill:"none",stroke:"black"},null,8,Ut)):n.value.length&&!e.value.useCustomCells?(s(),c(_,{key:2},[l.$slots.pattern?(s(),c("g",Wt,[(s(!0),c(_,null,D(fe.value,a=>(s(),c("defs",null,[g(l.$slots,"pattern",$e({ref_for:!0},{seriesIndex:a.absoluteIndex,patternId:"pattern_".concat(b.value,"_").concat(a.absoluteIndex)}),void 0,!0)]))),256))])):k("",!0),(s(!0),c(_,null,D(j.value,(a,o)=>(s(),c("rect",{rx:e.value.style.chart.layout.rect.rounded?e.value.style.chart.layout.rect.rounding:0,x:a.x+e.value.style.chart.layout.grid.spaceBetween/2,y:a.y+e.value.style.chart.layout.grid.spaceBetween/2,height:E.value<=0?1e-4:E.value,width:T.value<=0?1e-4:T.value,fill:"white",stroke:e.value.style.chart.layout.rect.stroke,"stroke-width":e.value.style.chart.layout.rect.strokeWidth,filter:le(n.value[o].serieIndex)},null,8,jt))),256)),(s(!0),c(_,null,D(j.value,(a,o)=>(s(),c("rect",{rx:e.value.style.chart.layout.rect.rounded?e.value.style.chart.layout.rect.rounding:0,x:a.x+e.value.style.chart.layout.grid.spaceBetween/2,y:a.y+e.value.style.chart.layout.grid.spaceBetween/2,height:E.value<=0?1e-4:E.value,width:T.value<=0?1e-4:T.value,fill:e.value.style.chart.layout.rect.useGradient&&e.value.style.chart.layout.rect.gradientIntensity>0?"url(#gradient_".concat(b.value,"_").concat(o,")"):n.value[o].color,stroke:e.value.style.chart.layout.rect.stroke,"stroke-width":e.value.style.chart.layout.rect.strokeWidth,filter:le(n.value[o].serieIndex)},null,8,qt))),256)),l.$slots.pattern?(s(),c("g",Ht,[(s(!0),c(_,null,D(j.value,(a,o)=>(s(),c("rect",{rx:e.value.style.chart.layout.rect.rounded?e.value.style.chart.layout.rect.rounding:0,x:a.x+e.value.style.chart.layout.grid.spaceBetween/2,y:a.y+e.value.style.chart.layout.grid.spaceBetween/2,height:E.value<=0?1e-4:E.value,width:T.value<=0?1e-4:T.value,fill:"url(#pattern_".concat(b.value,"_").concat(n.value[o].absoluteIndex,")"),stroke:"none",filter:le(n.value[o].serieIndex)},null,8,Xt))),256))])):k("",!0)],64)):k("",!0),(s(!0),c(_,null,D(j.value,(a,o)=>(s(),c(_,null,[Gl(o,a)?(s(),c("text",{key:"datalabel_".concat(o),textContent:re(Ul(o,a)),x:a.x+e.value.style.chart.layout.labels.captions.offsetX+e.value.style.chart.layout.grid.spaceBetween/2+6,y:a.y+e.value.style.chart.layout.labels.captions.offsetY+e.value.style.chart.layout.grid.spaceBetween/2+He.value/2+e.value.style.chart.layout.labels.captions.fontSize/3,"font-size":e.value.style.chart.layout.labels.captions.fontSize,fill:h(ht)(n.value[o].color),filter:le(n.value[o].serieIndex)},null,8,Yt)):k("",!0)],64))),256)),(s(!0),c(_,null,D(j.value,(a,o)=>(s(),c("rect",{x:a.x+e.value.style.chart.layout.grid.spaceBetween/2,y:a.y+e.value.style.chart.layout.grid.spaceBetween/2,height:He.value,width:El.value,fill:"transparent",stroke:"none",onMouseover:u=>Ml(o),onMouseleave:u=>Nl(o),onClick:u=>zl(o)},null,40,Jt))),256)),g(l.$slots,"svg",{svg:N.value},void 0,!0)],14,Dt)),l.$slots.watermark?(s(),c("div",Kt,[g(l.$slots,"watermark",A($({isPrinting:h(Ge)||h(Ue)})),void 0,!0)])):k("",!0),C("div",{id:"legend-bottom-".concat(b.value)},null,8,Qt),Ve.value?(s(),V(lt,{key:5,to:e.value.style.chart.legend.position==="top"?"#legend-top-".concat(b.value):"#legend-bottom-".concat(b.value)},[C("div",{ref_key:"chartLegend",ref:Ee},[e.value.style.chart.legend.show?(s(),V(St,{key:"legend_".concat(Le.value),legendSet:M.value,config:Dl.value,onClickMarker:t[0]||(t[0]=({legend:a})=>ee(a.uid))},Ae({item:d(({legend:a})=>[C("div",{onClick:o=>a.segregate(),style:ue("opacity:".concat(y.value.includes(a.uid)?.5:1))},re(a.display),13,Zt)]),_:2},[l.$slots.pattern?{name:"legend-pattern",fn:d(({legend:a,index:o})=>[oe(Bt,{shape:a.shape,radius:30,stroke:"none",plot:{x:30,y:30},fill:"url(#pattern_".concat(b.value,"_").concat(o,")")},null,8,["shape","fill"])]),key:"0"}:void 0]),1032,["legendSet","config"])):g(l.$slots,"legend",{key:1,legend:M.value},void 0,!0)],512)],8,["to"])):k("",!0),l.$slots.source?(s(),c("div",{key:6,ref_key:"source",ref:Oe,dir:"auto"},[g(l.$slots,"source",{},void 0,!0)],512)):k("",!0),oe(h(yl),{show:w.value.showTooltip&&ne.value&&y.value.length<m.dataset.length,backgroundColor:e.value.style.chart.tooltip.backgroundColor,color:e.value.style.chart.tooltip.color,borderRadius:e.value.style.chart.tooltip.borderRadius,borderColor:e.value.style.chart.tooltip.borderColor,borderWidth:e.value.style.chart.tooltip.borderWidth,backgroundOpacity:e.value.style.chart.tooltip.backgroundOpacity,position:e.value.style.chart.tooltip.position,offsetY:e.value.style.chart.tooltip.offsetY,parent:F.value,content:ie.value,isCustom:e.value.style.chart.tooltip.customFormat&&typeof e.value.style.chart.tooltip.customFormat=="function",fontSize:e.value.style.chart.tooltip.fontSize,isFullscreen:R.value,smooth:e.value.style.chart.tooltip.smooth,backdropFilter:e.value.style.chart.tooltip.backdropFilter,smoothForce:e.value.style.chart.tooltip.smoothForce,smoothSnapThreshold:e.value.style.chart.tooltip.smoothSnapThreshold},{"tooltip-before":d(()=>[g(l.$slots,"tooltip-before",A($({...me.value})),void 0,!0)]),"tooltip-after":d(()=>[g(l.$slots,"tooltip-after",A($({...me.value})),void 0,!0)]),_:3},8,["show","backgroundColor","color","borderRadius","borderColor","borderWidth","backgroundOpacity","position","offsetY","parent","content","isCustom","fontSize","isFullscreen","smooth","backdropFilter","smoothForce","smoothSnapThreshold"]),se.value&&e.value.userOptions.buttons.table?(s(),V(tt(J.value.component),$e({key:7},J.value.props,{ref_key:"tableUnit",ref:q,onClose:ll}),Ae({content:d(()=>[(s(),V(h(ml),{key:"table_".concat(Se.value),colNames:te.value.colNames,head:te.value.head,body:te.value.body,config:te.value.config,title:e.value.table.useDialog?"":J.value.title,withCloseButton:!e.value.table.useDialog,onClose:ll},{th:d(({th:a})=>[C("div",{innerHTML:a,style:{display:"flex","align-items":"center"}},null,8,ea)]),td:d(({td:a})=>[ul(re(a.name||a),1)]),_:1},8,["colNames","head","body","config","title","withCloseButton"]))]),_:2},[e.value.table.useDialog?{name:"title",fn:d(()=>[ul(re(J.value.title),1)]),key:"0"}:void 0,e.value.table.useDialog?{name:"actions",fn:d(()=>[C("button",{tabindex:"0",class:"vue-ui-user-options-button",onClick:t[1]||(t[1]=a=>Ce(e.value.userOptions.callbacks.csv))},[oe(h(bl),{name:"excel",stroke:J.value.props.color},null,8,["stroke"])])]),key:"1"}:void 0]),1040)):k("",!0),h(De)?(s(),V($t,{key:8})):k("",!0)],46,Lt))}},ta=ot(la,[["__scopeId","data-v-da99ceb0"]]),Ca=Object.freeze(Object.defineProperty({__proto__:null,default:ta},Symbol.toStringTag,{value:"Module"}));export{ka as a,Ca as b,ta as v};
