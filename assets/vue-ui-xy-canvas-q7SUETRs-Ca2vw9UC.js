
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * https://fantastic-admin.hurui.me
 */
    
const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./Tooltip-D0pGX8qz-BS2YwyOE.js","./vue-data-ui-8Gmf-dDN.js","./index-CJB5jCfL.js","./index-D6D_bXIl.css","./alert-I_0TAljB.js","./vue-data-ui-C46fMXq5.css","./DataTable-BfEbVwm4-B-GxLkq-.js","./Shape-12_eh8zD-Cy1mu6XW.js","./UserOptions-Cy-iNhZU-CnpDVImt.js","./vClickOutside-C6WiFswA-B2BXHGcD.js","./img-CqYIrJ8I-E54QgU9o.js","./dom-to-png-WXGPkYro-BQsfl1t5.js","./NonSvgPenAndPaper-dUUA975O-DjkfuJ1Q.js","./ColorPicker-BYn8PF2Z-DkxHqz9_.js","./BaseDraggableDialog-BFDTrOH0-Bty23wRr.js"])))=>i.map(i=>d[i]);
import{e as d,J as b,ac as Na,E as Il,a8 as Va,K as _,aa as be,aw as Ol,av as qe,c1 as pe,c as Oe,o as I,A as W,f as K,z as Y,O as xe,u as C,c3 as El,h as x,r as z,j as ee,k as le,g as _l,t as Ze,bq as Ha,l as Tl,m as Xa,N as Ua,n as Wa,c4 as Ce}from"./index-CJB5jCfL.js";import{s as Ya,J as ja,x as qa,v as Za,o as ae,N as Le,$ as Ga,h as Ge,L as ie,F as ne,u as Rl,ag as Ja,S as Ka,at as Qa,E as et,A as lt,g as Bl,O as at,w as ke,b as tt,e as ot,f as rt,p as st}from"./vue-data-ui-8Gmf-dDN.js";import{k as ut,m as Je,S as it,E as nt,M as vt,L,O as Ee,A as j,I as Pl}from"./useResponsive-DfdjqQps-DzVAt69W.js";import{s as ct,i as _e}from"./useNestedProp-DaR1dBmj-yWXLkJlG.js";import{T as dt,j as ht}from"./BaseScanner-BMpwQAfz-mc47WWxo.js";import{m as yt}from"./usePrinter-ChVMpU2f-B27PF0nl.js";import{C as mt,_ as gt,L as ft}from"./useTimeLabels-DKoynYae-DbX6bBBl.js";import{i as bt}from"./useThemeCheck-DGJ31Vi5-GRZcYzX8.js";import{a as pt}from"./useUserOptionState-BIvW1Kz7-D70wY835.js";import{o as xt}from"./useChartAccessibility-9icAAmYg-CuAxjhEs.js";import Ct from"./img-CqYIrJ8I-E54QgU9o.js";import Lt from"./Legend-D2xmnFPH-CItLelVI.js";import kt from"./Title-D0nD-PMs-DAiwElB_.js";import At from"./vue-ui-accordion-DNRtKVZI-Cfsr7GT0.js";import{u as wt}from"./SlicerPreview-BF9QuD7E-Bsfug1YR.js";import"./alert-I_0TAljB.js";import"./dom-to-png-WXGPkYro-BQsfl1t5.js";import"./Shape-12_eh8zD-Cy1mu6XW.js";const Nl={style:{chart:{backgroundColor:"#1A1A1A",color:"#CCCCCC",zoom:{color:"#4A4A4A",highlightColor:"#9A9A9A",minimap:{selectedColor:"#8A8A8A",lineColor:"#424242",indicatorColor:"#CCCCCC"}},selector:{color:"#CCCCCC"},legend:{backgroundColor:"#1A1A1A",color:"#CCCCCC"},title:{color:"#CCCCCC",subtitle:{color:"#757575"}},tooltip:{backgroundColor:"#1A1A1A",backgroundOpacity:70,color:"#CCCCCC",borderColor:"#5A5A5A"},grid:{y:{axisColor:"#5A5A5A",axisLabels:{color:"#CCCCCC"},verticalLines:{color:"#4A4A4A"}},x:{axisColor:"#5A5A5A",horizontalLines:{color:"#4A4A4A"},timeLabels:{color:"#CCCCCC"}},zeroLine:{color:"#5A5A5A"}},dataLabels:{color:"#CCCCCC"}}},table:{th:{backgroundColor:"#1A1A1A",color:"#CCCCCC"},td:{backgroundColor:"#1A1A1A",color:"#CCCCCC"}}},Vl={style:{chart:{backgroundColor:"#FFF8E1",color:"#424242",zoom:{color:"#5D4037",highlightColor:"#FF8A65"},selector:{color:"#5D4037"},legend:{backgroundColor:"#FFF8E1",color:"#424242"},title:{color:"#424242",subtitle:{color:"#757575"}},tooltip:{backgroundColor:"#FFECB3",backgroundOpacity:30,color:"#424242",borderColor:"#FF8A65"},grid:{y:{axisColor:"#5D4037",axisLabels:{color:"#424242"},verticalLines:{show:!1}},x:{axisColor:"#5D4037",horizontalLines:{color:"#9A9A9A"},timeLabels:{color:"#424242"}},zeroLine:{color:"#424242"}},dataLabels:{color:"#424242"}}},table:{th:{backgroundColor:"#FFF8E1",color:"#424242"},td:{backgroundColor:"#FFF8E1",color:"#424242"}}},Hl={style:{chart:{backgroundColor:"#1E1E1E",color:"#BDBDBD",zoom:{color:"#5D4037",highlightColor:"#FF8A65"},selector:{color:"#BDBDBD"},legend:{backgroundColor:"#1E1E1E",color:"#BDBDBD"},title:{color:"#FFF8E1",subtitle:{color:"#BDBDBD"}},tooltip:{backgroundColor:"#1E1E1E",backgroundOpacity:30,color:"#FFF8E1",borderColor:"#FF8A65"},grid:{y:{axisColor:"#5D4037",axisLabels:{color:"#BDBDBD"},verticalLines:{show:!1}},x:{axisColor:"#5D4037",horizontalLines:{color:"#3A3A3A"},timeLabels:{color:"#BDBDBD"}},zeroLine:{color:"#5D4037"}},dataLabels:{color:"#BDBDBD"}}},table:{th:{backgroundColor:"#1E1E1E",color:"#BDBDBD"},td:{backgroundColor:"#1E1E1E",color:"#BDBDBD"}}},Xl={style:{chart:{backgroundColor:"#1A1A1A",color:"#99AA99",zoom:{color:"#5F6A5F",highlightColor:"#66CC66"},selector:{color:"#66CC66"},legend:{backgroundColor:"#1A1A1A",color:"#99AA99"},title:{color:"#66CC66",subtitle:{color:"#99AA99"}},tooltip:{backgroundColor:"#2A2F2A",color:"#AACCAA",borderColor:"#66CC66",borderRadius:0},grid:{y:{axisColor:"#5F6A5F",axisLabels:{color:"#99AA99"},verticalLines:{show:!1}},x:{axisColor:"#5F6A5F",horizontalLines:{color:"#3A3A3A"},timeLabels:{color:"#99AA99"}},zeroLine:{color:"#444444"}},dataLabels:{color:"#99AA99"}}},table:{th:{backgroundColor:"#1A1A1A",color:"#99AA99"},td:{backgroundColor:"#1A1A1A",color:"#AACCAA"}}},Ul={style:{chart:{backgroundColor:"#fbfafa",color:"#8A9892",zoom:{color:"#E0CFC3",highlightColor:"#8F837A"},selector:{color:"#8F837A"},legend:{backgroundColor:"#fbfafa",color:"#99AA99"},title:{color:"#8A9892",subtitle:{color:"#99AA99"}},tooltip:{backgroundColor:"#fbfafa",color:"#8A9892"},grid:{y:{axisColor:"#8F837A",axisLabels:{color:"#8F837A"},verticalLines:{show:!1}},x:{axisColor:"#8F837A",horizontalLines:{show:!1,alternate:!1},timeLabels:{color:"#8F837A"}},zeroLine:{color:"#444444"}},dataLabels:{color:"#8F837A"}}},table:{th:{backgroundColor:"#fbfafa",color:"#8F837A"},td:{backgroundColor:"#fbfafa",color:"#8F837A"}}},Wl={style:{chart:{backgroundColor:"#f6f6fb",color:"#50606C",zoom:{color:"#92B0AB",highlightColor:"#50606C"},selector:{color:"#7DA9B5"},legend:{backgroundColor:"#f6f6fb",color:"#61747E"},title:{color:"#50606C",subtitle:{color:"#718890"}},tooltip:{backgroundColor:"#f6f6fb",color:"#50606C"},grid:{y:{axisColor:"#829C98",axisLabels:{color:"#50606C"},verticalLines:{show:!1}},x:{axisColor:"#829C98",timeLabels:{color:"#50606C"}},zeroLine:{color:"#444444"}},dataLabels:{color:"#50606C"}}},table:{th:{backgroundColor:"#f6f6fb",color:"#50606C"},td:{backgroundColor:"#f6f6fb",color:"#50606C"}}},Yl={default:{},dark:Nl,celebration:Vl,celebrationNight:Hl,hack:Xl,zen:Ul,concrete:Wl},Kt=Object.freeze(Object.defineProperty({__proto__:null,celebration:Vl,celebrationNight:Hl,concrete:Wl,dark:Nl,default:Yl,hack:Xl,zen:Ul},Symbol.toStringTag,{value:"Module"})),zt=["id"],Ft=["id"],$t=["id"],St=["onClick"],Mt={key:4,class:"vue-data-ui-watermark"},Dt=["innerHTML"],It={__name:"vue-ui-xy-canvas",props:{dataset:{type:Array,default(){return[]}},config:{type:Object,default(){return{}}},selectedXIndex:{type:Number,default:void 0}},emits:["selectLegend","selectX"],setup(Ke,{expose:jl,emit:ql}){const Zl=pe(()=>Ce(()=>import("./Tooltip-D0pGX8qz-BS2YwyOE.js"),__vite__mapDeps([0,1,2,3,4,5]),import.meta.url)),Gl=pe(()=>Ce(()=>import("./DataTable-BfEbVwm4-B-GxLkq-.js"),__vite__mapDeps([6,2,3,7,1,4,5]),import.meta.url)),Jl=pe(()=>Ce(()=>import("./UserOptions-Cy-iNhZU-CnpDVImt.js"),__vite__mapDeps([8,2,3,9,1,4,5,10,11]),import.meta.url)),Kl=pe(()=>Ce(()=>import("./NonSvgPenAndPaper-dUUA975O-DjkfuJ1Q.js"),__vite__mapDeps([12,2,3,1,4,5,13,9]),import.meta.url)),Ql=pe(()=>Ce(()=>import("./BaseDraggableDialog-BFDTrOH0-Bty23wRr.js"),__vite__mapDeps([14,2,3,1,4,5]),import.meta.url)),{vue_ui_xy_canvas:ea}=ct(),{isThemeValid:la,warnInvalidTheme:aa}=bt(),f=Ke,Q=d(ja()),V=d(null),te=d(null),v=d(null),g=d(1),q=d(1),ve=d(!1),h=d(null),Ae=d(""),Qe=d(null),F=d([]),oe=d(1),B=d(!0),H=d(!0),we=d(null),el=d(0),ce=d(!1),ll=d(null),al=d(null),Z=d(null),tl=d(null),Te=d(0),Re=d(0),Be=d(0),P=d(null),ol=d(!1),de=d(null),Pe=d(null),he=d(!1),rl=d(!1),ze=d(!1),k=d(null),X=b(()=>Array.isArray(He.value)&&He.value.length>0),Ne=ql,ta=Na();Il(()=>{ta["chart-background"]&&console.warn("VueUiXyCanvas does not support the #chart-background slot.")});const l=d(Ue()),oa=b(()=>!!l.value.debug),{loading:Ve,FINAL_DATASET:He}=dt({...Va(f),FINAL_CONFIG:l,prepareConfig:Ue,skeletonDataset:[{name:"",series:[0,1,2,3,5,8,13,21,34,55,89,134],type:"line",smooth:!0,color:"#BABABA"},{name:"",series:[0,.5,1,1.5,2.5,4,6.5,10.5,17,27.5,44.5,67],type:"bar",color:"#AAAAAA"}],skeletonConfig:qa({defaultConfig:l.value,userConfig:{userOptions:{show:!1},table:{show:!1},style:{chart:{backgroundColor:"#99999930",grid:{x:{axisColor:"#6A6A6A",timeLabels:{show:!1},axisName:"",horizontalLines:{color:"#6A6A6A"}},y:{axisColor:"#6A6A6A",axisLabels:{show:!1},axisName:"",verticalLines:{color:"#6A6A6A"}},zeroLine:{color:"#6A6A6A"}},legend:{backgroundColor:"#99999930"},paddingProportions:{left:.05}}}}})}),{userOptionsVisible:Xe,setUserOptionsVisibility:sl,keepUserOptionState:ul}=pt({config:l.value}),{svgRef:A}=xt({config:l.value.style.chart.title});function ra(){sl(!0)}function sa(){sl(!1),Ne("selectX",{seriesIndex:null,datapoint:null}),h.value=null}function Ue(){const e=_e({userConfig:f.config,defaultConfig:ea});let a={};const t=e.theme;if(t)if(!la.value(e))aa(e),a=e;else{const s=_e({userConfig:Yl[t]||f.config,defaultConfig:e});a={..._e({userConfig:f.config,defaultConfig:s}),customPalette:e.customPalette.length?e.customPalette:Za[t]||ae}}else a=e;return f.config&&Le(f.config,"style.chart.scale.min")?a.style.chart.scale.min=f.config.style.chart.scale.min:a.style.chart.scale.min=null,f.config&&Le(f.config,"style.chart.scale.max")?a.style.chart.scale.max=f.config.style.chart.scale.max:a.style.chart.scale.max=null,f.config&&Le(f.config,"style.chart.zoom.startIndex")?a.style.chart.zoom.startIndex=f.config.style.chart.zoom.startIndex:a.style.chart.zoom.startIndex=null,f.config&&Le(f.config,"style.chart.zoom.endIndex")?a.style.chart.zoom.endIndex=f.config.style.chart.zoom.endIndex:a.style.chart.zoom.endIndex=null,f.config&&Le(f.config,"style.chart.grid.y.timeLabels")&&(console.warn("VueUiXyCanvas: you are using the deprecated config.style.chart.grid.y.timeLabels. It is recommended to move this configuration to config.style.chart.grid.x.timeLabels."),a.style.chart.grid.x.timeLabels=_e({defaultConfig:a.style.chart.grid.x.timeLabels,userConfig:f.config.style.chart.grid.y.timeLabels})),a}_(()=>f.config,e=>{Ve.value||(l.value=Ue()),Xe.value=!l.value.userOptions.showOnChartHover,kl(),Te.value+=1,Re.value+=1,Be.value+=1,c.value.showTable=l.value.table.show,c.value.showDataLabels=l.value.style.chart.dataLabels.show,c.value.stacked=l.value.style.chart.stacked,c.value.showTooltip=l.value.style.chart.tooltip.show},{deep:!0}),_(()=>f.dataset,async e=>{!Array.isArray(e)||e.length===0||(await be(),A.value&&!v.value&&(v.value=A.value.getContext("2d",{willReadFrequently:!0})),B.value=!0,H.value=!0,await me(),$e(),Te.value+=1,Re.value+=1,Be.value+=1)},{deep:!0});const il=d(l.value.style.chart.aspectRatio),{isPrinting:nl,isImaging:vl,generatePdf:cl,generateImage:dl}=yt({elementId:"xy_canvas_".concat(Q.value),fileName:l.value.style.chart.title.text||"vue-ui-xy-canvas",options:l.value.userOptions.print}),c=d({showTable:l.value.table.show,showDataLabels:l.value.style.chart.dataLabels.show,stacked:l.value.style.chart.stacked,showTooltip:l.value.style.chart.tooltip.show});function hl(e){ce.value=e,el.value+=1}const yl=b(()=>Ga(l.value.customPalette)),O=b(()=>M.value?Math.max(...M.value.filter((e,a)=>!F.value.includes(e.absoluteIndex)).map(e=>e.series.length)):0);function ua(e){k.value=e,G()}const o=b(()=>{const e=g.value-g.value*(l.value.style.chart.paddingProportions.left+l.value.style.chart.paddingProportions.right);return{canvasWidth:g.value,canvasHeight:q.value,left:g.value*l.value.style.chart.paddingProportions.left,top:q.value*l.value.style.chart.paddingProportions.top,right:g.value-g.value*l.value.style.chart.paddingProportions.right,bottom:q.value-q.value*l.value.style.chart.paddingProportions.bottom,width:e,height:q.value-q.value*(l.value.style.chart.paddingProportions.top+l.value.style.chart.paddingProportions.bottom),slot:e/(r.value.end-r.value.start)}});function ml(e,a){return e/a}function ia({hasAutoScale:e,series:a,min:t,max:s,scale:u,yOffset:i,individualHeight:n,stackIndex:y=null}){return a.map((D,p)=>{const E=u.min<0?Math.abs(u.min):0,U=ml(D+E,E+u.max);let T,ue;e&&(T=u.min,ue=ml(D-T,u.max-T));let R=0;return y===null?R=o.value.bottom-o.value.height*(e?ue:U):R=o.value.bottom-i-n*(e?ue:U),{x:o.value.left+o.value.slot*p+o.value.slot/2,y:R,value:D}})}const w=b(()=>{const e=l.value.style.chart.scale.min!==null?l.value.style.chart.scale.min:Math.min(...M.value.filter((n,y)=>!F.value.includes(n.absoluteIndex)).flatMap(n=>n.series.slice(r.value.start,r.value.end))),a=l.value.style.chart.scale.max!==null?l.value.style.chart.scale.max:Math.max(...M.value.filter((n,y)=>!F.value.includes(n.absoluteIndex)).flatMap(n=>n.series.slice(r.value.start,r.value.end))),t=Ge(e<0?e:0,a===e?e+1<0?0:e+1:a<0?0:a,l.value.style.chart.scale.ticks),s=t.min<0?Math.abs(t.min):0,u=o.value.bottom-o.value.height*(s/(t.max+s)),i=t.ticks.map(n=>({y:o.value.bottom-o.value.height*((n+s)/(t.max+s)),x:o.value.left-8,value:n}));return{absoluteMin:s,max:a,min:e,scale:t,yLabels:i,zero:u}}),na=b(()=>m.value.map(e=>{var a,t;return'\n            <div style="display:flex;flex-direction:row;gap:6px;align-items:center;">\n                <svg viewBox="0 0 10 10" height="12" width="12">\n                    <circle cx="5" cy="5" r="5" fill="'.concat(e.color,'"/>\n                </svg>\n                <span>').concat(e.name?e.name+": ":"","</span>\n                <span>").concat(ie(l.value.style.chart.dataLabels.formatter,(a=e.series[h.value])!=null?a:"-",ne({p:e.prefix||"",v:(t=e.series[h.value])!=null?t:"-",s:e.suffix||"",r:e.rounding||0}),{datapoint:e,seriesIndex:h.value}),"</span>\n            </div>\n        ")})),Fe=b(()=>l.value.style.chart.line.cutNullValues),M=b(()=>He.value.map((e,a)=>({...e,series:Ja({data:Ka(e.series,[],Fe.value),threshold:l.value.downsample.threshold}),absoluteIndex:a,color:Rl(e.color||yl.value[a]||ae[a]||ae[a%ae.length])}))),va=b(()=>{if(!l.value.style.chart.zoom.minimap.show)return[];const e=M.value.filter(u=>!F.value.includes(u.absoluteIndex)),a=Math.max(...e.map(u=>u.series.length)),t=[];for(let u=0;u<a;u+=1)t.push(e.map(i=>i.series[u]||0).reduce((i,n)=>(i||0)+(n||0),0));const s=Math.min(...t);return t.map(u=>u+(s<0?Math.abs(s):0))}),ca=b(()=>l.value.style.chart.zoom.minimap.show?M.value.map(e=>({...e,isVisible:!F.value.includes(e.absoluteIndex)})):[]);_(O,e=>{e&&me()});const m=b(()=>Qa(M.value.filter((e,a)=>!F.value.includes(e.absoluteIndex))).map((e,a)=>({...e,series:e.series.slice(r.value.start,r.value.end)})).map((e,a)=>{let t=[null,void 0].includes(e.scaleMin)?Math.min(...e.series)||0:e.scaleMin,s=[null,void 0].includes(e.scaleMax)?Math.max(...e.series)||1:e.scaleMax;t===s&&(t=t>=0?s-1:t,s=s>=0?s:t+1),e.series.filter(R=>![null,void 0].includes(R)).map(R=>(R-t)/(s-t));const u={valueMin:t,valueMax:s},i=e.scaleSteps||l.value.style.chart.scale.ticks;let n;e.autoScaling?n=Ge(u.valueMin,u.valueMax,i):n=Ge(u.valueMin<0?u.valueMin:0,u.valueMax<=0?0:u.valueMax,i);const y=c.value.stacked?o.value.height*(1-e.cumulatedStackRatio):0,D=c.value.stacked?o.value.height/l.value.style.chart.stackGap:0,p=c.value.stacked?o.value.height*e.stackRatio-D:o.value.height,E=n.min<0?Math.abs(n.min):0;let U;e.autoScaling&&c.value.stacked&&s<=0?U=o.value.bottom-y-p:U=o.value.bottom-y-p*(E/(n.max+E));const T=n.ticks.map((R,Pa)=>({y:o.value.bottom-y-p*(Pa/(n.ticks.length-1)),x:o.value.left-8,value:R})),ue=ia({hasAutoScale:c.value.stacked&&e.autoScaling,series:e.series,min:c.value.stacked?t:w.value.min,max:c.value.stacked?s:w.value.max,scale:c.value.stacked?n:w.value.scale,yOffset:y,individualHeight:p,stackIndex:c.value.stacked?a:null});return{...e,coordinatesLine:ue,min:t,max:s,localScale:n,localZero:U,localMin:E,localYLabels:T,yOffset:y,individualHeight:p}})),r=d({start:0,end:O.value}),$=d({start:0,end:O.value}),ye=d(null);function da(){return new Promise(e=>requestAnimationFrame(()=>requestAnimationFrame(()=>e())))}Ol(()=>{ye.value&&cancelAnimationFrame(ye.value)});async function me(){fl(),await be(),ye.value&&cancelAnimationFrame(ye.value),ye.value=requestAnimationFrame(async()=>{await da(),fl()})}const ha=b(()=>l.value.style.chart.zoom.preview.enable&&($.value.start!==r.value.start||$.value.end!==r.value.end));function gl(e,a){$.value[e]=a}async function fl(){if(!he.value){he.value=!0;try{const{startIndex:e,endIndex:a}=l.value.style.chart.zoom,t=Math.max(...M.value.map(i=>i.series.length)),s=e!=null?e:0,u=a!=null?Math.min(bl(a+1),t):t;ze.value=!0,r.value.start=s,r.value.end=u,$.value.start=s,$.value.end=u,We(),rl.value=!0,await be(),Z.value&&(Z.value.setStartValue(r.value.start),Z.value.setEndValue(r.value.end))}finally{queueMicrotask(()=>{ze.value=!1}),he.value=!1}}}function ya(e){he.value||ze.value||e!==r.value.start&&(r.value.start=e,$.value.start=e,We())}function ma(e){if(he.value||ze.value)return;const a=bl(e);a!==r.value.end&&(r.value.end=a,$.value.end=a,We())}function bl(e){const a=O.value;return e>a?a:e<0||e<r.value.start?l.value.style.chart.zoom.startIndex!==null?l.value.style.chart.zoom.startIndex+1:1:e}function We(){var s,u;const e=Math.max(1,Math.max(...M.value.map(i=>i.series.length)));let a=Math.max(0,Math.min((s=r.value.start)!=null?s:0,e-1)),t=Math.max(a+1,Math.min((u=r.value.end)!=null?u:e,e));(!Number.isFinite(a)||!Number.isFinite(t)||t<=a)&&(a=0,t=e),r.value={start:a,end:t},$.value.start=a,$.value.end=t,Z.value&&(Z.value.setStartValue(a),Z.value.setEndValue(t))}const ga=b(()=>m.value.filter(e=>["line","plot",void 0].includes(e.type))),S=b(()=>m.value.filter(e=>e.type==="bar"));function $e(){var t;if(!A.value||!te.value)return;const e=te.value.offsetWidth,a=te.value.offsetHeight;A.value.width=e*oe.value*2,A.value.height=a*oe.value*2,g.value=e*oe.value*2,q.value=a*oe.value*2,(t=v.value)==null||t.scale(oe.value,oe.value),G()}_(X,async e=>{if(!e){we.value=null,ve.value=!1,h.value=null,P.value=null;return}await be(),A.value&&!v.value&&(v.value=A.value.getContext("2d",{willReadFrequently:!0})),B.value=!0,H.value=!0,await me(),$e(),G()});function fa(){if(v.value&&(v.value.clearRect(0,0,1e4,1e4),v.value.fillStyle=l.value.style.chart.backgroundColor,v.value.fillRect(0,0,o.value.canvasWidth,o.value.canvasHeight),!!X.value)){if(c.value.stacked)l.value.style.chart.grid.y.verticalLines.show&&r.value.end-r.value.start<l.value.style.chart.grid.y.verticalLines.hideUnderXLength?m.value.forEach(e=>{for(let a=0;a<r.value.end-r.value.start+1;a+=1)L(v.value,[{x:o.value.left+o.value.slot*a,y:o.value.bottom-e.yOffset-e.individualHeight},{x:o.value.left+o.value.slot*a,y:o.value.bottom-e.yOffset}],{color:l.value.style.chart.grid.y.verticalLines.color})}):l.value.style.chart.grid.y.verticalLines.show&&r.value.end-r.value.start>=l.value.style.chart.grid.y.verticalLines.hideUnderXLength&&m.value.forEach(e=>{for(let a=r.value.start;a<r.value.end;a+=1)a%Math.floor((r.value.end-r.value.start)/l.value.style.chart.grid.x.timeLabels.modulo)===0&&L(v.value,[{x:o.value.left+o.value.slot*(a-r.value.start)+o.value.slot/2,y:o.value.bottom-e.yOffset-e.individualHeight},{x:o.value.left+o.value.slot*(a-r.value.start)+o.value.slot/2,y:o.value.bottom-e.yOffset}],{color:l.value.style.chart.grid.y.verticalLines.color})}),l.value.style.chart.grid.x.horizontalLines.show&&(l.value.style.chart.grid.x.horizontalLines.alternate?m.value.forEach(e=>{e.localYLabels.forEach((a,t)=>{t<e.localYLabels.length-1&&Ee(v.value,[{x:o.value.left,y:a.y},{x:o.value.right,y:a.y},{x:o.value.right,y:e.localYLabels[t+1].y},{x:o.value.left,y:e.localYLabels[t+1].y}],{fillColor:t%2===0?"transparent":ke(l.value.style.chart.grid.x.horizontalLines.color,l.value.style.chart.grid.x.horizontalLines.opacity),strokeColor:"transparent"})})}):m.value.forEach(e=>{e.localYLabels.slice(r.value.start,r.value.end).forEach(a=>{L(v.value,[{x:o.value.left,y:a.y},{x:o.value.right,y:a.y}],{color:l.value.style.chart.grid.x.horizontalLines.color})})})),l.value.style.chart.grid.zeroLine.show&&m.value.forEach(e=>{L(v.value,[{x:o.value.left,y:e.localZero},{x:o.value.right,y:e.localZero}],{color:l.value.style.chart.grid.zeroLine.color,lineDash:l.value.style.chart.grid.zeroLine.dashed?[10,10]:[0,0]})}),l.value.style.chart.grid.y.axisLabels.show&&m.value.forEach(e=>{L(v.value,[{x:o.value.left,y:o.value.bottom-e.yOffset},{x:o.value.left,y:o.value.bottom-e.yOffset-e.individualHeight}],{color:e.color}),L(v.value,[{x:o.value.right,y:o.value.bottom-e.yOffset},{x:o.value.right,y:o.value.bottom-e.yOffset-e.individualHeight}],{color:e.color})}),m.value.forEach(e=>{j(v.value,e.name,g.value/35,o.value.bottom-e.yOffset-e.individualHeight/2,{align:"center",rotation:-90,color:e.color,font:"".concat(Math.round(g.value/40*l.value.style.chart.grid.y.axisLabels.fontSizeRatio),"px ").concat(l.value.style.fontFamily)})});else{if(l.value.style.chart.grid.y.verticalLines.show&&r.value.end-r.value.start<l.value.style.chart.grid.y.verticalLines.hideUnderXLength)for(let e=0;e<r.value.end-r.value.start+1;e+=1)L(v.value,[{x:o.value.left+o.value.slot*e,y:o.value.top},{x:o.value.left+o.value.slot*e,y:o.value.bottom}],{color:l.value.style.chart.grid.y.verticalLines.color});else if(l.value.style.chart.grid.y.verticalLines.show&&r.value.end-r.value.start>=l.value.style.chart.grid.y.verticalLines.hideUnderXLength)for(let e=r.value.start;e<r.value.end;e+=1)e%Math.floor((r.value.end-r.value.start)/l.value.style.chart.grid.x.timeLabels.modulo)===0&&L(v.value,[{x:o.value.left+o.value.slot*(e-r.value.start)+o.value.slot/2,y:o.value.top},{x:o.value.left+o.value.slot*(e-r.value.start)+o.value.slot/2,y:o.value.bottom}],{color:l.value.style.chart.grid.y.verticalLines.color});l.value.style.chart.grid.x.horizontalLines.show&&(l.value.style.chart.grid.x.horizontalLines.alternate?w.value.yLabels.forEach((e,a)=>{a<w.value.yLabels.length-1&&Ee(v.value,[{x:o.value.left,y:e.y},{x:o.value.right,y:e.y},{x:o.value.right,y:w.value.yLabels[a+1].y},{x:o.value.left,y:w.value.yLabels[a+1].y}],{fillColor:a%2===0?"transparent":ke(l.value.style.chart.grid.x.horizontalLines.color,l.value.style.chart.grid.x.horizontalLines.opacity),strokeColor:"transparent"})}):w.value.yLabels.forEach(e=>{L(v.value,[{x:o.value.left,y:e.y},{x:o.value.right,y:e.y}],{color:l.value.style.chart.grid.x.horizontalLines.color})})),l.value.style.chart.grid.y.showAxis&&L(v.value,[{x:o.value.left,y:o.value.top},{x:o.value.left,y:o.value.bottom}],{color:l.value.style.chart.grid.y.axisColor,lineWidth:l.value.style.chart.grid.y.axisThickness}),l.value.style.chart.grid.x.showAxis&&L(v.value,[{x:o.value.left,y:o.value.bottom},{x:o.value.right,y:o.value.bottom}],{color:l.value.style.chart.grid.x.axisColor,lineWidth:l.value.style.chart.grid.x.axisThickness}),l.value.style.chart.grid.zeroLine.show&&L(v.value,[{x:o.value.left,y:w.value.zero},{x:o.value.right,y:w.value.zero}],{color:l.value.style.chart.grid.zeroLine.color,lineDash:l.value.style.chart.grid.zeroLine.dashed?[10,10]:[0,0]})}l.value.style.chart.grid.y.axisName&&j(v.value,l.value.style.chart.grid.y.axisName,g.value-g.value/40*l.value.style.chart.grid.y.axisLabels.fontSizeRatio*1.2,o.value.bottom-o.value.height/2,{font:"".concat(l.value.style.chart.grid.y.axisLabels.bold?"bold ":"").concat(Math.round(g.value/40*l.value.style.chart.grid.y.axisLabels.fontSizeRatio),"px ").concat(l.value.style.fontFamily),color:l.value.style.chart.color,align:"center",rotation:90}),l.value.style.chart.grid.x.axisName&&j(v.value,l.value.style.chart.grid.x.axisName,g.value/2,q.value,{font:"".concat(l.value.style.chart.grid.y.axisLabels.bold?"bold ":"").concat(Math.round(g.value/40*l.value.style.chart.grid.y.axisLabels.fontSizeRatio),"px ").concat(l.value.style.fontFamily),color:l.value.style.chart.color,align:"center"})}}function ba(e){for(let a=0;a<e.coordinatesLine.length;a+=1){const t=(h.value===a||k.value===a?g.value/150:l.value.style.chart.line.plots.show||e.type==="plot"?g.value/200:0)*l.value.style.chart.line.plots.radiusRatio;Je(v.value,{x:e.coordinatesLine[a].x,y:e.coordinatesLine[a].y},t,{color:l.value.style.chart.backgroundColor,fillStyle:e.color})}}function pa(){m.value.forEach(e=>{e.showYMarker&&ge(e)&&j(v.value,ie(l.value.style.chart.dataLabels.formatter,ge(e).value,ne({p:e.prefix||l.value.style.chart.grid.y.axisLabels.prefix||"",v:ge(e).value,s:e.suffix||l.value.style.chart.grid.y.axisLabels.suffix||"",r:e.rounding||l.value.style.chart.grid.y.axisLabels.rounding||0}),{datapoint:ge(e),seriesIndex:null}),o.value.left-8+l.value.style.chart.grid.y.axisLabels.offsetX,ge(e).y,{align:"right",font:"".concat(l.value.style.chart.grid.y.axisLabels.bold?"bold ":"").concat(Math.round(g.value/40*l.value.style.chart.grid.y.axisLabels.fontSizeRatio),"px ").concat(l.value.style.fontFamily),color:e.color})})}function xa(){l.value.style.chart.grid.y.axisLabels.show&&(c.value.stacked?m.value.forEach(e=>{e.localYLabels.forEach((a,t)=>{var s;j(v.value,ie(l.value.style.chart.dataLabels.formatter,a.value,ne({p:e.prefix||l.value.style.chart.grid.y.axisLabels.prefix||"",v:a.value,s:e.suffix||l.value.style.chart.grid.y.axisLabels.suffix||"",r:e.rounding||l.value.style.chart.grid.y.axisLabels.rounding||0}),{datapoint:a,seriesIndex:t}),a.x+l.value.style.chart.grid.y.axisLabels.offsetX,a.y,{align:"right",font:"".concat(l.value.style.chart.grid.y.axisLabels.bold?"bold ":"").concat(Math.round(g.value/40*l.value.style.chart.grid.y.axisLabels.fontSizeRatio),"px ").concat(l.value.style.fontFamily),color:e.color,globalAlpha:e.showYMarker&&![null,void 0].includes((s=h.value)!=null?s:k.value)?.2:1})})}):w.value.yLabels.forEach((e,a)=>{var t;j(v.value,ie(l.value.style.chart.dataLabels.formatter,e.value,ne({p:l.value.style.chart.grid.y.axisLabels.prefix||"",v:e.value,s:l.value.style.chart.grid.y.axisLabels.suffix||"",r:l.value.style.chart.grid.y.axisLabels.rounding||0}),{datapoint:e,seriesIndex:a}),e.x+l.value.style.chart.grid.y.axisLabels.offsetX,e.y,{align:"right",font:"".concat(l.value.style.chart.grid.y.axisLabels.bold?"bold ":"").concat(Math.round(g.value/40*l.value.style.chart.grid.y.axisLabels.fontSizeRatio),"px ").concat(l.value.style.fontFamily),color:l.value.style.chart.grid.y.axisLabels.color,globalAlpha:m.value.some(s=>s.showYMarker)&&![null,void 0].includes((t=h.value)!=null?t:k.value)?.2:1})}))}function Ca(e){for(let a=0;a<e.coordinatesLine.length;a+=1)j(v.value,ie(l.value.style.chart.dataLabels.formatter,e.coordinatesLine[a].value,ne({p:e.prefix||"",v:e.coordinatesLine[a].value,s:e.suffix||"",r:e.rounding||0}),{datapoint:e.coordinatesLine[a],seriesIndex:a}),e.coordinatesLine[a].x,e.coordinatesLine[a].y+l.value.style.chart.dataLabels.offsetY,{align:"center",font:"".concat(l.value.style.chart.dataLabels.bold?"bold ":"").concat(Math.round(g.value/40*l.value.style.chart.dataLabels.fontSizeRatio),"px ").concat(l.value.style.fontFamily),color:l.value.style.chart.dataLabels.useSerieColor?e.color:l.value.style.chart.dataLabels.color,strokeColor:l.value.style.chart.backgroundColor,lineWidth:.5})}const N=b(()=>mt({values:l.value.style.chart.grid.x.timeLabels.values,maxDatapoints:O.value,formatter:l.value.style.chart.grid.x.timeLabels.datetimeFormatter,start:0,end:O.value})),pl=b(()=>{const e=l.value.style.chart.grid.x.timeLabels.datetimeFormatter,a=gt({useUTC:e.useUTC,locale:ft[e.locale]||{months:[],shortMonths:[],days:[],shortDays:[]},januaryAsYear:e.januaryAsYear});return(t,s)=>{var i;const u=(i=l.value.style.chart.grid.x.timeLabels.values)==null?void 0:i[t];return u==null?"":a.formatDate(new Date(u),s)}}),xl=b(()=>(l.value.style.chart.grid.x.timeLabels.values||[]).map((e,a)=>({text:pl.value(a,l.value.style.chart.zoom.timeFormat),absoluteIndex:a}))),La=b(()=>(l.value.style.chart.grid.x.timeLabels.values||[]).map((e,a)=>({text:pl.value(a,l.value.style.chart.tooltip.timeFormat),absoluteIndex:a})));function ka(){for(let e=r.value.start;e<r.value.end;e+=1)(r.value.end-r.value.start<l.value.style.chart.grid.x.timeLabels.modulo||r.value.end-r.value.start>=l.value.style.chart.grid.x.timeLabels.modulo&&(e%Math.floor((r.value.end-r.value.start)/l.value.style.chart.grid.x.timeLabels.modulo)===0||(e===h.value+r.value.start||e===k.value)&&l.value.style.chart.grid.x.timeLabels.showMarker))&&j(v.value,N.value[e]?N.value[e].text:e+1,o.value.left+o.value.slot*(e-r.value.start)+o.value.slot/2,o.value.bottom+g.value/l.value.style.chart.grid.x.timeLabels.offsetY,{align:l.value.style.chart.grid.x.timeLabels.rotation===0?"center":l.value.style.chart.grid.x.timeLabels.rotation>0?"left":"right",font:"".concat(l.value.style.chart.grid.x.timeLabels.bold?"bold ":"").concat(Math.round(g.value/40*l.value.style.chart.grid.x.timeLabels.fontSizeRatio),"px ").concat(l.value.style.fontFamily),color:l.value.style.chart.grid.x.timeLabels.showMarker?ke(l.value.style.chart.grid.x.timeLabels.color,h.value!==null||k.value!==null?h.value+r.value.start===e||k.value===e?100:20:100):l.value.style.chart.grid.x.timeLabels.color,rotation:l.value.style.chart.grid.x.timeLabels.rotation})}function Cl(){var e,a;L(v.value,[{x:o.value.left+o.value.slot*((e=h.value)!=null?e:k.value)+o.value.slot/2,y:o.value.top},{x:o.value.left+o.value.slot*((a=h.value)!=null?a:k.value)+o.value.slot/2,y:o.value.bottom}],{color:l.value.style.chart.selector.color,lineDash:l.value.style.chart.selector.dashed?[8,8]:[0,0],lineWidth:2})}function Aa(){P.value&&L(v.value,[{x:o.value.left,y:P.value},{x:o.value.right,y:P.value}],{color:l.value.style.chart.selector.color,lineDash:l.value.style.chart.selector.dashed?[8,8]:[0,0],lineWidth:2})}function wa(){S.value.forEach((e,a)=>{for(let t=0;t<e.coordinatesLine.length;t+=1)Ee(v.value,[{x:o.value.left+o.value.slot*t+o.value.slot/10+(c.value.stacked?0:o.value.slot/S.value.length*a-(a===0?0:o.value.slot/(5*S.value.length)*a)),y:c.value.stacked?e.localZero:w.value.zero},{x:o.value.left+o.value.slot*t+o.value.slot/10+(c.value.stacked?0:o.value.slot/S.value.length*a-(a===0?0:o.value.slot/(5*S.value.length)*a))+o.value.slot*.8/(c.value.stacked?1:S.value.length),y:c.value.stacked?e.localZero:w.value.zero},{x:o.value.left+o.value.slot*t+o.value.slot/10+(c.value.stacked?0:o.value.slot/S.value.length*a-(a===0?0:o.value.slot/(5*S.value.length)*a))+o.value.slot*.8/(c.value.stacked?1:S.value.length),y:e.coordinatesLine[t].y},{x:o.value.left+o.value.slot*t+o.value.slot/10+(c.value.stacked?0:o.value.slot/S.value.length*a-(a===0?0:o.value.slot/(5*S.value.length)*a)),y:e.coordinatesLine[t].y}],{strokeColor:l.value.style.chart.backgroundColor,gradient:{type:"linear",start:{x:e.coordinatesLine[t].x,y:e.coordinatesLine[t].y},end:{x:e.coordinatesLine[t].x,y:c.value.stacked?e.localZero:w.value.zero},stops:[{offset:0,color:e.color},{offset:1,color:l.value.style.chart.bar.gradient.show?tt(e.color,.5):e.color}]}}),c.value.showDataLabels&&[!0,void 0].includes(e.dataLabels)&&j(v.value,ie(l.value.style.chart.dataLabels.formatter,e.coordinatesLine[t].value,ne({p:e.prefix||"",v:e.coordinatesLine[t].value,s:e.suffix||"",r:e.rounding||0}),{datapoint:e.coordinatesLine[t],seriesIndex:t}),o.value.left+o.value.slot*t+o.value.slot/10+(c.value.stacked?0:o.value.slot/S.value.length*a-(a===0?0:o.value.slot/(5*S.value.length)*a))+o.value.slot*.4/(c.value.stacked?1:S.value.length),(e.coordinatesLine[t].value<0?c.value.stacked?e.localZero:w.value.zero:e.coordinatesLine[t].y)+l.value.style.chart.dataLabels.offsetY,{align:"center",font:"".concat(Math.round(g.value/40*l.value.style.chart.dataLabels.fontSizeRatio),"px ").concat(l.value.style.fontFamily),color:l.value.style.chart.dataLabels.useSerieColor?e.color:l.value.style.chart.dataLabels.color,strokeColor:l.value.style.chart.backgroundColor,lineWidth:.8})})}function za(e,a){const t=e.coordinatesLine.map((n,y)=>e.series[y]!=null&&Number.isFinite(n==null?void 0:n.y)?n:null),s=[],u=[];let i=[];for(let n=0;n<t.length;n+=1){const y=t[n];if(y)i.push(y);else{if(i.length>=2){const D=i[0],p=i[i.length-1];s.push([{x:D.x,y:a},...i,{x:p.x,y:a}])}else i.length===1&&u.push(i[0]);i=[]}}if(i.length>=2){const n=i[0],y=i[i.length-1];s.push([{x:n.x,y:a},...i,{x:y.x,y:a}])}else i.length===1&&u.push(i[0]);return{polygons:s,singles:u}}function Fa(e){const a=e.coordinatesLine.map((u,i)=>e.series[i]!=null&&Number.isFinite(u==null?void 0:u.y)?u:null),t=[];let s=[];for(let u=0;u<a.length;u+=1){const i=a[u];i?s.push(i):(s.length>=2&&t.push(s),s=[])}return s.length>=2&&t.push(s),t}function Ll(e){if(Fe.value){const a=Fa(e);for(const t of a)L(v.value,t,{color:e.color,lineWidth:3})}else L(v.value,e.coordinatesLine,{color:e.color,lineWidth:3})}function $a(e){const a=!!Fe.value;if(e.useArea){const t=c.value.stacked?e.localZero:w.value.zero;if(a){const{polygons:s,singles:u}=za(e,t);for(const n of s)Pl(v.value,n,{fillColor:ke(e.color,l.value.style.chart.area.opacity),strokeColor:"transparent"});const i=g.value/200*l.value.style.chart.line.plots.radiusRatio;for(const n of u)Je(v.value,{x:n.x,y:n.y},i,{color:l.value.style.chart.backgroundColor,fillStyle:e.color})}else{const s={x:e.coordinatesLine[0].x,y:t},u={x:e.coordinatesLine.at(-1).x,y:t};Pl(v.value,[s,...e.coordinatesLine,u],{fillColor:ke(e.color,l.value.style.chart.area.opacity),strokeColor:"transparent"})}Ll(e);return}Ll(e)}function Sa(){m.value.forEach((e,a)=>{L(v.value,[{x:o.value.left,y:o.value.bottom-e.yOffset},{x:o.value.right,y:o.value.bottom-e.yOffset}],{color:l.value.style.chart.grid.x.horizontalLines.color,lineWidth:1})})}function Ma(){const{left:e,top:a,width:t,height:s}=o.value,u=r.value.start,i=r.value.end-u,n=t/i,y=$.value.start-u,D=$.value.end-u,p=Math.max(0,Math.min(i,y)),E=Math.max(0,Math.min(i,D));Ee(v.value,[{x:e+p*n,y:a},{x:e+p*n+(E-p)*n,y:a},{x:e+p*n+(E-p)*n,y:a+s},{x:e+p*n,y:a+s}],{fillColor:l.value.style.chart.zoom.preview.fill,strokeColor:l.value.style.chart.zoom.preview.stroke,lineDash:Array(4).fill(l.value.style.chart.zoom.preview.strokeDasharray),lineWidth:l.value.style.chart.zoom.preview.strokeWidth})}function G(){!X.value||!A.value||!v.value||(fa(),B.value?((h.value!==null||k.value!==null)&&l.value.style.chart.selector.show&&Cl(),wa(),c.value.stacked&&l.value.style.chart.grid.x.showAxis&&Sa(),ga.value.forEach(e=>{(e.type==="line"||!e.type)&&$a(e),H.value&&(ba(e),c.value.showDataLabels&&[!0,void 0].includes(e.dataLabels)&&Ca(e))}),A.value&&(we.value=ut(A.value))):(we.value&&(v.value.clearRect(0,0,1e4,1e4),v.value.drawImage(we.value,0,0)),(h.value!==null||k.value!==null)&&l.value.style.chart.selector.show&&Cl(),(h.value!==null||k.value!==null)&&m.value.forEach(e=>{var s;const a=(s=h.value)!=null?s:k.value,t=e.coordinatesLine[a];(e.type==="line"||!e.type||e.type==="plot")&&t&&Number.isFinite(t.x)&&Number.isFinite(t.y)&&Je(v.value,{x:t.x,y:t.y},g.value/150*l.value.style.chart.line.plots.radiusRatio,{color:l.value.style.chart.backgroundColor,fillStyle:e.color})})),l.value.style.chart.grid.x.timeLabels.show&&ka(),l.value.style.chart.selector.show&&l.value.style.chart.selector.showHorizontalSelector&&Aa(),xa(),pa(),l.value.style.chart.zoom.preview.enable&&(r.value.start!==$.value.start||r.value.end!==$.value.end)&&Ma(),B.value=!1)}const Se=it(()=>{H.value=!0,$e()},O.value>200?10:1,!H.value);function ge(e){var s,u,i;if([null,void 0].includes((s=h.value)!=null?s:k.value)||!e.coordinatesLine[(u=h.value)!=null?u:k.value])return!1;const{y:a,value:t}=e.coordinatesLine[(i=h.value)!=null?i:k.value];return{y:a,value:t}}function Da(e){var D,p,E,U;if(!X.value||!A.value)return;const{left:a,top:t}=A.value.getBoundingClientRect(),s=e.clientX-a;if(P.value=(e.clientY-t)*2,(P.value<o.value.top||P.value>o.value.bottom)&&(P.value=null),s*2<o.value.left||s*2>o.value.right){ve.value=!1,h.value=null;return}const u=s*2-o.value.left;if(h.value=Math.floor(u/o.value.slot),ve.value=!0,!H.value)return;let i="";const n=l.value.style.chart.tooltip.customFormat,y=m.value.map(T=>({shape:T.shape||null,name:T.name,color:T.color,type:T.type||"line",value:T.series.find((ue,R)=>R===h.value)}));Ia({seriesIndex:h.value,datapoint:y}),Bl(n)&&st(()=>n({seriesIndex:h.value,datapoint:y,series:m.value,config:l.value}))?Ae.value=n({seriesIndex:h.value,datapoint:y,series:m.value,config:l.value}):(l.value.style.chart.grid.x.timeLabels.values.slice(r.value.start,r.value.end)[h.value]?i+='<div style="padding-bottom: 6px; margin-bottom: 4px; border-bottom: 1px solid '.concat(l.value.style.chart.tooltip.borderColor,'; width:100%">').concat(l.value.style.chart.tooltip.useDefaultTimeFormat?(D=N.value.slice(r.value.start,r.value.end)[h.value])==null?void 0:D.text:(p=La.value[h.value])==null?void 0:p.text,"</div>"):i+='<div style="padding-bottom: 6px; margin-bottom: 4px; border-bottom: 1px solid '.concat(l.value.style.chart.tooltip.borderColor,'; width:100%">').concat((U=(E=N.value[h.value+r.value.start])==null?void 0:E.text)!=null?U:"","</div>"),i+=na.value.join(""),Ae.value=i),H.value=!1}function Ia({seriesIndex:e,datapoint:a}){const t=r.value.start+e;Ne("selectX",{dataset:a,index:t,indexLabel:""})}_(()=>f.selectedXIndex,e=>{if([null,void 0].includes(f.selectedXIndex)){h.value=null;return}const a=e-r.value.start;a<0||e>=r.value.end?h.value=null:h.value=a!=null?a:null},{immediate:!0}),_(()=>h.value,e=>{Se()}),_(()=>r.value,e=>{B.value=!0,G()},{deep:!0}),_(()=>$.value,e=>{G()},{deep:!0}),_(()=>c.value.showDataLabels,e=>{B.value=!0,G()}),_(()=>P.value,e=>{e&&G()}),_(()=>c.value.stacked,e=>{B.value=!0,H.value=!0,Se()});function Oa(){ve.value=!1,h.value=null,Ae.value="",P.value=null,G()}const J=qe(null),re=qe(null),se=qe(null);Il(()=>{ol.value=!0,kl()});function kl(){if(et(f.dataset)&&oa.value&&lt({componentName:"VueUiXyCanvas",type:"dataset"}),be(()=>{A.value&&!v.value&&(v.value=A.value.getContext("2d",{willReadFrequently:!0})),v.value&&X.value&&(B.value=!0,H.value=!0,$e())}),l.value.responsive){const e=nt(()=>{var s;const{width:a,height:t}=vt({chart:V.value,title:l.value.style.chart.title.text?ll.value:null,legend:l.value.style.chart.legend.show?al.value:null,slicer:l.value.style.chart.zoom.show&&O.value>6?(s=Z.value)==null?void 0:s.$el:null,source:tl.value});requestAnimationFrame(()=>{il.value="".concat(a," / ").concat(t)})});J.value&&(re.value&&J.value.unobserve(re.value),J.value.disconnect()),J.value=new ResizeObserver(e),re.value=V.value.parentNode,J.value.observe(re.value)}se.value&&se.value.disconnect(),se.value=new ResizeObserver(e=>{for(const a of e)a.contentBoxSize&&te.value&&(B.value=!0,Se())}),se.value.observe(te.value),me()}Ol(()=>{se.value&&se.value.disconnect(),J.value&&(re.value&&J.value.unobserve(re.value),J.value.disconnect())});function Me(e){Ne("selectLegend",m.value.find(a=>a.absoluteIndex===e)),F.value.includes(e)?F.value=F.value.filter(a=>a!==e):F.value.push(e),B.value=!0,Se()}function Al(e){return M.value.length?M.value.find(t=>t.name===e)||(l.value.debug&&console.warn('VueUiXyCanvas - Series name not found "'.concat(e,'"')),null):(l.value.debug&&console.warn("VueUiXyCanvas - There are no series to show."),null)}function Ea(e){const a=Al(e);a!==null&&F.value.includes(a.absoluteIndex)&&Me(a.absoluteIndex)}function _a(e){const a=Al(e);a!==null&&(F.value.includes(a.absoluteIndex)||Me(a.absoluteIndex))}const wl=b(()=>M.value.map((e,a)=>({...e,name:e.name,color:Rl(e.color)||yl.value[a]||ae[a]||ae[a%ae.length],shape:e.shape||"circle",prefix:e.prefix||"",suffix:e.suffix||"",rounding:e.rounding||0})).map(e=>({...e,opacity:F.value.includes(e.absoluteIndex)?.5:1,segregate:()=>Me(e.absoluteIndex),isSegregated:F.value.includes(e.absoluteIndex)}))),Ta=b(()=>({cy:"donut-div-legend",backgroundColor:l.value.style.chart.legend.backgroundColor,color:l.value.style.chart.legend.color,fontSize:l.value.style.chart.legend.fontSize,paddingBottom:12,fontWeight:l.value.style.chart.legend.bold?"bold":""})),De=b(()=>{const e=[""].concat(m.value.map(u=>u.name)).concat(' <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M18 16v2a1 1 0 0 1 -1 1h-11l6 -7l-6 -7h11a1 1 0 0 1 1 1v2" /></svg>');let a=[];for(let u=0;u<O.value;u+=1){const i=m.value.map(n=>{var y;return(y=n.series[u])!=null?y:0}).reduce((n,y)=>n+y,0);a.push([l.value.style.chart.grid.x.timeLabels.values.slice(r.value.start,r.value.end)[u]?N.value.slice(r.value.start,r.value.end)[u].text:u+1].concat(m.value.map(n=>{var y;return((y=n.series[u])!=null?y:0).toFixed(l.value.table.rounding)})).concat((i!=null?i:0).toFixed(l.value.table.rounding)))}const t={th:{backgroundColor:l.value.table.th.backgroundColor,color:l.value.table.th.color,outline:l.value.table.th.outline},td:{backgroundColor:l.value.table.td.backgroundColor,color:l.value.table.td.color,outline:l.value.table.td.outline},breakpoint:l.value.table.responsiveBreakpoint},s=[l.value.table.columnNames.period].concat(m.value.map(u=>u.name)).concat(l.value.table.columnNames.total);return{head:e,body:a.slice(0,r.value.end-r.value.start),config:t,colNames:s}}),zl=b(()=>{if(m.value.length===0)return{head:[],body:[],config:{},columnNames:[]};const e=m.value.map(t=>({label:t.name,color:t.color,type:t.type})),a=[];for(let t=r.value.start;t<r.value.end;t+=1){const s=[l.value.style.chart.grid.x.timeLabels.values[t]?N.value[t].text:t+1];m.value.forEach(u=>{s.push(Number((u.series[t]||0).toFixed(l.value.table.rounding)))}),a.push(s)}return{head:e,body:a}});function Ye(e=null){const a=[[l.value.style.chart.title.text],[l.value.style.chart.title.subtitle.text],[""]],t=["",...zl.value.head.map(n=>n.label)],s=zl.value.body,u=a.concat([t]).concat(s),i=ot(u);e?e(i):rt({csvContent:i,title:l.value.style.chart.title.text||"vue-ui-xy-canvas"})}function Ra(){return m.value}function Fl(){c.value.showTable=!c.value.showTable}function $l(){c.value.showDataLabels=!c.value.showDataLabels}function Sl(){c.value.stacked=!c.value.stacked}function Ml(){c.value.showTooltip=!c.value.showTooltip}const Ie=d(!1);function je(){Ie.value=!Ie.value}async function Ba({scale:e=2}={}){if(!V.value)return;const{width:a,height:t}=V.value.getBoundingClientRect(),s=a/t,{imageUri:u,base64:i}=await Ct({domElement:V.value,base64:!0,img:!0,scale:e});return{imageUri:u,base64:i,title:l.value.style.chart.title.text,width:a,height:t,aspectRatio:s}}const fe=b(()=>{const e=l.value.table.useDialog&&!l.value.table.show,a=c.value.showTable;return{component:e?Ql:At,title:"".concat(l.value.style.chart.title.text).concat(l.value.style.chart.title.subtitle.text?": ".concat(l.value.style.chart.title.subtitle.text):""),props:e?{backgroundColor:l.value.table.th.backgroundColor,color:l.value.table.th.color,headerColor:l.value.table.th.color,headerBg:l.value.table.th.backgroundColor,isFullscreen:ce.value,fullscreenParent:V.value,forcedWidth:Math.min(800,window.innerWidth*.8)}:{hideDetails:!0,config:{open:a,maxHeight:1e4,body:{backgroundColor:l.value.style.chart.backgroundColor,color:l.value.style.chart.color},head:{backgroundColor:l.value.style.chart.backgroundColor,color:l.value.style.chart.color}}}}});_(()=>c.value.showTable,e=>{l.value.table.show||(e&&l.value.table.useDialog&&de.value?de.value.open():"close"in de.value&&de.value.close())});function Dl(){c.value.showTable=!1,Pe.value&&Pe.value.setTableIconState(!1)}return jl({getData:Ra,getImage:Ba,generateCsv:Ye,generatePdf:cl,generateImage:dl,hideSeries:_a,showSeries:Ea,toggleTable:Fl,toggleLabels:$l,toggleStack:Sl,toggleTooltip:Ml,toggleAnnotator:je,toggleFullscreen:hl}),(e,a)=>(I(),Oe("div",{style:xe("width:100%; position:relative; ".concat(l.value.responsive?"height: 100%":"","; background:").concat(l.value.style.chart.backgroundColor,";")),ref_key:"xy",ref:V,id:"xy_canvas_".concat(Q.value),class:Wa("vue-data-ui-component vue-ui-xy-canvas ".concat(ce.value?"vue-data-ui-wrapper-fullscreen":"")),onMouseenter:ra,onMouseleave:sa},[l.value.style.chart.title.text?(I(),Oe("div",{key:0,ref_key:"chartTitle",ref:ll,style:xe("width:100%;background:".concat(l.value.style.chart.backgroundColor,";"))},[(I(),Y(kt,{key:"title_".concat(Te.value),config:{title:{cy:"xy-canvas-title",...l.value.style.chart.title},subtitle:{cy:"xy-canvas-subtitle",...l.value.style.chart.title.subtitle}}},null,8,["config"]))],4)):W("",!0),K("div",{id:"legend-top-".concat(Q.value)},null,8,Ft),l.value.userOptions.show&&X.value&&(C(ul)||C(Xe))?(I(),Y(C(Jl),{ref_key:"userOptionsRef",ref:Pe,key:"user_option_".concat(el.value),backgroundColor:l.value.style.chart.backgroundColor,color:l.value.style.chart.color,isPrinting:C(nl),isImaging:C(vl),uid:Q.value,hasTooltip:l.value.userOptions.buttons.tooltip&&l.value.style.chart.tooltip.show,hasPdf:l.value.userOptions.buttons.pdf,hasImg:l.value.userOptions.buttons.img,hasXls:l.value.userOptions.buttons.csv,hasLabel:l.value.userOptions.buttons.labels,hasStack:Ke.dataset.length>1&&l.value.userOptions.buttons.stack,hasFullscreen:l.value.userOptions.buttons.fullscreen,hasTable:r.value.end-r.value.start<=730&&l.value.userOptions.buttons.table,isFullscreen:ce.value,isTooltip:c.value.showTooltip,isStacked:c.value.stacked,titles:{...l.value.userOptions.buttonTitles},chartElement:V.value,position:l.value.userOptions.position,hasAnnotator:l.value.userOptions.buttons.annotator,isAnnotation:Ie.value,callbacks:l.value.userOptions.callbacks,printScale:l.value.userOptions.print.scale,tableDialog:l.value.table.useDialog,onToggleFullscreen:hl,onGeneratePdf:C(cl),onGenerateCsv:Ye,onGenerateImage:C(dl),onToggleTable:Fl,onToggleLabels:$l,onToggleStack:Sl,onToggleTooltip:Ml,onToggleAnnotator:je,style:xe({visibility:C(ul)?C(Xe)?"visible":"hidden":"visible"})},El({_:2},[e.$slots.menuIcon?{name:"menuIcon",fn:x(({isOpen:t,color:s})=>[z(e.$slots,"menuIcon",ee(le({isOpen:t,color:s})),void 0,!0)]),key:"0"}:void 0,e.$slots.optionTooltip?{name:"optionTooltip",fn:x(()=>[z(e.$slots,"optionTooltip",{},void 0,!0)]),key:"1"}:void 0,e.$slots.optionPdf?{name:"optionPdf",fn:x(()=>[z(e.$slots,"optionPdf",{},void 0,!0)]),key:"2"}:void 0,e.$slots.optionCsv?{name:"optionCsv",fn:x(()=>[z(e.$slots,"optionCsv",{},void 0,!0)]),key:"3"}:void 0,e.$slots.optionImg?{name:"optionImg",fn:x(()=>[z(e.$slots,"optionImg",{},void 0,!0)]),key:"4"}:void 0,e.$slots.optionTable?{name:"optionTable",fn:x(()=>[z(e.$slots,"optionTable",{},void 0,!0)]),key:"5"}:void 0,e.$slots.optionLabels?{name:"optionLabels",fn:x(()=>[z(e.$slots,"optionLabels",{},void 0,!0)]),key:"6"}:void 0,e.$slots.optionStack?{name:"optionStack",fn:x(()=>[z(e.$slots,"optionStack",{},void 0,!0)]),key:"7"}:void 0,e.$slots.optionFullscreen?{name:"optionFullscreen",fn:x(({toggleFullscreen:t,isFullscreen:s})=>[z(e.$slots,"optionFullscreen",ee(le({toggleFullscreen:t,isFullscreen:s})),void 0,!0)]),key:"8"}:void 0,e.$slots.optionAnnotator?{name:"optionAnnotator",fn:x(({toggleAnnotator:t,isAnnotator:s})=>[z(e.$slots,"optionAnnotator",ee(le({toggleAnnotator:t,isAnnotator:s})),void 0,!0)]),key:"9"}:void 0]),1032,["backgroundColor","color","isPrinting","isImaging","uid","hasTooltip","hasPdf","hasImg","hasXls","hasLabel","hasStack","hasFullscreen","hasTable","isFullscreen","isTooltip","isStacked","titles","chartElement","position","hasAnnotator","isAnnotation","callbacks","printScale","tableDialog","onGeneratePdf","onGenerateImage","style"])):W("",!0),K("div",{class:"vue-ui-xy-canvas",style:xe("position: relative; aspect-ratio: ".concat(il.value)),ref_key:"container",ref:te},[K("canvas",{ref_key:"canvas",ref:A,style:{width:"100%",height:"100%"},onMousemove:a[0]||(a[0]=t=>Da(t)),onMouseleave:Oa},null,544),C(Ve)?(I(),Y(ht,{key:0})):W("",!0),_l(C(Zl),{show:c.value.showTooltip&&ve.value,backgroundColor:l.value.style.chart.tooltip.backgroundColor,color:l.value.style.chart.tooltip.color,fontSize:l.value.style.chart.tooltip.fontSize,borderRadius:l.value.style.chart.tooltip.borderRadius,borderColor:l.value.style.chart.tooltip.borderColor,borderWidth:l.value.style.chart.tooltip.borderWidth,position:l.value.style.chart.tooltip.position,offsetY:l.value.style.chart.tooltip.offsetY,parent:C(A),content:Ae.value,isFullscreen:ce.value,backgroundOpacity:l.value.style.chart.tooltip.backgroundOpacity,isCustom:C(Bl)(l.value.style.chart.tooltip.customFormat),smooth:l.value.style.chart.tooltip.smooth,backdropFilter:l.value.style.chart.tooltip.backdropFilter,smoothForce:l.value.style.chart.tooltip.smoothForce,smoothSnapThreshold:l.value.style.chart.tooltip.smoothSnapThreshold},{"tooltip-before":x(()=>[z(e.$slots,"tooltip-before",ee(le({...Qe.value})),void 0,!0)]),"tooltip-after":x(()=>[z(e.$slots,"tooltip-after",ee(le({...Qe.value})),void 0,!0)]),_:3},8,["show","backgroundColor","color","fontSize","borderRadius","borderColor","borderWidth","position","offsetY","parent","content","isFullscreen","backgroundOpacity","isCustom","smooth","backdropFilter","smoothForce","smoothSnapThreshold"])],4),l.value.style.chart.zoom.show&&O.value>6&&X.value&&rl.value&&!C(Ve)?(I(),Y(wt,{key:2,ref_key:"chartSlicer",ref:Z,allMinimaps:ca.value,background:l.value.style.chart.zoom.color,borderColor:l.value.style.chart.backgroundColor,customFormat:l.value.style.chart.zoom.customFormat,cutNullValues:Fe.value,enableRangeHandles:l.value.style.chart.zoom.enableRangeHandles,enableSelectionDrag:l.value.style.chart.zoom.enableSelectionDrag,end:r.value.end,focusOnDrag:l.value.style.chart.zoom.focusOnDrag,focusRangeRatio:l.value.style.chart.zoom.focusRangeRatio,fontSize:l.value.style.chart.zoom.fontSize,immediate:!l.value.style.chart.zoom.preview.enable,inputColor:l.value.style.chart.zoom.color,isPreview:ha.value,labelLeft:l.value.style.chart.grid.x.timeLabels.values[r.value.start]?N.value[r.value.start].text:"",labelRight:l.value.style.chart.grid.x.timeLabels.values[r.value.end-1]?N.value[r.value.end-1].text:"",max:O.value,min:0,minimap:va.value,minimapCompact:l.value.style.chart.zoom.minimap.compact,minimapFrameColor:l.value.style.chart.zoom.minimap.frameColor,minimapIndicatorColor:l.value.style.chart.zoom.minimap.indicatorColor,minimapLineColor:l.value.style.chart.zoom.minimap.lineColor,minimapMerged:l.value.style.chart.zoom.minimap.merged,minimapSelectedColor:l.value.style.chart.zoom.minimap.selectedColor,minimapSelectedColorOpacity:l.value.style.chart.zoom.minimap.selectedColorOpacity,minimapSelectedIndex:h.value,minimapSelectionRadius:l.value.style.chart.zoom.minimap.selectionRadius,preciseLabels:xl.value.length?xl.value:N.value,refreshEndPoint:l.value.style.chart.zoom.endIndex!==null?l.value.style.chart.zoom.endIndex+1:O.value,refreshStartPoint:l.value.style.chart.zoom.startIndex!==null?l.value.style.chart.zoom.startIndex:0,selectColor:l.value.style.chart.zoom.highlightColor,selectedSeries:M.value,smoothMinimap:l.value.style.chart.zoom.minimap.smooth,start:r.value.start,timeLabels:N.value,usePreciseLabels:l.value.style.chart.grid.x.timeLabels.datetimeFormatter.enable&&!l.value.style.chart.zoom.useDefaultFormat,textColor:l.value.style.chart.color,useResetSlot:l.value.style.chart.zoom.useResetSlot,valueEnd:r.value.end,valueStart:r.value.start,verticalHandles:l.value.style.chart.zoom.minimap.verticalHandles,onFutureEnd:a[1]||(a[1]=t=>gl("end",t)),onFutureStart:a[2]||(a[2]=t=>gl("start",t)),onReset:me,onTrapMouse:ua,"onUpdate:end":ma,"onUpdate:start":ya},{"reset-action":x(({reset:t})=>[z(e.$slots,"reset-action",ee(le({reset:t})),void 0,!0)]),_:3},8,["allMinimaps","background","borderColor","customFormat","cutNullValues","enableRangeHandles","enableSelectionDrag","end","focusOnDrag","focusRangeRatio","fontSize","immediate","inputColor","isPreview","labelLeft","labelRight","max","minimap","minimapCompact","minimapFrameColor","minimapIndicatorColor","minimapLineColor","minimapMerged","minimapSelectedColor","minimapSelectedColorOpacity","minimapSelectedIndex","minimapSelectionRadius","preciseLabels","refreshEndPoint","refreshStartPoint","selectColor","selectedSeries","smoothMinimap","start","timeLabels","usePreciseLabels","textColor","useResetSlot","valueEnd","valueStart","verticalHandles"])):W("",!0),K("div",{id:"legend-bottom-".concat(Q.value)},null,8,$t),ol.value?(I(),Y(Ha,{key:3,to:l.value.style.chart.legend.position==="top"?"#legend-top-".concat(Q.value):"#legend-bottom-".concat(Q.value)},[K("div",{ref_key:"chartLegend",ref:al},[l.value.style.chart.legend.show&&X.value?(I(),Y(Lt,{legendSet:wl.value,config:Ta.value,key:"legend_".concat(Be.value),onClickMarker:a[3]||(a[3]=({i:t})=>Me(t))},{item:x(({legend:t,index:s})=>[K("div",{onClick:u=>t.segregate(),style:xe("opacity:".concat(F.value.includes(s)?.5:1))},Ze(t.name),13,St)]),_:1},8,["legendSet","config"])):z(e.$slots,"legend",{key:1,legend:wl.value},void 0,!0)],512)],8,["to"])):W("",!0),e.$slots.watermark?(I(),Oe("div",Mt,[z(e.$slots,"watermark",ee(le({isPrinting:C(nl)||C(vl)})),void 0,!0)])):W("",!0),e.$slots.source?(I(),Oe("div",{key:5,ref_key:"source",ref:tl,dir:"auto"},[z(e.$slots,"source",{},void 0,!0)],512)):W("",!0),X.value&&l.value.userOptions.buttons.table?(I(),Y(Ua(fe.value.component),Xa({key:6},fe.value.props,{ref_key:"tableUnit",ref:de,onClose:Dl}),El({content:x(()=>[(I(),Y(C(Gl),{key:"table_".concat(Re.value),colNames:De.value.colNames,head:De.value.head,body:De.value.body,config:De.value.config,title:l.value.table.useDialog?"":fe.value.title,withCloseButton:!l.value.table.useDialog,onClose:Dl},{th:x(({th:t})=>[K("div",{innerHTML:t},null,8,Dt)]),td:x(({td:t})=>[Tl(Ze(t),1)]),_:1},8,["colNames","head","body","config","title","withCloseButton"]))]),_:2},[l.value.table.useDialog?{name:"title",fn:x(()=>[Tl(Ze(fe.value.title),1)]),key:"0"}:void 0,l.value.table.useDialog?{name:"actions",fn:x(()=>[K("button",{tabindex:"0",class:"vue-ui-user-options-button",onClick:a[4]||(a[4]=t=>Ye(l.value.userOptions.callbacks.csv))},[_l(at,{name:"excel",stroke:fe.value.props.color},null,8,["stroke"])])]),key:"1"}:void 0]),1040)):W("",!0),l.value.userOptions.buttons.annotator&&m.value.length?(I(),Y(C(Kl),{key:7,parent:V.value,backgroundColor:l.value.style.chart.backgroundColor,color:l.value.style.chart.color,active:Ie.value,onClose:je},null,8,["parent","backgroundColor","color","active"])):W("",!0)],46,zt))}},Ot=Ya(It,[["__scopeId","data-v-74a619ec"]]),Qt=Object.freeze(Object.defineProperty({__proto__:null,default:Ot},Symbol.toStringTag,{value:"Module"}));export{Kt as a,Qt as b,Ot as v};
